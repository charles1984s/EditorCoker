var keyId,order_list;function PageReady(){co.Order={GetHeader:function(e){return $.ajax({url:"/api/Order/GetHeaderOne/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{id:e}})},GetDetails:function(e){return $.ajax({url:"/api/Order/GetOrderDetails/",type:"GET",contentType:"application/json; charset=utf-8",data:{id:e}})}},OrderDataCollapse(),$(window).resize(OrderDataCollapse),ElementInit(),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回訂單列表","資料將不被保存","確定","取消",(function(){history.back()}))})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3),$(".status_select").on("change",(function(){}))}function ElementInit(){$order_number=$(".order_number"),$order_date=$(".order_date"),$order_subtotal=$(".order_subtotal"),$order_freight=$(".order_freight"),$order_total=$(".order_total"),$order_payment=$(".order_payment"),$order_shipping=$(".order_shipping"),$order_status=$(".status_select"),$order_notes=$(".order_notes"),$recipient_name=$(".recipient_name"),$recipient_cellphone=$(".recipient_cellphone"),$recipient_telphone=$(".recipient_telphone"),$recipient_address=$(".recipient_address"),$orderer_name=$(".orderer_name"),$orderer_cellphone=$(".orderer_cellphone"),$orderer_telphone=$(".orderer_telphone"),$orderer_address=$(".orderer_address")}function FormDataClear(){keyId=0,$order_number.text(""),$order_date.text(""),$order_subtotal.text(""),$order_freight.text(""),$order_total.text(""),$order_payment.text(""),$order_shipping.text(""),$order_status.val(0),$order_notes.text(""),$recipient_name.text(""),$recipient_cellphone.text(""),$recipient_telphone.text(""),$recipient_address.text(""),$orderer_name.text(""),$orderer_cellphone.text(""),$orderer_telphone.text(""),$orderer_address.text("")}function contentReady(e){order_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");co.Order.GetHeader(parseInt(e)).done((function(e){null!=e?(keyId=e.id,HeaderDataSet(e),co.Order.GetDetails(keyId).done((function(e){for(var t=0;t<e.length;t++)DetailsDataSet(e[t]);MoveToContent()}))):window.location.hash=""}))}}else BackToList()}function editButtonClicked(e){keyId=e.row.key,window.location.hash=keyId,MoveToContent()}function HeaderDataSet(e){$order_number.text(("000000000"+e.id).substr(e.id.length)),$order_date.text(e.creationTime),$order_subtotal.text(e.subtotal.toLocaleString("en-US")),$order_freight.text(e.freight.toLocaleString("en-US")),$order_total.text(e.total.toLocaleString("en-US")),$order_payment.text(e.payment),$order_shipping.text(e.shipping),$order_status.val(e.state),$order_notes.text(e.remark),$recipient_name.text(e.recipient),$recipient_cellphone.text(e.recipientCellPhone);var t=e.recipientTelephone.indexOf("-",5);$recipient_telphone.text(e.recipientTelephone.substr(t+1).length>0?e.recipientTelephone:e.recipientTelephone.subtotal(0,t)),$recipient_address.text(e.recipientAddress),$orderer_name.text(e.orderer),$orderer_cellphone.text(e.ordererCellPhone);var r=e.ordererTelephone.indexOf("-",5);$orderer_telphone.text(e.ordererTelephone.substr(r+1).length>0?e.ordererTelephone:e.ordererTelephone.subtotal(0,r))}function DetailsDataSet(e){var t=$($("#Templat_Purchase_List").html()).clone(),r=t.find(".pro_image"),n=t.find(".pro_name"),o=t.find(".pro_specification"),a=t.find(".pro_instructions"),i=t.find(".pro_unit"),d=t.find(".pro_quantity"),s=t.find(".pro_subtotal");r.attr("src",e.imagePath),n.text(e.title),o.text(e.s1Title+" "+e.s2Title),a.text(e.description),i.text(e.price.toLocaleString("en-US")),d.text(e.quantity),s.text((e.price*e.quantity).toLocaleString("en-US")),$("#OrderDetails > .card-body > .purchase_list").append(t)}function MoveToContent(){$("#OrderList").addClass("d-none"),$("#OrderContent").removeClass("d-none")}function BackToList(){$("#OrderList").removeClass("d-none"),$("#OrderContent").addClass("d-none"),window.location.hash="",$("#OrderDetails > .card-body > .purchase_list > .purchase_item").each((function(){$(this).remove()}))}function OrderDataCollapse(){$this_body=$("body > .wrapper > .content-area > .content-wrapper"),$OrderDetails=$("#OrderDetails"),$OrderData=$("#OrderData"),$this_body.width()>=1024?($("#Btn_Side_Collapse").addClass("d-none"),$OrderDetails.removeClass("col-12"),$OrderData.addClass("col-3"),$OrderData.removeClass("offcanvas offcanvas-end visible"),$OrderData.css("visibility","")):($("#Btn_Side_Collapse").removeClass("d-none"),$OrderDetails.addClass("col-12"),$OrderData.addClass("offcanvas offcanvas-end visible"),$OrderData.removeClass("col-3"))}