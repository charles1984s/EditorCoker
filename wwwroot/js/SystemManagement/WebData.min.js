var companyInfoIsEdit=!1;function PageReady(){const e=grapesInit({save:function(e,a){var o=$.Deferred();return co.WebMesnus.saveConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:a}).done((function(e){e.success?o.resolve():co.sweet.error(e.error)})),o.promise()},import:function(e,a){var o=$.Deferred();return co.WebMesnus.importConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:a}).done((function(e){e.success?o.resolve():co.sweet.error(e.error)})),o.promise()},getComponer:function(){var e=$.Deferred();return co.HtmlContent.GetAllComponent().done((function(a){a.success?e.resolve(a.list):co.sweet.error(resutlt.error)})),e.promise()}});setPage=function(a){co.WebMesnus.getConten(a).done((function(a){if(a.success){var o=co.Data.HtmlDecode(a.conten.saveHtml);co.Grapes.setEditor(e,o,a.conten.saveCss)}else co.sweet.error(a.error)}))},co.File.getImgFile({Sid:$("#WebsiteID").val(),Type:11,Size:1}).done((function(e){if(e.length>0)for(var a=e.length-1;a>-1;a--)ImageUploadModalDataInsert($("#IconImageUpload"),e[a].id,e[a].link,e[a].name)})),co.File.getImgFile({Sid:$("#WebsiteID").val(),Type:12,Size:1}).done((function(e){if(e.length>0)for(var a=e.length-1;a>-1;a--)ImageUploadModalDataInsert($("#LogoImageUpload"),e[a].id,e[a].link,e[a].name)})),co.WebSite.getPrivacyAndTerms().done((function(e){e.success&&(2==e.message.split(" ").length?($("#PrivacyStatement").data("id",e.message.split(" ")[0]),$("#MembershipTerms").data("id",e.message.split(" ")[1])):($("#PrivacyStatement").data("id",0),$("#MembershipTerms").data("id",0)),$(".btn_privacy").on("click",(function(){0==$("#PrivacyStatement").data("id")?co.WebMesnus.createOrEdit({Id:0,Title:"隱私權聲明",RouterName:"footer_privacy",PageType:1,Visible:!1,SerNo:1e3,PopularVisible:!1,LanBar:!1,Icon:"empty"}).done((function(e){e.success&&($("#PrivacyStatement").data("id",e.message),$("#TopLine > .title").text("隱私權聲明頁面編輯"),window.location.hash="#privacy",MoveToCanvas($("#PrivacyStatement").data("id")))})):($("#TopLine > .title").text("隱私權聲明頁面編輯"),window.location.hash="#privacy",MoveToCanvas($("#PrivacyStatement").data("id")))})),$(".btn_terms").on("click",(function(){0==$("#MembershipTerms").data("id")?co.WebMesnus.createOrEdit({Id:0,Title:"會員條款說明",RouterName:"terms",PageType:1,Visible:!1,SerNo:1e3,PopularVisible:!1,LanBar:!1,Icon:"empty"}).done((function(e){console.log(e),e.success&&($("#MembershipTerms").data("id",e.message),$("#TopLine > .title").text("會員條款說明頁面編輯"),window.location.hash="#terms",MoveToCanvas($("#MembershipTerms").data("id")))})):($("#TopLine > .title").text("會員條款說明頁面編輯"),window.location.hash="#terms",MoveToCanvas($("#MembershipTerms").data("id")))})))})),$("#IconImageUpload").ImageUploadModalClear(),$("#LogoImageUpload").ImageUploadModalClear(),$(".btn_input_icon").on("click",(function(){$(".input_icon").click()})),$(".btn_input_logo").on("click",(function(){$(".input_logo").click()})),$(".btn_company_info_edit").on("click",(function(){companyInfoIsEdit=!companyInfoIsEdit,CompanyInfoEdit()})),$("#CompanyInfo > .form_btn > .btn_exit").on("click",CompanyInfoExit),$("#CompanyInfo > .form_btn > .btn_save").on("click",CompanyInfoSave),$("#WebsiteInfo > .form_btn > .btn_save").on("click",WebsiteInfoSave);let a=$("#TWzipcode .address").val();co.Zipcode.init("#TWzipcode"),co.Zipcode.setData({el:$("#TWzipcode"),addr:a}),HashDataEdit(),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");switch(console.log(e),e){case"privacy":void 0!==$("#PrivacyStatement").data("id")&&$("#PrivacyStatement").data("id")>0?MoveToCanvas($("#PrivacyStatement").data("id")):(window.location.hash="",keyId="");break;case"terms":void 0!==$("#MembershipTerms").data("id")&&$("#MembershipTerms").data("id")>0?MoveToCanvas($("#MembershipTerms").data("id")):(window.location.hash="",keyId="");break;default:window.location.hash="",keyId=""}}}else BackToMain()}function CompanyInfoEdit(){$this_form_input=$("#CompanyInfo > form > div input"),$this_form_select=$("#CompanyInfo > form > div select"),$this_form_btn=$("#CompanyInfo > .form_btn"),companyInfoIsEdit?($this_form_input.removeAttr("disabled"),$this_form_select.removeAttr("disabled"),$this_form_btn.addClass("d-flex")):($this_form_input.attr("disabled","disabled"),$this_form_select.attr("disabled","disabled"),$this_form_btn.removeClass("d-flex"))}function CompanyInfoExit(){companyInfoIsEdit=!1,CompanyInfoEdit()}function CompanyInfoSave(e){companyInfoIsEdit=!1;const a=document.getElementById("CompnyData");a.checkValidity()?(co.Company.Save(co.Form.getJson("CompnyData")).done((function(e){e.success?co.sweet.success("儲存成功"):co.sweet.error(e.error)})),CompanyInfoEdit()):(e.preventDefault(),e.stopPropagation()),a.classList.add("was-validated")}function WebsiteInfoSave(e){const a=document.getElementById("WebsiteData");a.checkValidity()?co.WebSite.Save(co.Form.getJson("WebsiteData")).done((function(e){e.success?handleFileUpload("#IconImageUpload",11).then((function(e){e.success?handleFileUpload("#LogoImageUpload",12).then((function(e){e.success?co.sweet.success("儲存成功"):co.sweet.error(e.message)})):co.sweet.error(e.message)})).catch((function(e){co.sweet.error(e.message||"發生錯誤")})):co.sweet.error(e.error)})):(e.preventDefault(),e.stopPropagation()),a.classList.add("was-validated")}function handleFileUpload(e,a){var o=$(e).find(".img_input_frame").data("delectList"),t=$(`${e} .img_input_frame > .img_input`).data("file")?.File;if(void 0!==o&&null!=o)return co.File.DeleteFileById({Sid:$("#WebsiteID").val(),Type:a,Fid:o}).then((function(e){if(void 0!==t&&null!=t){var o=new FormData;return o.append("files",t),o.append("type",a),o.append("sid",$("#WebsiteID").val()),o.append("serno",500),co.File.Upload(o)}return Promise.resolve({success:!0})}));if(void 0!==t&&null!=t){var n=new FormData;return n.append("files",t),n.append("type",a),n.append("sid",$("#WebsiteID").val()),n.append("serno",500),co.File.Upload(n)}return Promise.resolve({success:!0})}function MoveToCanvas(e){$("#gjs").data("id",e),setPage(e),$("html,body").animate({scrollTop:0}),$("#TopLine > a").removeClass("d-none"),$("#WebDataMain").addClass("d-none"),$("#WebDataCanvas").removeClass("d-none")}function BackToMain(){$("#TopLine > a").addClass("d-none"),$("#TopLine > .title").text("網站資料"),$("#WebDataMain").removeClass("d-none"),$("#WebDataCanvas").addClass("d-none"),window.location.hash=""}