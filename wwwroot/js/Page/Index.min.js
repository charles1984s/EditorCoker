function PageReady(){const e=new bootstrap.Offcanvas("#offcanvasSite");var a=grapesInit({save:function(e,a){var o=$.Deferred();return co.WebMesnus.saveConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:a}).done((function(e){e.success?o.resolve():co.sweet.error(e.error)})),o.promise()},import:function(e,a){var o=$.Deferred();return co.WebMesnus.importConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:a}).done((function(e){e.success?o.resolve():co.sweet.error(e.error)})),o.promise()},getComponer:function(){var e=$.Deferred();return co.HtmlContent.GetAllComponent().done((function(a){a.success?e.resolve(a.list):co.sweet.error(resutlt.error)})),e.promise()}}),o=new MenuEditor("myEditor",{textConfirmDelete:"是否確認將<span class='ConfirmKeyWord'>{0}</span>選單刪除?",listOptions:{placeholderCss:{"background-color":"#cccccc"}},iconPicker:{searchText:"Buscar...",labelHeader:"{0}/{1}"},maxLevel:-1,element:{Form:"#frmEdit",Update:"#btnUpdate",Add:"#btnAdd",Refresh:"#btnRefresh"},on:{ready:function(){co.WebMesnus.GetPageTypeList().done((function(e){if(e.success){const a=$("#PageType");$(e.type).each((function(){a.append(`<option value="${this.value}">${this.key}</option>`)})),a.on("change",(function(){2==$(this).val()?$("#RouterNameBlock").addClass("d-none").val("Home"):$("#RouterNameBlock").removeClass("d-none").val("")}))}})),ImageUploadModalInit($("#ImageUpload"),!0,!1),ImageUploadModalInit($("#OverImageUpload"),!0,!1)},edit:function(){d(),$("#btnUpdate").removeClass("d-none"),$("#btnRefresh,#btnAdd").addClass("d-none"),ImageUploadModalClear($("#ImageUpload")),ImageUploadModalDataInsert($("#ImageUpload"),$("#ImageUpload").siblings("#imgId").val(),$("#ImageUpload").siblings("#imgUrl").val(),$("#ImageUpload").siblings("#imgName").val()),ImageUploadModalClear($("#OverImageUpload")),ImageUploadModalDataInsert($("#OverImageUpload"),$("#OverImageUpload").siblings("#overImgId").val(),$("#OverImageUpload").siblings("#overImgUrl").val(),$("#ImageUpload").siblings("#overImgName").val())},del:function(e){0==$("#myEditor>li").length&&($("#myEditor").addClass("d-none"),$("#myEditor + .emptyList").removeClass("d-none")),co.WebMesnus.delete(e.id).done((function(e){e.success?co.sweet.success("已成功刪除"):co.sweet.error(e.error)}))},add:function(a){var d=a.data();$("#myEditor").removeClass("d-none"),$("#myEditor + .emptyList").addClass("d-none"),co.WebMesnus.createOrEdit(d).done((function(a){if(a.success){var n;if(d.id=parseInt(a.message),null!=$("#ImageUpload").data("file").File)(n=new FormData).append("files",$("#ImageUpload").data("file").File),n.append("type",2),n.append("sid",d.id),n.append("serno",500),co.File.Upload(n).done((function(a){a.success&&menuReload(o,e)}));if(null!=$("#OverImageUpload").data("file").File)(n=new FormData).append("files",$("#OverImageUpload").data("file").File),n.append("type",3),n.append("sid",d.id),n.append("serno",500),co.File.Upload(n).done((function(a){a.success&&menuReload(o,e)}));co.sweet.success("新增成功"),ImageUploadModalClear($("#ImageUpload")),ImageUploadModalClear($("#OverImageUpload"))}else co.sweet.error(a.error)}))},update:function(a){null!=$("#ImageUpload").data("delectList")&&co.File.DeleteFileById({Sid:a.id,Type:2,Fid:$("#ImageUpload").data("delectList")[0]}).done((function(a){a.success&&menuReload(o,e)})),null!=$("#OverImageUpload").data("delectList")&&co.File.DeleteFileById({Sid:a.id,Type:3,Fid:$("#OverImageUpload").data("delectList")[0]}).done((function(a){a.success&&menuReload(o,e)})),co.WebMesnus.createOrEdit(a).done((function(d){var n;null!=$("#ImageUpload").data("file")&&null!=$("#ImageUpload").data("file").File&&0==$("#ImageUpload").data("file").Id&&((n=new FormData).append("files",$("#ImageUpload").data("file").File),n.append("type",2),n.append("sid",a.id),n.append("serno",500),co.File.Upload(n).done((function(a){a.success&&menuReload(o,e)})));null!=$("#OverImageUpload").data("file")&&null!=$("#OverImageUpload").data("file").File&&0==$("#OverImageUpload").data("file").Id&&((n=new FormData).append("files",$("#OverImageUpload").data("file").File),n.append("type",3),n.append("sid",a.id),n.append("serno",500),co.File.Upload(n).done((function(a){a.success&&menuReload(o,e)})));d.success?co.sweet.success("更新成功"):co.sweet.error(d.error),ImageUploadModalClear($("#ImageUpload")),ImageUploadModalClear($("#OverImageUpload"))}))},save:function(){},drop:function(e){let a,o,d=[],n=e.parents("li"),s=n.last(),l=n.first(),t=e.parents("ul"),r=!1;a=0==l.length?null:l.data("id"),o=0==s.length?null:s.data("id"),e.data("fK_TopNodeId")==a&&e.data("fK_RootNodeId")==o||(e.data({fK_TopNodeId:a,fK_RootNodeId:o}),r=!0,d.push($(e).data())),t.children("li").each((function(a,o){var n=$(o).data("serNO");console.log(n,a+1,o),n!=a+1&&(n=a+1,$(o).data("serNO",n),$(o).data("id")!=e.data("id")?d.push($(o).data()):r||d.push($(o).data()))})),co.WebMesnus.updateLevelAndSerNo(d).done((function(e){e.success||co.sweet.error(e.error)}))},page:function(o){$("#gjs").data("id",o.id),$("#gjs").removeClass("d-none"),$("#gjs + .emptyList").addClass("d-none"),co.WebMesnus.getConten(o.id).done((function(o){if(o.success){var d=co.Data.HtmlDecode(o.conten.saveHtml);a.setComponents(d),a.setStyle(o.conten.saveCss),e.hide()}else co.sweet.error(o.error)}))}}}),d=function(){0==$('#frmEdit [name="id"]').val()&&$("#btnClear").addClass("d-none"),$("#offcanvasSite").addClass("offcanvas-lg"),$("#MenuEditorForm").removeClass("d-none")};$("#offcanvasSite").on("show.bs.offcanvas",(function(){$("#offcanvasSite").removeClass("offcanvas-lg"),$("#MenuEditorForm").addClass("d-none")})),$("#btnExtend").on("click",(function(){ImageUploadModalClear($("#ImageUpload")),ImageUploadModalClear($("#OverImageUpload")),d(),$('#frmEdit [name="id"]').val(0),$("#btnRefresh,#btnAdd").removeClass("d-none"),$("#btnUpdate").addClass("d-none"),$("#btnRefresh").trigger("click")})),menuReload(o,e)}function menuReload(e,a){co.WebMesnus.getAll().done((function(o){o.success?(e.setData(o.maps),$("#myEditor").removeClass("d-none"),o.maps.length>0?$("#myEditor + .emptyList").addClass("d-none"):$("#myEditor").addClass("d-none"),a.show()):e.setData([])}))}