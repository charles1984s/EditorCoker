function PageReady(){const e=new bootstrap.Offcanvas("#offcanvasSite");var a=grapesInit({save:function(e,a){var o=$.Deferred();return co.WebMesnus.saveConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:a}).done((function(e){e.success?o.resolve():co.sweet.error(e.error)})),o.promise()},import:function(e,a){var o=$.Deferred();return co.WebMesnus.importConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:a}).done((function(e){e.success?o.resolve():co.sweet.error(e.error)})),o.promise()},getComponer:function(){var e=$.Deferred();return co.HtmlContent.GetAllComponent().done((function(a){a.success?e.resolve(a.list):co.sweet.error(resutlt.error)})),e.promise()}});let o={textConfirmDelete:"是否確認將<span class='ConfirmKeyWord'>{0}</span>選單刪除?",listOptions:{placeholderCss:{"background-color":"#cccccc"}},iconPicker:{searchText:"Buscar...",labelHeader:"{0}/{1}"},maxLevel:-1,element:{Form:"#frmEdit",Update:"#btnUpdate",Add:"#btnAdd",Refresh:"#btnRefresh"},on:{ready:function(){co.WebMesnus.GetPageTypeList().done((function(e){if(e.success){const a=$("#pageType");$(e.type).each((function(){a.append(`<option value="${this.value}">${this.key}</option>`)})),a.on("change",(function(){2==$(this).val()?$("#RouterNameBlock").addClass("d-none").val("Home"):$("#RouterNameBlock").removeClass("d-none").val("")}))}})),$("#IconImageUpload").ImageUploadModalClear(),$("#ImageUpload").ImageUploadModalClear(),$("#OverImageUpload").ImageUploadModalClear()},edit:function(){n(),$("#btnUpdate").removeClass("d-none"),$("#btnRefresh,#btnAdd").addClass("d-none"),$("#IconImageUpload").ImageUploadModalClear(),ImageUploadModalDataInsert($("#IconImageUpload"),$("#IconImageUpload").siblings("#iconId").val(),$("#IconImageUpload").siblings("#iconUrl").val(),""),$("#ImageUpload").ImageUploadModalClear(),ImageUploadModalDataInsert($("#ImageUpload"),$("#ImageUpload").siblings("#imgId").val(),$("#ImageUpload").siblings("#imgUrl").val(),$("#ImageUpload").siblings("#imgName").val()),$("#OverImageUpload").ImageUploadModalClear(),ImageUploadModalDataInsert($("#OverImageUpload"),$("#OverImageUpload").siblings("#overImgId").val(),$("#OverImageUpload").siblings("#overImgUrl").val(),$("#OverImageUpload").siblings("#overImgName").val())},del:function(e){0==$("#myEditor>li").length&&($("#myEditor").addClass("d-none"),$("#myEditor + .emptyList").removeClass("d-none")),co.WebMesnus.delete(e.id).done((function(e){e.success?co.sweet.success("已成功刪除"):co.sweet.error(e.error)}))},add:function(a){var o=a.data();$("#myEditor").removeClass("d-none"),$("#myEditor + .emptyList").addClass("d-none"),co.WebMesnus.createOrEdit(o).done((function(a){if(a.success){o.id=parseInt(a.message);var n=0,d=0,t=0,s=$("#IconImageUpload .img_input_frame > .img_input");if(void 0!==s.data("file")&&null!=s.data("file"))(i=new FormData).append("files",s.data("file").File),i.append("type",9),i.append("sid",o.id),i.append("serno",500),co.File.Upload(i).done((function(e){n=e.success?1:-1}));else n=1;var l=$("#ImageUpload .img_input_frame > .img_input");if(void 0!==l.data("file")&&null!=l.data("file"))(i=new FormData).append("files",l.data("file").File),i.append("type",2),i.append("sid",o.id),i.append("serno",500),co.File.Upload(i).done((function(e){d=e.success?1:-1}));else d=1;var i,r=$("#OverImageUpload .img_input_frame > .img_input");if(void 0!==r.data("file")&&null!=r.data("file"))(i=new FormData).append("files",r.data("file").File),i.append("type",3),i.append("sid",o.id),i.append("serno",500),co.File.Upload(i).done((function(e){t=e.success?1:-1}));else t=1;const c=function(){0!=n&&0!=d&&0!=t?($("#IconImageUpload").ImageUploadModalClear(),$("#ImageUpload").ImageUploadModalClear(),$("#OverImageUpload").ImageUploadModalClear(),menuReload(menuEditor,e),a.success?-1==n||-1==d||-1==t?co.sweet.erro("圖片上傳失敗"):co.sweet.success("新增成功"):co.sweet.error(a.error)):setTimeout(c,100)};setTimeout(c,100)}else co.sweet.error(a.error)}))},update:function(a){let o=!1,n="";""==a.linkUrl&&""==a.routerName?n="【路徑名稱】與【連結】<span class='text-danger font-weight-bold'>必須</span>填寫其中之一":""!=a.linkUrl&&""!=a.routerName?n="【路徑名稱】與【連結】<span class='text-danger font-weight-bold'>僅能</span>填寫其中之一":o=!0,o?co.WebMesnus.createOrEdit(a).done((function(o){if(o.success){var n=0,d=0,t=0,s=0,l=0,i=0,r=$("#IconImageUpload .img_input_frame").data("delectList");null!=r?co.File.DeleteFileById({sid:a.id,type:9,fid:r}).done((function(e){s=e.success?1:-1,a.IconUrl="",a.IconId=""})):s=1;var c=$("#ImageUpload .img_input_frame").data("delectList");null!=c?co.File.DeleteFileById({sid:a.id,type:2,fid:c}).done((function(e){l=e.success?1:-1})):l=1;var p=$("#OverImageUpload .img_input_frame").data("delectList");null!=p?co.File.DeleteFileById({sid:a.id,type:3,fid:p}).done((function(e){i=e.success?1:-1})):i=1;const m=function(){if(0!=s&&0!=l&&0!=i){var r;if(1==s)if(void 0!==(r=$("#IconImageUpload .img_input_frame > .img_input")).data("file")&&null!=r.data("file")&&null!=r.data("file").File)(c=new FormData).append("files",r.data("file").File),c.append("type",9),c.append("sid",a.id),c.append("serno",500),co.File.Upload(c).done((function(e){n=e.success?1:-1}));else n=1;else n=-1;if(1==l)if(void 0!==(r=$("#ImageUpload .img_input_frame > .img_input")).data("file")&&null!=r.data("file")&&null!=r.data("file").File)(c=new FormData).append("files",r.data("file").File),c.append("type",2),c.append("sid",a.id),c.append("serno",500),co.File.Upload(c).done((function(e){d=e.success?1:-1}));else d=1;else d=-1;if(1==i){var c,p=$("#OverImageUpload .img_input_frame > .img_input");if(void 0!==p.data("file")&&null!=p.data("file")&&null!=p.data("file").File)(c=new FormData).append("files",p.data("file").File),c.append("type",3),c.append("sid",a.id),c.append("serno",500),co.File.Upload(c).done((function(e){t=e.success?1:-1}));else t=1}else t=-1;const m=function(){1==n&&1==d&&1==t?(menuReload(menuEditor,e),$("#IconImageUpload").ImageUploadModalClear(),$("#ImageUpload").ImageUploadModalClear(),$("#OverImageUpload").ImageUploadModalClear(),o.success?-1==n||-1==d||-1==t?co.sweet.erro("圖片上傳失敗"):co.sweet.success("新增成功"):co.sweet.error(o.error)):setTimeout(m,100)};setTimeout(m,100)}else setTimeout(m,100)};setTimeout(m,100)}else co.sweet.error(o.error)})):co.sweet.error("資料錯誤",n)},setPower:function(e){$("#PermissionDetailsModal").setData({pageId:e.id,type:0}).modal("show")},drop:function(e){let a,o,n=[],d=e.parents("li"),t=d.last(),s=d.first(),l=e.parents("ul"),i=!1;a=0==s.length?null:s.data("id"),o=0==t.length?null:t.data("id"),e.data("fK_TopNodeId")==a&&e.data("fK_RootNodeId")==o||(e.data({fK_TopNodeId:a,fK_RootNodeId:o}),i=!0,n.push($(e).data())),l.children("li").each((function(a,o){var d=$(o).data("serNO");console.log(d,a+1,o),d!=a+1&&(d=a+1,$(o).data("serNO",d),$(o).data("id")!=e.data("id")?n.push($(o).data()):i||n.push($(o).data()))})),co.WebMesnus.updateLevelAndSerNo(n).done((function(e){e.success||co.sweet.error(e.error)}))},page:function(o){$("#gjs").data("id",o.id),$("#gjs").removeClass("d-none"),$("#gjs + .emptyList").addClass("d-none"),co.WebMesnus.getConten(o.id).done((function(n){if(n.success){var d=co.Data.HtmlDecode(n.conten.saveHtml);co.Grapes.setEditor(a,d,n.conten.saveCss),co.Grapes.setFile(a,o.id,1),$("body").addClass("grapesEdit"),$("#TopLine .title").text(o.text),e.hide()}else co.sweet.error(n.error)}))}}};co.PowerManagement.GetPermission().done((function(a){a.CanCreate||delete o.on.setPower;var t=new MenuEditor("myEditor",o);$("#offcanvasSite").on("show.bs.offcanvas",(function(){d()})),$("#offcanvasSite").on("click",".btn-close",(function(a){a.preventDefault(),$("#offcanvasSite.offcanvas-lg").length>0?d():e.hide()})),$("#btnExtend").on("click",(function(){$("#IconImageUpload").ImageUploadModalClear(),$("#ImageUpload").ImageUploadModalClear(),$("#OverImageUpload").ImageUploadModalClear(),n(),$('#frmEdit [name="id"]').val(0),$("#btnRefresh,#btnAdd").removeClass("d-none"),$("#btnUpdate").addClass("d-none"),$("#btnRefresh").trigger("click"),$("#MenuEditorForm>.card-header>.title").text("新增選單"),$("#MenuEditorForm>.card-header>a").addClass("d-none")})),menuReload(t,e)}));var n=function(){0==$('#frmEdit [name="id"]').val()&&$("#btnClear").addClass("d-none"),$("#offcanvasSite").addClass("offcanvas-lg"),$("#MenuEditorForm").removeClass("d-none")},d=function(){$("#offcanvasSite").removeClass("offcanvas-lg"),$("#MenuEditorForm").addClass("d-none")}}function menuReload(e,a){co.WebMesnus.getAll().done((function(o){o.success?(e.setData(o.maps),$("#myEditor").removeClass("d-none"),o.maps.length>0?$("#myEditor + .emptyList").addClass("d-none"):$("#myEditor").addClass("d-none"),a.show()):e.setData([])}))}