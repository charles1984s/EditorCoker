let keyId,article_list,$from;function PageReady(){ElementInit(),TagListModalInit();const e=$("#PageForm");$Tags=$(e).find(".InputTag").TagListModalInit(),Array.from(e).forEach((e=>{e.addEventListener("submit",(t=>{e.checkValidity()?(t.preventDefault(),Coker.sweet.confirm("即將儲存","儲存後將顯示於安排的位置","儲存","取消",(function(){AddUp("已成功儲存","儲存發生未知錯誤")}))):(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated"),WasValidated()}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回文章列表","資料將不被保存","確定","取消",(function(){article_list.component.refresh(),BackToList()}))})),$(".btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$from=$("#PageForm")}function contentReady(e){article_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");0==parseInt(e)?(window.location.hash=0,keyId=0,FormDataClear(),MoveToContent()):co.UserHabits.GetUserGroupOne(parseInt(e)).done((function(t){null!=t?(keyId=parseInt(e),e.indexOf("-")>0?MoveToCanvas():(MoveToContent(),FormDataSet(t))):(window.location.hash="",keyId="")}))}}else BackToList()}function editButtonClicked(e){MoveToContent(),keyId=e.row.key,window.location.hash=keyId}function FormDataClear(){$Tags.TagDataClear(),keyId=0,co.Form.clear("PageForm")}function FormDataSet(e){FormDataClear(),keyId=e.id,co.Form.insertData(e.object,"PageForm"),$Tags.TagDataSet(e.object.tags)}function paletteButtonClicked(e){keyId=e.row.key,window.location.hash=keyId+"-1"}function deleteButtonClicked(e){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.UserHabits.DeleteUserGroup(e.row.key).done((function(t){t.success&&(co.sweet.success("刪除成功"),e.component.refresh())}))}))}function AddUp(e,t,o){let a=co.Form.getJson("PageForm");a.tags=$Tags.data("tagList"),co.UserHabits.AddUpUserGroup(a).done((function(o){o.success?(Coker.sweet.success(e,null,!0),setTimeout((function(){article_list.component.refresh(),BackToList()}),1e3)):Coker.sweet.error("錯誤",t,null,!0)})).fail((function(){Coker.sweet.error("錯誤",t,null,!0)}))}function MoveToContent(){UnValidated(),$("#PageList").addClass("d-none"),$("#PageContent").removeClass("d-none"),$("body").removeClass("grapesEdit")}function BackToList(){$("#TopLine > div > a").addClass("d-none"),$("#PageList").removeClass("d-none"),$("#PageContent").addClass("d-none"),$("body").removeClass("grapesEdit"),$("#TopLine .title").text("文章管理"),window.location.hash=""}function WasValidated(){}function UnValidated(){$("#PageForm").removeClass("was-validated")}