var BasicInfoForm,LoginMailForm,$btn_mail_lock,$btn_newpass_lock,$btn_checkpass_lock,$NewPassFeedBack,$member_number,$name,$sex,$status,$level,$email_basic,$cellphone,$telphone_area,$telphone,$telphone_ext,$address_city,$address_town,$address,$email_login,$newpass,$passcheck,member_list,new_pass_show=!1,check_pass_show=!1,isMailLock=!1,BasicInfoFilled=!1,LoginMailFilled=!1,PassIsCheck=!0;function PageReady(){co.Member={Get:function(e){return $.ajax({url:"/api/Member/GetAllData/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{id:e}})},Update:function(e){return $.ajax({url:"/api/Member/Update",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(e),dataType:"json"})}},ManagementDataCollapse(),OrderDetailsPosition(),TWZipCodeInit(),ElementInit(),$(window).resize((function(){ManagementDataCollapse(),OrderDetailsPosition()})),$(".order_data").each((function(){var e=$(this).children("div").children(".status");"出貨中"==e.text()&&e.addClass("bg_fluorescent")})),""!=$email_login.val()&&($(".btn_mail_lock > span").text("lock"),$email_login.attr("disabled","disabled"),isMailLock=!0),$(".btn_save").on("click",DataSave),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回會員管理","資料將不被保存","確定","取消",(function(){history.back()}))})),$email_login.keyup((function(){LoginMailFilled=FormCheck(LoginMailForm)})),$newpass.keyup((function(){PassIsCheck=PassCheck()})),$passcheck.keyup((function(){PassIsCheck=PassCheck()})),$btn_mail_lock.on("click",(function(e){e.preventDefault(),e.stopPropagation(),mail_lock($(this))})),$btn_newpass_lock.on("click",(function(e){e.preventDefault(),e.stopPropagation(),new_pass_show=PassDisplay($(this),new_pass_show)})),$btn_checkpass_lock.on("click",(function(e){e.preventDefault(),e.stopPropagation(),check_pass_show=PassDisplay($(this),check_pass_show)})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){BasicInfoForm=$("#MemberData > form"),LoginMailForm=$("#LoginData form"),$btn_mail_lock=$(".btn_mail_lock"),$btn_newpass_lock=$(".btn_newpass_lock"),$btn_checkpass_lock=$(".btn_checkpass_lock"),$NewPassFeedBack=$("#NewPassFeedBack"),$CheckPassFeedBack=$("#CheckPassFeedBack"),$member_number=$(".member_number"),$name=$("#InputName"),$sex=$("input[name=RadioGender]"),$status=$("select[name='MemberStatus']"),$level=$("select[name='MemberLevel']"),$email_basic=$("#InputMailBasic"),$cellphone=$("#InputCellPhone"),$telphone_area=$("#InputTelPhoneArea"),$telphone=$("#InputTelPhone"),$telphone_ext=$("#InputTelPhoneExt"),$address_city=$("select[name='county']"),$address_town=$("select[name='district']"),$address=$("#InputAddress"),$email_login=$("#InputMailLogin"),$newpass=$("#InputPasswordNew"),$passcheck=$("#InputPasswordCheck")}function FormDataClear(){keyId=0,$name.val(""),$sex.each((function(){3==$(this).val()&&$(this).prop("checked",!0)})),$status.val(""),$level.val(""),$email_basic.val(""),$cellphone.val(""),$telphone_area.val(""),$telphone.val(""),$telphone_ext.val(""),$address_city.val(""),$address_town.val(""),$address.val(""),$email_login.val(""),$newpass.val(""),$passcheck.val("")}function contentReady(e){member_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){FormDataClear();var e=window.location.hash.replace("#","");co.Member.Get(parseInt(e)).done((function(a){null!=a?(MoveToContent(),keyId=parseInt(e),FormDataSet(a)):window.location.hash=""}))}}else BackToList()}function editButtonClicked(e){keyId=e.row.key,window.location.hash=keyId,HashDataEdit()}function FormDataSet(e){if($member_number.text(e.id),$name.val(e.name),$sex.each((function(){$(this).val()==e.sex&&$(this).prop("checked",!0)})),$status.val(e.status),$level.val(e.level),$email_basic.val(e.email),$cellphone.val(e.cellphone),null!=e.telphone){var a=e.telphone.split("-");$telphone_area.val(a[0]),$telphone.val(a[1]),$telphone_ext.val(a[2])}if(null!=e.address){var s=e.address.split(" ");$TWzipcode.twzipcode("set",{county:s[0],district:s[1]}),$address.val(s[2])}$email_login.val(e.email)}function Update(e,a){var s=3;$sex.each((function(){$(this).is(":checked")&&(s=$(this).val())})),co.Member.Update({Id:keyId,Name:$name.val(),Sex:s,Status:$status.val(),Level:$level.val(),Email:$email_basic.val(),CellPhone:$cellphone.val(),TelPhone:$telphone_area.val()+"-"+$telphone.val()+"-"+$telphone_ext.val(),Address:$address_city.val()+" "+$address_town.val()+" "+$address.val()}).done((function(){Coker.sweet.success(e,null,!0),setTimeout((function(){BackToList(),member_list.component.refresh()}),1e3)})).fail((function(){Coker.sweet.error("錯誤",a,null,!0)}))}function DataSave(){BasicInfoFilled=FormCheck(BasicInfoForm),LoginMailFilled=FormCheck(LoginMailForm),PassIsCheck=PassCheck(),BasicInfoFilled&&LoginMailFilled&&PassIsCheck?Coker.sweet.confirm("即將儲存","確認儲存會員資料?","儲存","取消",(function(){Update("資料儲存成功","資料儲存發生未知錯誤")})):Coker.sweet.error("資料填寫有誤","請確認填寫資料是否正確",null,!1)}function FormCheck(e){var a=!1;return Array.from(e).forEach((e=>{e.checkValidity()&&(a=!0),e.classList.add("was-validated")})),a}function PassCheck(){$btn_newpass_lock.addClass("pe-4"),$btn_checkpass_lock.addClass("pe-4");if($newpass.addClass("is-invalid"),$passcheck.addClass("is-invalid"),$newpass.val().length>=6)if(/\d+/.test($newpass.val())&&/[a-zA-Z]+/.test($newpass.val())&&!/[^\a-\z\A-\Z0-9]/g.test($newpass.val())){if($newpass.removeClass("is-invalid"),$newpass.addClass("is-valid"),$passcheck.val()==$newpass.val())return $passcheck.removeClass("is-invalid"),$passcheck.addClass("is-valid"),!0;$CheckPassFeedBack.text("密碼不相符")}else $NewPassFeedBack.text("密碼格式有誤"),$CheckPassFeedBack.text("密碼格式有誤");else{if(0==$newpass.val().length&&0==$passcheck.val().length)return $newpass.removeClass("is-invalid"),$passcheck.removeClass("is-invalid"),$newpass.removeClass("is-valid"),$passcheck.removeClass("is-valid"),$btn_newpass_lock.removeClass("pe-4"),$btn_checkpass_lock.removeClass("pe-4"),!0;$NewPassFeedBack.text("請輸入6個以上的字元"),$CheckPassFeedBack.text("密碼格式有誤")}return!1}function mail_lock(e){var a=e.children("span");LoginMailFilled=FormCheck(LoginMailForm),!isMailLock&&""!=$email_login.val()&&LoginMailFilled?(a.text("lock"),$email_login.attr("disabled","disabled"),isMailLock=!0,$btn_mail_lock.removeClass("pe-4")):(a.text("lock_open"),$email_login.removeAttr("disabled"),isMailLock=!1,$btn_mail_lock.addClass("pe-4"))}function PassDisplay(e,a){var s=e.children("span");return a?(s.text("visibility_off"),e.siblings("input").attr("type","password"),a=!1):(s.text("visibility"),e.siblings("input").attr("type","text"),a=!0),a}function MoveToContent(){$(".btn_back").addClass("d-flex"),$(".btn_save").removeClass("d-none"),$("#MemberList").addClass("d-none"),$("#MemberContent").removeClass("d-none")}function BackToList(){$(".btn_back").removeClass("d-flex"),$(".btn_save").addClass("d-none"),$("#MemberList").removeClass("d-none"),$("#MemberContent").addClass("d-none"),window.location.hash=""}function ManagementDataCollapse(){$this_body=$("body > .wrapper > .content-area > .content-wrapper"),$OrderDetails=$("#MainBlock"),$ManagementData=$("#SideBlock"),$this_body.width()>=1024?($("#Btn_Side_Collapse").addClass("d-none"),$OrderDetails.removeClass("col-12"),$ManagementData.addClass("col-3"),$ManagementData.removeClass("offcanvas offcanvas-end visible"),$ManagementData.css("visibility","")):($("#Btn_Side_Collapse").removeClass("d-none"),$OrderDetails.addClass("col-12"),$ManagementData.addClass("offcanvas offcanvas-end visible"),$ManagementData.removeClass("col-3"))}function OrderDetailsPosition(){$("#SideBlock").width()<280?$(".order_data").each((function(){$(this).children("a").removeClass("position-absolute")})):$(".order_data").each((function(){$(this).children("a").addClass("position-absolute")}))}function TWZipCodeInit(){var e,a;$TWzipcode=$("#TWzipcode"),$TWzipcode.twzipcode({zipcodeIntoDistrict:!0}),e=$TWzipcode.children(".county"),a=$TWzipcode.children(".district"),e.children("select").attr({id:"SelectCity",class:"city form-select",required:"required"}),e.append("<label class='px-4 required' for='SelectCity'>縣市</label>");var s=e.children("select").children("option").first();s.text("請選擇縣市"),s.attr("disabled","disabled"),a.children("select").attr({id:"SelectTown",class:"town form-select",required:"required"}),a.append("<label class='required' for='SelectTown'>鄉鎮</label>");var n=a.children("select").children("option").first();n.text("請選擇鄉鎮"),n.attr("disabled","disabled")}