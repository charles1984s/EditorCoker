var $check_sort,$target,$date,$picker,$permanent,$Visible,startDate,endDate,keyId,enterAd_list,disp_opt=!0;let AdForm;function PageReady(){ImageUploadModalInit($("#ImageUpload")),ElementInit(),$picker=$("#InputDate"),co.Picker.Init($picker),$picker.on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("YYYY/MM/DD HH:mm")+" ~ "+t.endDate.format("YYYY/MM/DD HH:mm")),startDate=t.startDate.format(""),endDate=t.endDate.format("")}));const e=$("#AdForm");Array.from(e).forEach((e=>{e.addEventListener("submit",(t=>{e.checkValidity()?(t.preventDefault(),$("#ImageUpload").find(".img_input").length<=1?co.sweet.error("資料有誤","至少需上傳一張圖片",null,!1):Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp("已成功發布","發布發生未知錯誤")}))):(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated"),WasValidated()}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回廣告列表","資料將不被保存","確定","取消",(function(){BackToList(),FormDataClear()}))})),$(".btn_add").on("click",(function(){window.location.hash=0,HashDataEdit()})),$Visible.on("click",(function(){$Visible.val($Visible.prop("checked"))})),$permanent.on("click",(function(){$permanent.is(":checked")?($date.val(""),$date.prop("disabled",!0),startDate=null,endDate=null):$date.prop("disabled",!1)})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){AdForm=$("#AdForm"),$Visible=$("#AdFormVisible"),$check_sort=$("#AdvertiseSortCheck"),$input_sort=$("#AdvertiseSerNO"),$target=$("#TargetCheck"),$date=$("#InputDate"),$permanent=$("#PermanentCheck")}function contentReady(e){enterAd_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");0==parseInt(e)?MoveToContent():co.Advertise.GetDataOne(parseInt(e)).done((function(e){null!=e?(MoveToContent(),FormDataSet(e)):window.location.hash=""}))}}else BackToList()}function editButtonClicked(e){MoveToContent(),keyId=e.row.key,window.location.hash=keyId}function FormDataSet(e){FormDataClear(),console.log(e),co.File.getImgFile({Sid:e.id,Type:7,Size:1}).done((function(e){if(e.length>0)for(var t=e.length-1;t>-1;t--)ImageUploadModalDataInsert($("#ImageUpload"),e[t].id,e[t].link,e[t].name)})),keyId=e.id,e.startEndDate=0,e.sortCheckbox=1,co.Form.insertData(e,"#AdForm"),$Visible.val(e.visible),$Visible.prop("checked",e.visible)}function FormDataClear(){ImageUploadModalClear($("#ImageUpload")),co.Form.clear("AdForm"),$("#AdForm > input[name='id'").val(""),$Visible.prop("checked",!1),$Visible.val(!1),$check_sort.prop("checked",!1),$input_sort.prop("disabled",!0),$input_sort.val(""),$date.prop("disabled",!0)}function deleteButtonClicked(e){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Advertise.Delete(e.row.key).done((function(t){t.success?e.component.refresh():Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)})).fail((function(){Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)}))}))}function AddUp(e,t){const a=co.Form.getJson($(AdForm).attr("id"));a.type=1,void 0!==$("#ImageUpload").find(".img_input_frame").data("delectList")&&null!=$("#ImageUpload").find(".img_input_frame").data("delectList")&&co.File.DeleteFileById({sid:keyId,type:7,fid:$("#ImageUpload").find(".img_input_frame").data("delectList")}),co.Advertise.AddUp(a).done((function(a){if(a.success){var n=0,o=0,i=0;$("#ImageUpload .img_input_frame > .img_input").each((function(){var e=$(this);if(void 0!==e.data("file")&&0==e.data("file").id){n++;var t=new FormData;t.append("type",7),t.append("sid",a.message),t.append("serno",500),t.append("files",e.data("file").File),co.File.Upload(t).done((function(e){e.success?o++:i++}))}}));const r=function(){n==o+i?i>0?Coker.sweet.error("錯誤",t,null,!0):(Coker.sweet.success(e,null,!0),setTimeout((function(){BackToList(),FormDataClear(),enterAd_list.component.refresh()}),1e3)):setTimeout(r,100)};setTimeout(r,100)}else Coker.sweet.error("錯誤",t,null,!0)})).fail((function(){Coker.sweet.error("錯誤",t,null,!0)}))}function MoveToContent(){UnValidated(),$("#EnterAdList").addClass("d-none"),$("#EnterAdContent").removeClass("d-none")}function BackToList(){$("#EnterAdList").removeClass("d-none"),$("#EnterAdContent").addClass("d-none"),window.location.hash=""}function WasValidated(){$(".icon_hint").addClass("pe-4"),$check_sort.parents(".checkbox").first().addClass("pe-4"),$target.parents(".checkbox").first().addClass("pe-4"),$permanent.parents(".checkbox").first().addClass("pe-4")}function UnValidated(){$("#AdForm").removeClass("was-validated"),$(".icon_hint").removeClass("pe-4"),$check_sort.parents(".checkbox").first().removeClass("pe-4"),$target.parents(".checkbox").first().removeClass("pe-4"),$permanent.parents(".checkbox").first().removeClass("pe-4")}