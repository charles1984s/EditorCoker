grapesjs.plugins.add("grapesjs-Coker6",((e,t)=>{let n={save:function(){return!1},import:function(){return!1},getComponer:function(){return!1},asset:[],iconPickerOpt:{cols:4,rows:4,footer:!1,iconset:"GoogleMaterialSymbolsOutlined"}};$.extend(!0,n,t);const o=e.AssetManager,s=e.BlockManager.getCategories(),l=e.BlockManager,a=e.Panels;e.I18n.setMessages({tw:tw}),o.addType("image",{view:{attributes:{Guid:"custom-value"}}}),e.on("asset:add",(e=>{})),e.on("run:open-assets",(()=>{const t=e.Modal.getContentEl(),n=(t.querySelector(".gjs-am-file-uploader"),t.querySelector(".gjs-am-assets-header")),o=t.querySelector(".gjs-am-assets-cont");if(!t.querySelector(".gjs-am-assets-filter")){const e=$('\n                <div class="input-group mb-3 gjs-am-assets-filter">\n                    <input type="text" class="form-control" placeholder="搜尋檔案名稱" aria-label="搜尋檔案名稱" aria-describedby="button-addon2">\n                    <button class="btn btn-outline-secondary" type="button" id="button-addon2">\n                        <span class="material-symbols-outlined">search</span>\n                    </button>\n                </div>\n            ');e.find(".btn").on("click",(()=>{const t=e.children('[type="text"]').val();""==t?$(".gjs-am-asset-image").removeClass("d-none"):$(".gjs-am-asset-image").each((function(){const e=$(this);e.find(".gjs-am-dimensions").text().indexOf(t)<0?e.addClass("d-none"):e.removeClass("d-none")}))})),n.style.display="none",o.insertBefore(e[0],n)}})),e.on("asset:remove",(e=>{const t=e.get("guid");co.File.Delete(t).done((function(e){console.log(e)}))})),co.File.getFileList(0).done((function(t){if(t.success){var o=[];n.asset=t.files,$(t.files).each((function(e){o.push({src:this.path,name:`${this.name}`,guid:this.guid})}));var s=o;e.AssetManager.add(s)}})),e.DomComponents.addType("link",{isComponent:e=>"A"==e.tagName,model:{defaults:{traits:[{name:"title",type:"text",label:"名稱",placeholder:"請輸入連結名稱"},{name:"href",type:"text",label:"超連結",placeholder:"請輸入連結位子"},{name:"file",type:"button",text:"選擇檔案",command:e=>{o.open(),o.onSelect((t=>{e.getSelected().set("attributes",{href:t.id}),o.close()}))}},{name:"target",type:"select",label:"開啟方式",options:[{id:"_self",name:"直接連結"},{id:"_blank",name:"另開視窗",label:"另開視窗"}]}]}}});var i=setInterval((function(){s.models.length>1&&(clearInterval(i),$(s.models).each((function(e,t){t.set("open",0==e).on("change:open",(function(e){e.get("open")&&s.each((t=>{t!==e&&t.set("open",!1)}))}))})))}),500),c=function(){h.show()},d="default",r=e.DomComponents.getType(d),m=e.DomComponents.getType(d).model;e.DomComponents.addType(d,{model:{initToolbar(){m.prototype.initToolbar.apply(this,arguments);const e=this.get("toolbar");e.some((e=>e.command===c))||(e.unshift({command:c,label:'<i class="fa fa-star"></i>'}),this.set("toolbar",e))}},view:r.view.extend({events:{dblclick:"editLink"},editLink:function(t){t.stopImmediatePropagation(),e.runCommand(c,{})}})}),n.getComponer().done((function(e){$(e).each((function(){const e=`${co.Data.HtmlDecode(this.html)}<style>${this.css}</style>`;let t="customBlockTemplate_"+this.id,n=this.icon.replace("material-symbols-outlined","").trim(),o="";/^fa/.test(this.icon)?o=`<i class="${this.icon} fa-5x"></i>`:/material-symbols-outlined/.test(this.icon)&&(o=`<i class="material-icons material-symbols-outlined fa-5x">${n}</i>`),v(t,{category:this.typeName,attributes:{custom_block_template:!0},label:`${this.title}`,media:o,content:e})}))}));const u=t=>{const n=t.getEl(),o=t.getId(),s=n.classList,l=e.CssComposer.getRule(`#${o}`),a=e.CssComposer.getRule(`#${o}:hover`);let i="";return $(s).each((function(){if(this){const t=this.toString(),n=e.CssComposer.getRule(`.${t}`),o=e.CssComposer.getRule(`.${t}:hover`);n&&(i=`${i} ${n.toCSS()}`),o&&(i=`${i} ${o.toCSS()}`)}})),l?(a&&(i=`${l.toCSS()} ${a.toCSS()} ${i}`),i=`${l.toCSS()} ${i}`):i},p=function(e){let t="";if(e){const n=e.components().models;if(n){for(const e of n)t+=p(e);return t+u(e)}return u(e)}};let f=null;const b=function(e){let t;return{getInstance:function(){return t||(t=function(){const t=document.createElement("ul");t.classList.add("custom-context-menu");const{menus:n}=e;if(n&&n.length>0)for(let e of n){const n=document.createElement("li");n.textContent=e.name,n.onclick=e.onClick,t.appendChild(n)}return document.querySelector("body").appendChild(t),t}()),t}}}({menus:[{name:"加入至頁面",onClick:function(t){const n=l.get(f);e.addComponents(n.attributes.content)}},{name:"刪除元件",onClick:function(e){g()}}]});function g(){const e=f.split("_"),t=e[e.length-1];console.log(t),co.HtmlContent.Delete(t).done((function(e){e.success?(l.remove(f),co.sweet.success("成功",null,!0)):co.sweet.error(e.error)}))}document.addEventListener("click",(function(e){b.getInstance().style.display="none"}));const v=function(e,t){const n=`customBlockTemplate_${e}`;var o={type:"default",render:({model:e,el:o})=>{o.addEventListener("dblclick",(()=>{co.sweet.confirm("即將刪除",co.sweet.TitleHilight("是否要確認將{0}刪除?",t.label),"確認","取消",(function(){f=n,g()}))})),o.addEventListener("contextmenu",(e=>{e.preventDefault(),f=n,function(e){const t=b.getInstance();t.style.top=`${e.clientY}px`,t.style.left=`${e.clientX}px`,t.style.display="block"}(e)}))}};$.extend(!0,o,t),l.add(n,o)},y=function(){const t=e.getSelected();let n=$("#NewBlockName").val()||"新增";co.HtmlContent.AddUp({Title:n,Type:$("#ComponerTypeList>option:selected").val()}).done((function(e){if(e.success){let o="customBlockTemplate_"+e.message.split(" ").join("_"),s={id:e.message,name:n,blockId:o};!function(e,t){const n=t.blockId,o=t.name;let s=$(e.getEl().outerHTML).removeClass("gjs-selected")[0].outerHTML,l=s.substring(0,s.indexOf(" ")),a=s.substring(s.indexOf(" ")+1);l+=` custom_block_template=true block_id="${n}" `;let i=l+a,c=$("#NewBlockicon").val();const d=p(e),r=i+`<style>${d}</style>`,m=$("#ComponerTypeList>option:selected").text(),u={id:t.id,Title:o,icon:c,type:$("#ComponerTypeList>option:selected").val(),Html:$("<div/>").text(i).html(),css:d};co.HtmlContent.AddUp(u).done((function(e){if(e.success){let e="";/material-symbols-outlined/.test(c)&&(e=c.replace("material-symbols-outlined","").trim()),v(n,{category:m,attributes:{custom_block_template:!0},label:`${o}`,media:`<i class="${c} fa-5x">${e}</i>`,content:r})}else co.sweet.error(e.error)}))}(t,s),document.getElementById("ComFrm").reset()}else co.sweet.error(e.error)}))};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const h=new bootstrap.Modal("#setComponents"),C=$("#NewBlockicon").iconpicker(n.iconPickerOpt);co.HtmlContent.GetTypeList().done((function(e){if(e.success){var t=$("#ComponerTypeList");$(e.type).each((function(){t.append(`<option value="${this.value}">${this.key}</option>`)})),e.type.length>1&&t.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){y(),h.hide(),co.sweet.success("加入我的最愛")})),C.on("change",(function(e){$("#NewBlockicon").val(e.icon)})),null!=n.save&&a.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(e){n.save(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),null!=n.import&&a.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(e){n.import(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1})}));