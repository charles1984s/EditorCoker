grapesjs.plugins.add("grapesjs-Coker6",((e,t)=>{let n={save:function(){return!1},import:function(){return!1},getComponer:function(){return!1},asset:[],iconPickerOpt:{cols:4,rows:4,footer:!1,iconset:"GoogleMaterialSymbolsOutlined"}};$.extend(!0,n,t),e.settings=n;const o=e.AssetManager,a=e.BlockManager.getCategories(),s=e.BlockManager,i=e.Panels;e.I18n.setMessages({tw:tw}),o.addType("image",{view:{attributes:{Guid:"custom-value"}}}),setInterval((()=>{"undefined"!=typeof CKEDITOR&&(CKEDITOR.dtd.$editable.a=1,CKEDITOR.dtd.$editable.p=1,CKEDITOR.dtd.$editable.span=1,CKEDITOR.dtd.$editable.li=1,CKEDITOR.dtd.$editable.strong=1,CKEDITOR.dtd.$editable.div=1,CKEDITOR.dtd.$removeEmpty.span=0,CKEDITOR.dtd.$removeEmpty.i=0)}),200),e.on("run:modal-open:modalckeditor",(function(){console.log("in")})),e.on("asset:add",(e=>{})),e.on("run:open-assets",(()=>{const t=e.Modal.getContentEl(),n=(t.querySelector(".gjs-am-file-uploader"),t.querySelector(".gjs-am-assets-header")),o=t.querySelector(".gjs-am-assets-cont");if(!t.querySelector(".gjs-am-assets-filter")){const e=$('\n                <div class="input-group mb-3 gjs-am-assets-filter">\n                    <input type="text" class="form-control" placeholder="搜尋檔案名稱" aria-label="搜尋檔案名稱" aria-describedby="button-addon2">\n                    <button class="btn btn-outline-secondary" type="button" id="button-addon2">\n                        <span class="material-symbols-outlined">search</span>\n                    </button>\n                </div>\n            ');e.find(".btn").on("click",(()=>{const t=e.children('[type="text"]').val();""==t?$(".gjs-am-asset-image").removeClass("d-none"):$(".gjs-am-asset-image").each((function(){const e=$(this);e.find(".gjs-am-dimensions").text().indexOf(t)<0?e.addClass("d-none"):e.removeClass("d-none")}))})),n.style.display="none",o.insertBefore(e[0],n)}})),e.on("asset:remove",(e=>{const t=e.get("guid");co.File.Delete(t).done((function(e){console.log(e)}))}));e.Commands.add("tlb-settime",(e=>{g.show()})),e.on("component:selected",(()=>{const t="tlb-settime",n=e.getSelected(),o=n.get("toolbar");o.some((e=>e.command===t))||n.set({toolbar:[...o,{attributes:{class:"fa fa-star"},command:t}]})})),e.DomComponents.addType("連結",{isComponent:e=>"A"==e.tagName,model:{defaults:{traits:[{name:"title",type:"text",label:"名稱",placeholder:"請輸入連結名稱"},{name:"href",type:"text",label:"超連結",placeholder:"請輸入連結位子"},{name:"file",type:"button",text:"選擇檔案",command:e=>{o.open(),o.onSelect((t=>{e.getSelected().set("attributes",{href:t.id}),o.close()}))}},{name:"target",type:"select",label:"開啟方式",options:[{id:"_self",name:"直接連結"},{id:"_blank",name:"另開視窗",label:"另開視窗"}]}]}}}),e.DomComponents.addType("檔案下載",{isComponent:e=>e.classList?.contains("link_with_icon"),model:{defaults:{traits:[{name:"download",type:"text",label:"檔案名稱",placeholder:"請輸入檔案名稱"},{name:"file",type:"button",text:"選擇檔案",command:e=>{o.open(),o.onSelect((t=>{var n=$(".gjs-frame")[0].contentWindow.LinkWithIconInit;e.getSelected().set("attributes",{href:t.id}),n(),o.close()}))}}]},init(){this.on("change:attributes:download",(function(e){e.find(".name")[0].components(e.getAttributes().download)}))}},view:{init(){this.setLink()},setLink:function(){setTimeout((function(){(0,$(".gjs-frame")[0].contentWindow.LinkWithIconInit)()}),100)}}}),e.DomComponents.addType("輪播",{isComponent:e=>e.classList?.contains("one_swiper")||e.classList?.contains("two_swiper")||e.classList?.contains("four_swiper")||e.classList?.contains("six_swiper"),model:{defaults:{traits:[{name:"swiper-slide",type:"button",text:"新增一欄",command:e=>{var t=e.getSelected(),n=t.find(".swiper")[0].getEl().swiper,o=$("<div>").append($(t.find(".template_slide>.swiper-slide")[0].toHTML())).html();t.find(".swiper-wrapper")[0].append(o),n.update()}},{type:"button",text:"開啟編輯",command:e=>{var t=$(e.getSelected().getEl());t.find(".swiper-slide").length>0&&$("#SwiperModal").length<1&&$('<div class="modal fade" id="SwiperModal" tabindex="-1" aria-labelledby="SwiperModalLabel" aria-hidden="true">\n                                          <div class="modal-dialog">\n                                            <div class="modal-content">\n                                              <div class="modal-header">\n                                                <h1 class="modal-title fs-5" id="SwiperModalLabel">輪播編輯</h1>\n                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                                              </div>\n                                              <div class="modal-body">\n                                                    <ul id="SwiperList" class="px-0"></ul>\n                                                    <template id="TemplateSwiperList">\n                                                        <li class="bg-white d-flex mb-3 border p-2 border-dark rounded">\n                                                            <img class="me-2" src="" alt="" />\n                                                            <div class="align-self-center">\n                                                                <div class="img_alt"></div>\n                                                                <div class="a_href"></div>\n                                                                <div class="a_title"></div>\n                                                            </div>\n                                                        </li>\n                                                    </template>\n                                              </div>\n                                              <div class="modal-footer">\n                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>\n                                                <button type="button" class="btn btn-primary sava">完成編輯</button>\n                                              </div>\n                                            </div>\n                                          </div>\n                                        </div>\n                                        <style>\n                                            #SwiperModal img {\n                                                   max-width: 100px;\n                                            }\n                                        </style>\n                                    ').appendTo("body");var n=$("#SwiperList"),o=[];t.find(".swiper-slide").each((function(){var e=$(this);if(!e.parent().hasClass("template_slide")){var t={href:e.find("a").attr("href"),title:e.find("a").attr("title"),src:e.find("img").attr("src"),alt:e.find("img").attr("alt")};o.push(t)}})),n.empty(),$.each(o,(function(e,t){var o=$($("#TemplateSwiperList").html()).clone();o.find("img").attr({src:t.src,alt:t.alt}),o.find(".img_alt").text(t.alt),o.find(".a_href").text(t.href),o.find(".a_title").text(t.title),o.data("order",e),n.append(o)})),$("#SwiperList").sortable();var a=new bootstrap.Modal("#SwiperModal");a.show(),$("#SwiperModal .sava").on("click",(function(){const e=t.clone(),n=e.find(".swiper-slide").clone(),o=e.find(".swiper-wrapper");o.empty(),$("#SwiperList li").each((function(e,t){o.append(n[$(t).data("order")])})),a.hide()}))}}]}}}),e.DomComponents.addType("輪播容器",{isComponent:e=>e.classList?.contains("image_link_slide"),model:{defaults:{removable:!0,editable:!1}}}),e.DomComponents.addType("QA元件",{isComponent:e=>e.classList?.contains("qa"),model:{defaults:{droppable:!1,copyable:!1},init(){const e=this,t=e.ccid,n=$(".gjs-frame")[0].contentWindow.$;window.setTimeout((function(){const o=e.find("a.btn")[0],a=e.find(".collapse")[0];o.addAttributes({href:`#${t}_content`,Title:"展開QA"}),a.addAttributes({id:`${t}_content`}),n(`#${t} a`).attr({"data-bs-toggle":""})}),200)}}}),e.DomComponents.addType("名片介紹",{isComponent:e=>e.classList?.contains("frame_type_2"),model:{defaults:{droppable:!1,copyable:!1},init(){}}}),e.DomComponents.addType("名片介紹",{isComponent:e=>e.classList?.contains("frame_type_2"),model:{defaults:{droppable:!1,copyable:!1},init(){}}}),e.DomComponents.addType("活動列表",{isComponent:e=>e.classList?.contains("articletype"),model:{defaults:{droppable:!1,copyable:!1,traits:[{name:"data-dateRange",type:"date-range",label:"起訖日期"},{name:"data-location",type:"text",label:"地點",placeholder:"請輸入地點"},{name:"data-addr",type:"text",label:"地址",placeholder:"請輸入地址"},{name:"data-link",type:"text",label:"連結",placeholder:"請輸入連結"},{name:"data-organizer",type:"text",label:"主辦單位",placeholder:"請輸入主辦單位"},{name:"data-a-organizer",type:"text",label:"協辦單位",placeholder:"請輸入協辦單位"},{name:"data-r-organizer",type:"text",label:"執行單位",placeholder:"請輸入執行單位"},{name:"data-tel",type:"text",label:"電話",placeholder:"請輸入電話"}]},init(){const e=this,t=function(){setTimeout((()=>{var n=$(".gjs-frame")[0].contentWindow.date_input_change;void 0===n?t():e.components(n(e.getId()))}),200)};e.on("change:attributes",t),t()}}}),e.TraitManager.addType("date-range",{createInput({trait:t}){const n=document.createElement("div");n.innerHTML='\n              <div class="date-range-inputs">\n                <input type="text" class="date-range" pattern="[1-9]d{3}/d{2}/d{2} d{2}:d{2} ~ [1-9]d{3}/d{2}/d{2} d{2}:d{2}" />\n              </div>\n            ';const o=$(n).find(".date-range");return co.Picker.Init(o),o.data("daterangepicker").setStartDate(Date.now),o.on("change",(function(){e.getSelected().addAttributes({"date-dateRange":this.value})})),n}}),e.DomComponents.addType("子頁內容",{isComponent:e=>e.classList?.contains("subpage_content"),model:{defaults:{droppable:!1,editable:!1,copyable:!1}}});var l=null;e.DomComponents.addType("目錄",{isComponent:e=>e.classList?.contains("menu_directory")||e.classList?.contains("catalog_frame"),model:{defaults:{droppable:!1,editable:!1,copyable:!1,traits:[{name:"id",type:"text",label:"ID",placeholder:"元件ID名稱"},{name:"data-diridname",type:"text",label:"目錄名稱",placeholder:"尚未關聯目錄"},{name:"data-dirid",type:"button",text:"設置目錄",command:e=>{var t=null;l||((l=$("#PopupDirectory").dxPopup("instance")).option("contentTemplate",$("#PopupDirectory-template")),l.option("title","設置目錄"),window.DirectoryList_SelectChange=function(e){t=e.selectedRowsData[0]},window.setTimeout((function(){$("#PopupDirectory .cancel").on("click",(function(){l.hide()})),$("#PopupDirectory .Sure").on("click",(function(){e.getSelected().set("attributes",{"data-dirid":t.Id,"data-diridname":t.Title}),l.hide(),$(".gjs-frame")[0].contentWindow.DirectoryGetDataInit()}))}),200)),l.show()}},{name:"data-shownum",type:"text",label:"單頁筆數",placeholder:"一個分頁要抓幾筆資料"},{name:"data-maxlen",type:"text",label:"最大筆數",placeholder:"該目錄僅抓幾筆資料"}]},init(){this.on("change:attributes:data-shownum",(e=>{setTimeout((()=>{const t=$(".gjs-frame")[0].contentWindow;let n=e.getAttributes();t.$(`#${e.getId()}`).data({prevdirid:n["data-prevdirid"],shownum:n["data-shownum"]}),t.DirectoryGetDataInit()}),200)})),this.on("change:attributes:data-maxlen",(e=>{setTimeout((()=>{const t=$(".gjs-frame")[0].contentWindow;let n=e.getAttributes();t.$(`#${e.getId()}`).data({prevdirid:n["data-prevdirid"],maxlen:n["data-maxlen"]}),t.DirectoryGetDataInit()}),200)}))}}}),e.DomComponents.addType("格列切換控制",{isComponent:e=>e.classList?.contains("switch_control"),model:{defaults:{droppable:!1,copyable:!1,traits:[{type:"checkbox",label:"文字",name:"btn_text",valueTrue:"1",valueFalse:"0"},{type:"checkbox",label:"圖片",name:"btn_grid",valueTrue:"1",valueFalse:"0"},{type:"checkbox",label:"圖文",name:"btn_list",valueTrue:"1",valueFalse:"0"}]},init(){for(var e=this,t=["btn_text","btn_grid","btn_list"],n=0;n<t.length;n++){const o=t[n];e.on(`change:attributes:${o}`,(()=>{e.components().models.forEach((function(t){t.getClasses().indexOf(o)>=0&&(t.getClasses().indexOf("d-none")>=0?(t.removeClass("d-none"),setTimeout((()=>{(0,$(".gjs-frame")[0].contentWindow.namecontrol)(e.getId())}),200)):(t.addClass("d-none"),setTimeout((()=>{(0,$(".gjs-frame")[0].contentWindow.namecontrol)(e.getId())}),200)))}))}))}}}});const d=e.DomComponents.getType("text");e.DomComponents.addType("span",{model:d.model.extend({},{isComponent(e){if("SPAN"===e.tagName)return{type:"text",src:e.src,tagName:e.tagName.toLowerCase(),content:e.innerHTML,editable:!0}}}),view:d.view}),e.DomComponents.addType("動畫背景",{isComponent:e=>e.classList?.contains(".BGCanvas"),model:{defaults:{droppable:!1,copyable:!1},init(){const e=this.ccid,t=$(".gjs-frame")[0].contentWindow.$;window.setTimeout((function(){console.log("in"),t(`#${e}`).BGCanvas()}),200)}}});e.on("load",(()=>{$(a.models).each((function(e,t){t.set("open",0==e).on("change:open",(function(e){e.get("open")&&a.each((t=>{t!==e&&t.set("open",!1)}))}))}))})),n.getComponer().done((function(e){$(e).each((function(){const e=`${co.Data.HtmlDecode(this.html)}<style>${this.css}</style>`;let t="customBlockTemplate_"+this.id,n=this.icon.replace("material-symbols-outlined","").trim(),o="";/^fa/.test(this.icon)?o=`<i class="${this.icon} fa-5x"></i>`:/material-symbols-outlined/.test(this.icon)&&(o=`<i class="material-symbols-outlined fa-5x">${n}</i>`),f(t,{category:this.typeName,attributes:{custom_block_template:!0},label:`${this.title}`,media:o,content:e})}))}));const c=t=>{const n=t.getEl(),o=t.getId(),a=n.classList,s=e.CssComposer.getRule(`#${o}`),i=e.CssComposer.getRule(`#${o}:hover`);let l="";return $(a).each((function(){if(this){const t=this.toString(),n=e.CssComposer.getRule(`.${t}`),o=e.CssComposer.getRule(`.${t}:hover`);n&&(l=`${l} ${n.toCSS()}`),o&&(l=`${l} ${o.toCSS()}`)}})),s?(i&&(l=`${s.toCSS()} ${i.toCSS()} ${l}`),l=`${s.toCSS()} ${l}`):l},r=function(e){let t="";if(e){const n=e.components().models;if(n){for(const e of n)t+=r(e);return t+c(e)}return c(e)}};let m=null;const p=function(e){let t;return{getInstance:function(){return t||(t=function(){const t=document.createElement("ul");t.classList.add("custom-context-menu");const{menus:n}=e;if(n&&n.length>0)for(let e of n){const n=document.createElement("li");n.textContent=e.name,n.onclick=e.onClick,t.appendChild(n)}return document.querySelector("body").appendChild(t),t}()),t}}}({menus:[{name:"加入至頁面",onClick:function(t){const n=s.get(m);e.addComponents(n.attributes.content)}},{name:"刪除元件",onClick:function(e){u()}}]});function u(){const e=m.split("_"),t=e[e.length-1];console.log(t),co.HtmlContent.Delete(t).done((function(e){e.success?(s.remove(m),co.sweet.success("成功",null,!0)):co.sweet.error(e.error)}))}document.addEventListener("click",(function(e){p.getInstance().style.display="none"}));const f=function(e,t){const n=`customBlockTemplate_${e}`;var o={type:"default",render:({model:e,el:o})=>{o.addEventListener("dblclick",(()=>{co.sweet.confirm("即將刪除",co.sweet.TitleHilight("是否要確認將{0}刪除?",t.label),"確認","取消",(function(){m=n,u()}))})),o.addEventListener("contextmenu",(e=>{e.preventDefault(),m=n,function(e){const t=p.getInstance();t.style.top=`${e.clientY}px`,t.style.left=`${e.clientX}px`,t.style.display="block"}(e)}))}};$.extend(!0,o,t),s.add(n,o)},b=function(){const t=e.getSelected();let n=$("#NewBlockName").val()||"新增";co.HtmlContent.AddUp({Title:n,Type:$("#ComponerTypeList>option:selected").val()}).done((function(e){if(e.success){let o="customBlockTemplate_"+e.message.split(" ").join("_"),a={id:e.message,name:n,blockId:o};!function(e,t){const n=t.blockId,o=t.name;let a=$(e.getEl().outerHTML).removeClass("gjs-selected")[0].outerHTML,s=a.substring(0,a.indexOf(" ")),i=a.substring(a.indexOf(" ")+1);s+=` custom_block_template=true block_id="${n}" `;let l=s+i,d=$("#NewBlockicon").val();const c=r(e),m=l+`<style>${c}</style>`,p=$("#ComponerTypeList>option:selected").text(),u={id:t.id,Title:o,icon:d,type:$("#ComponerTypeList>option:selected").val(),Html:$("<div/>").text(l).html(),css:c};co.HtmlContent.AddUp(u).done((function(e){if(e.success){let e="";/material-symbols-outlined/.test(d)&&(e=d.replace("material-symbols-outlined","").trim()),f(n,{category:p,attributes:{custom_block_template:!0},label:`${o}`,media:`<i class="${d} fa-5x">${e}</i>`,content:m})}else co.sweet.error(e.error)}))}(t,a),document.getElementById("ComFrm").reset()}else co.sweet.error(e.error)}))};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const g=new bootstrap.Modal("#setComponents"),y=$("#NewBlockicon").iconpicker(n.iconPickerOpt);co.HtmlContent.GetTypeList().done((function(e){if(e.success){var t=$("#ComponerTypeList");$(e.type).each((function(){t.append(`<option value="${this.value}">${this.key}</option>`)})),e.type.length>1&&t.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){b(),g.hide(),co.sweet.success("加入我的最愛")})),y.on("change",(function(e){$("#NewBlockicon").val(e.icon)})),null!=n.save&&i.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(e){n.save(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),null!=n.import&&i.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(e){n.import(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1}),e.on("component:clone",(t=>{const n=document.getElementsByClassName("gjs-frame")[0].contentWindow,o=t.getClasses();if(t.setAttributes({id:"id","data-key":""}),o.indexOf("anchor_title")>-1){var a=n.document.getElementsByClassName("anchor_title").length;const e=function(){n.document.getElementsByClassName("anchor_title").length!=a?n.AnchorPointInit():setTimeout(e,100)};setTimeout(e,100)}else if(o.indexOf("swiper-slide")>-1){var s=e.getSelected().parent().parent().getEl().swiper;if(void 0!==s){a=n.document.getElementsByClassName("swiper-slide").length;const e=function(){n.document.getElementsByClassName("swiper-slide").length!=a?s.update():setTimeout(e,100)};setTimeout(e,100)}}else if(o.indexOf("one_swiper")>-1||o.indexOf("two_swiper")>-1||o.indexOf("four_swiper")>-1||o.indexOf("six_swiper")>-1){a=n.document.getElementsByClassName("swiper").length;const e=function(){n.document.getElementsByClassName("swiper").length!=a?n.SwiperInit({autoplay:!1}):setTimeout(e,100)};setTimeout(e,100)}})),e.on("component:remove",(t=>{const n=document.getElementsByClassName("gjs-frame")[0].contentWindow,o=t.getClasses();if(t.setAttributes({id:"id","data-key":""}),o.indexOf("anchor_title")>-1){var a=n.document.getElementsByClassName("anchor_title").length;const e=function(){n.document.getElementsByClassName("anchor_title").length!=a?n.AnchorPointInit():setTimeout(e,100)};setTimeout(e,100)}else if(o.indexOf("swiper-slide")>-1&&void 0!==e.getSelected()){var s=e.getSelected().parent().parent().getEl().swiper;if(void 0!==s){a=n.document.getElementsByClassName("swiper-slide").length;const e=function(){n.document.getElementsByClassName("swiper-slide").length!=a?s.update():setTimeout(e,100)};setTimeout(e,100)}}})),e.on("component:drag:end",(e=>{const t=e.target.getClasses(),n=document.getElementsByClassName("gjs-frame")[0].contentWindow;if(t.indexOf("anchor_title")>-1)n.AnchorPointInit();else if(t.indexOf("swiper-slide")>-1){e.target.parent().parent().getEl().swiper.update()}else(t.indexOf("one_swiper")>-1||t.indexOf("two_swiper")>-1||t.indexOf("four_swiper")>-1||t.indexOf("six_swiper")>-1)&&n.SwiperInit({autoplay:!1})}))}));