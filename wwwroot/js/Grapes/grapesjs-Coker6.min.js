var $gjs_select=null;grapesjs.plugins.add("grapesjs-Coker6",((e,t)=>{let n={save:function(){return!1},import:function(){return!1},getComponer:function(){return!1},asset:[],iconPickerOpt:{cols:4,rows:4,footer:!1,iconset:"GoogleMaterialSymbolsOutlined"}};$.extend(!0,n,t),e.settings=n;const a=e.AssetManager,i=e.BlockManager.getCategories(),s=e.BlockManager,o=e.Panels;e.I18n.setMessages({tw:tw}),a.addType("image",{view:{attributes:{Guid:"custom-value"}}}),setInterval((()=>{"undefined"!=typeof CKEDITOR&&(CKEDITOR.dtd.$editable.a=1,CKEDITOR.dtd.$editable.p=1,CKEDITOR.dtd.$editable.span=1,CKEDITOR.dtd.$editable.li=1,CKEDITOR.dtd.$editable.strong=1,CKEDITOR.dtd.$editable.div=1,CKEDITOR.dtd.$removeEmpty.span=0,CKEDITOR.dtd.$removeEmpty.i=0)}),200),e.on("run:modal-open:modalckeditor",(function(){})),e.on("asset:add",(e=>{})),e.on("run:open-assets",(()=>{const t=e.Modal.getContentEl(),n=(t.querySelector(".gjs-am-file-uploader"),t.querySelector(".gjs-am-assets-header")),i=t.querySelector(".gjs-am-assets-cont");if(!t.querySelector(".gjs-am-assets-filter")){const e=$('\n                <div class="input-group mb-3 gjs-am-assets-filter">\n                    <input type="text" class="form-control" placeholder="搜尋檔案名稱" aria-label="搜尋檔案名稱" aria-describedby="button-addon2">\n                    <button class="btn btn-outline-secondary" type="button" id="button-addon2">\n                        <span class="material-symbols-outlined">search</span>\n                    </button>\n                </div>\n            ');e.find(".btn").on("click",(()=>{const t=e.children('[type="text"]').val();""==t?$(".gjs-am-asset-image").removeClass("d-none"):$(".gjs-am-asset-image").each((function(){const e=$(this);e.find(".gjs-am-dimensions").text().indexOf(t)<0?e.addClass("d-none"):e.removeClass("d-none")}))})),n.style.display="none",i.insertBefore(e[0],n)}a.onSelect((e=>{var t=e.attributes.name;$gjs_select.addAttributes({alt:t.substring(0,t.lastIndexOf("."))}),$gjs_select=null}))})),e.on("asset:remove",(e=>{const t=e.get("guid");co.File.Delete(t).done((function(e){console.log(e)}))}));e.Commands.add("tlb-settime",(e=>{b.show()})),e.on("component:selected",(()=>{const t="tlb-settime",n=e.getSelected();$gjs_select=e.getSelected();const a=n.get("toolbar");a.some((e=>e.command===t))||n.set({toolbar:[...a,{attributes:{class:"fa fa-star"},command:t}]})})),e.DomComponents.addType("image",{isComponent:e=>"IMG"==e.tagName,model:{defaults:{traits:[{name:"alt",type:"text",label:"圖片名稱(Alt)",placeholder:"請輸入圖片名稱"}]},init(){}}}),e.DomComponents.addType("連結",{isComponent:e=>"A"==e.tagName,model:{defaults:{traits:[{name:"title",type:"text",label:"名稱",placeholder:"請輸入連結名稱"},{name:"data-text",type:"text",label:"顯示文字",placeholder:"請輸入顯示文字"},{name:"href",type:"text",label:"超連結",placeholder:"請輸入連結位子"},{name:"file",type:"button",text:"選擇檔案",command:e=>{a.open(),a.onSelect((t=>{e.getSelected().set("attributes",{href:t.id}),a.close()}))}},{name:"target",type:"select",label:"開啟方式",options:[{id:"_self",name:"直接連結"},{id:"_blank",name:"另開視窗",label:"另開視窗"}]}]},init(){this.on("change:attributes:data-text",(function(e){void 0!==e.getEl()&&(e.find(".name").length>0?e.find(".name")[0].components(e.getAttributes()["data-text"]):e.components(e.getAttributes()["data-text"]))}))}}}),e.DomComponents.addType("Youtube放大檢視",{isComponent:e=>e.classList?.contains("YTmodal_frame"),model:{defaults:{removable:!0,editable:!1,traits:[{name:"yttitle",type:"text",label:"標題",placeholder:"請輸入Youtube標題"},{name:"link",type:"text",label:"網址",placeholder:"請輸入Youtube網址"}]},init(){this.on("change:attributes:link",(function(e){if(void 0!==e.getEl()){var t=e.getAttributes().link,n=t,a=$(e.getEl());if(n){if(n.startsWith("https://www.youtube.com/watch?")?n=n.substring(30):n.startsWith("https://youtu.be/")?n=n.substring(17):n.startsWith("https://www.youtube.com/shorts/")?n=n.substring(31):n.startsWith("https://youtube.com/shorts/")?n=n.substring(27):n.startsWith("https://www.youtube.com/live/")&&(n=n.substring(29)),n.includes("?si=")){var i=n.indexOf("?si="),s=n.substring(0,i),o=n.indexOf("&",i);n=o>=0?s+n.substring(o):s}var l="";if(n.includes("v=")){var d=n.indexOf("v=")+2;l=(o=n.indexOf("&",d))>=0?n.substring(d,o):n.substring(d)}else{var c=n.indexOf("&");l=c>=0?n.substring(0,c):n.substring(d)}var r=0;if(n.includes("t=")){var p=n.indexOf("t=")+2,m=n.indexOf("&",p),u=m>=0?n.substring(p,m):n.substring(p);u.endsWith("s")?r=parseInt(u.slice(0,-1),10):u.endsWith("m")?r=60*parseInt(u.slice(0,-1),10):isNaN(u)||(r=parseInt(u,10))}n=r>0?`https://www.youtube.com/embed/${l}?start=${r}`:`https://www.youtube.com/embed/${l}`,t.startsWith("https://www.youtube.com/embed/")||e.setAttributes({link:n});var f=`http://img.youtube.com/vi/${l}/hqdefault.jpg`;a.find("img").attr("src",f)}}})),this.on("change:attributes:yttitle",(function(e){if(void 0!==e.getEl()){var t=e.getAttributes().yttitle;if(void 0!==t)$(e.getEl()).find("img").attr("alt",`${t}的圖片`)}}))}},view:{onRender(){const e=this.el;var t=$(e),n=t.attr("link");if(void 0!==n){var a=`http://img.youtube.com/vi/${void 0!==t.attr("vid")?t.attr("vid"):n.substring(n.indexOf("v=")+2)}/hqdefault.jpg`;t.find("img").attr("src",a),t.attr("data-isinit",!0)}}}}),e.DomComponents.addType("電子書",{isComponent:e=>e.classList?.contains("FlipBookItem"),model:{defaults:{traits:[{name:"title",type:"text",label:"檔案名稱",placeholder:"點選下方按鈕選擇檔案"},{name:"data-pdf-url",type:"text",label:"連結",placeholder:"請輸入電子書路徑"},{name:"file",type:"button",text:"選擇檔案",command:e=>{a.open({types:["pdf"],accept:"application/pdf"}),a.onSelect((t=>{const n=e.getSelected(),i=n.getAttributes();n.set("attributes",{...i,"data-pdf-url":t.id,title:t.attributes.name}),a.close()}))}}]}},view:{onRender(){const e=this.el;$(e).removeAttr("data-bs-toggle")}}}),e.DomComponents.addType("檔案下載",{isComponent:e=>e.classList?.contains("link_with_icon"),model:{defaults:{traits:[{name:"download",type:"text",label:"檔案名稱",placeholder:"請輸入檔案名稱"},{name:"file",type:"button",text:"選擇檔案",command:e=>{a.open(),a.onSelect((t=>{var n=$(".gjs-frame")[0].contentWindow.LinkWithIconInit;e.getSelected().set("attributes",{href:t.id}),n(),a.close()}))}}]},init(){this.on("change:attributes:download",(function(e){void 0!==e.getEl()&&e.find(".name")[0].components(e.getAttributes().download)}))}},view:{init(){this.setLink()},setLink:function(){setTimeout((function(){(0,$(".gjs-frame")[0].contentWindow.LinkWithIconInit)()}),100)}}}),e.DomComponents.addType("輪播",{isComponent:e=>e.classList?.contains("one_swiper")||e.classList?.contains("one_swiper_thumbs")||e.classList?.contains("two_swiper")||e.classList?.contains("three_swiper")||e.classList?.contains("four_swiper")||e.classList?.contains("six_swiper")||e.classList?.contains("three_two_grid_swiper")||e.classList?.contains("vertical_swiper_thumbs"),model:{defaults:{traits:[{type:"button",text:"開啟編輯",command:e=>{const t=e.getSelected();var n=$(t.getEl());n.find(".swiper-slide").length>0&&$("#SwiperModal").length<1&&$('<div class="modal fade" id="SwiperModal" tabindex="-1" aria-labelledby="SwiperModalLabel" aria-hidden="true">\n                                        <div class="modal-dialog modal-lg">\n                                        <div class="modal-content">\n                                            <div class="modal-header">\n                                            <h1 class="modal-title fs-5" id="SwiperModalLabel">輪播編輯</h1>\n                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                                            </div>\n                                            <div class="modal-body">\n                                                <div id="scroll" class="px-0 w-50">\n                                                <ul id="SwiperList" class="px-0 p-1"></ul>\n                                                <template id="TemplateSwiperList">\n                                                    <li>\n                                                        <input type="radio" name="label" checked="checked">\n                                                        <label class="d-flex mb-3 border p-2 border-dark rounded position-relative isScroll">\n                                                            <img class="me-2 update-img isPointer" src="" alt="" />\n                                                            <span class="material-symbols-outlined mx-3 d-none yt-video">slow_motion_video</span>\n                                                            <div class="align-self-center">\n                                                                <div class="img_alt d-none"></div>\n                                                                <p class="setting d-none h3">正在編輯</>\n                                                                <div class="a_href d-none"></div>\n                                                                <div class="a_title d-none"></div>\n                                                                <div class="a_target d-none"></div>\n                                                                <div class="yt_src d-none"></div>\n                                                                <div class="video_title d-none"></div>\n                                                                <div class="start_time d-none"></div>\n                                                                <div class="keep_time d-none"></div>\n                                                                <div class="synopsis_title d-none"></div>\n                                                                <div class="synopsis_caption d-none"></div>\n                                                                <div class="eyes">\n                                                                    <span class="material-symbols-outlined">visibility</span>\n                                                                    <span class="material-symbols-outlined d-none">visibility_off</span>\n                                                                </div>\n                                                            </div>\n\n                                                            <div class="align-items-center d-flex position-absolute top-50 end-0 translate-middle-y mr-1">\n                                                                <a class="mr-1 show-form isPointer" title="編輯內容">\n                                                                    <span class="material-symbols-outlined text-black button">border_color</span>\n                                                                </a>\n                                                                <a class="mr-1 delete-slide isPointer" title="刪除">\n                                                                    <span class="material-symbols-outlined text-black button">delete</span>\n                                                                </a>\n                                                            </div>\n                                                        </label>\n                                                    </li>\n                                                </template>\n                                                </div>\n                                                <button id="add" type="button" class="btn-add-column">新增一欄</button>\n                                                <button id="addYT" type="button" class="btn-add-YT">新增影片</button>\n                                                <div class="w-50 ps-3 set-caption">\n                                                  <h5>相關設定</h5>\n                                                  <form id="EditContentForm">\n                                                    <div id=set-title class="mb-3 d-none">\n                                                      <label for="slideTitle" class="form-label">標題</label>\n                                                      <input type="text" class="form-control" id="slideTitle" placeholder="輸入名稱" />\n                                                    </div>\n                                                    <div id="set-content" class="mb-3">\n                                                      <label for="slideAlt" class="form-label">內文</label>\n                                                      <input class="form-control" id="slideAlt" rows="3" placeholder="輸入內文"></textarea>\n                                                    </div>\n                                                    <div id="set-link" class="mb-4">\n                                                      <label for="slideHref" class="form-label">連結網址</label>\n                                                      <input class="form-check-input ms-4" type="checkbox" value="" id="CheckOpenWindow">\n                                                      <label class="form-check-label ms-3 ps-4" for="CheckOpenWindow">另開新視窗</label>\n                                                      <input type="text" class="form-control" id="slideHref" placeholder="輸入連結" />\n                                                    </div>\n                                                    <div id="YT-link" class="mb-4 d-none">\n                                                      <label for="ytSrc" class="form-label">Youtube影片</label>\n                                                      <input type="text" class="form-control" id="ytSrc" placeholder="影片網址" />\n                                                    </div>\n                                                    <div id="start-time" class="mb-4 d-none">\n                                                      <label for="startTime" class="form-label">開始時間(秒)</label>\n                                                      <input type="text" class="form-control" id="startTime" placeholder="輸入開始時間(秒)" />\n                                                    </div>\n                                                    <div id="keep-time" class="mb-4">\n                                                      <label for="keepTime" class="form-label">持續時間(秒)</label>\n                                                      <input type="text" class="form-control" id="keepTime" placeholder="輸入持續時間(秒)" />\n                                                    </div>\n                                                    <div id="img-hidden" class="ms-3">\n                                                        <input class="form-check-input" type="checkbox" value="" id="CheckHidden">\n                                                        <label class="form-check-label" for="CheckHidden">隱藏</label>\n                                                    </div>\n                                                  </form>\n                                                </div>\n                                            </div>\n                                            <div class="modal-footer">\n                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>\n                                            <button type="button" class="btn btn-primary sava">完成編輯</button>\n                                            </div>\n                                        </div>\n                                        </div>\n                                    </div>\n                                ').appendTo("body");var i=$("#SwiperList"),s=[];n.find(".swiper .swiper-slide").each((function(){var e=$(this);if(console.log(e.find("*").attr("data-start_time")),!e.parent().hasClass("template_slide")){var t={href:e.find("a").attr("href"),title:e.find("a").attr("title"),src:e.find("img").attr("src"),alt:e.find("img").attr("alt"),img_update:e.find("img").length>0,a_tag:e.find("a").length>0,target:e.find("a").attr("target"),yt_src:e.find("iframe").attr("src"),video_title:e.find("iframe").length?e.find("iframe").attr("title"):e.find("video").attr("title"),start_time:e.find("*").attr("data-start_time"),keep_time:e.find("img").length?e.find("img").data("keep_time"):e.find("iframe").data("keep_time"),synopsis_title:e.find(".synopsis_title").text(),synopsis_caption:e.find(".synopsis_caption").text().trim(),visible:e.hasClass("backstageType")};s.push(t)}})),i.empty(),$("#EditContentForm input").off("change").on("change",(function(){const e=$('#SwiperList [name="label"]:checked').closest("li"),t=$("#slideTitle").val(),n=$("#slideAlt").val(),a=$("#slideHref").val(),i=$("#CheckOpenWindow").prop("checked")?"_blank":"_self",s=$("#ytSrc").val()?$("#ytSrc").val().replace("watch?v=","embed/"):"",o=$("#startTime").val()?$("#startTime").val():"",l=$("#keepTime").val()?$("#keepTime").val():5,d=!!$("#CheckHidden").prop("checked");e.data({alt:t,synopsis_title:t,synopsis_caption:n,href:a,title:t,target:i,yt_src:s,video_title:t,start_time:o,keep_time:l,visible:d}),d?(e.find(".eyes>span:first-child").addClass("d-none"),e.find(".eyes>span:last-child").removeClass("d-none")):(e.find(".eyes>span:last-child").addClass("d-none"),e.find(".eyes>span:first-child").removeClass("d-none")),e.find(".img_alt").html(t),e.find(".synopsis_title").html(t),e.find(".synopsis_caption").html(n),e.find(".a_href").html(a),e.find(".a_title").html(t),e.find(".a_target").html(i),e.find(".yt_src").html(s),e.find(".video_title").html(t),e.find(".start_time").html(o),e.find(".keep_time").html(l),e.find(".a_visible").html(d)}));const o=function(e,t){var s=co.Object.merge({src:"/images/UploadImg.png",alt:"",href:"#SwiperModal"===n.find("a").attr("href")?"#SwiperModal":"",title:"",yt_src:"",video_title:"",start_time:0,keep_time:5,synopsis_title:"",synopsis_caption:"",visible:!1,a_tag:!0,img_update:!0},t),o=$($("#TemplateSwiperList").html());o.data(s),o.find("[name='label']").attr("id",`selectSwiper${e}`),o.find("label").attr("for",`selectSwiper${e}`),o.find("img").attr({src:s.src,alt:s.alt}),o.find(".img_alt").text(s.alt),o.find(".a_href").text(s.href),o.find(".yt_src").text(s.yt_src),o.find(".start_time").text(s.start_time),o.find(".keep_time").text(s.keep_time),o.find(".synopsis_caption").text(s.synopsis_caption),t.visible?(o.find(".eyes > span:first-child").addClass("d-none"),o.find(".eyes > span:last-child").removeClass("d-none")):(o.find(".eyes > span:first-child").removeClass("d-none"),o.find(".eyes > span:last-child").addClass("d-none")),t.a_tag||t.img_update||(o.find(".update-img").remove(),o.find(".yt-video").removeClass("d-none")),o.data("order",e),o.find("label").on("click",(function(){$("#EditContentForm input:focus").trigger("change");const e=$(this).closest("li"),t=$(".set-caption"),n=e.find(".setting"),a=t.find("#slideTitle"),i=t.find("#slideAlt"),s=t.find("#slideHref"),o=t.find("#ytSrc"),l=t.find("#startTime"),d=t.find("#keepTime"),c=[$("#set-title"),$("#set-content"),$("#set-link"),$("#YT-link"),$("#start-time")];t.find("*:not(.a_target, #YT-link)").removeClass("d-none"),console.log(e.data("a_tag")),e.data("a_tag")||e.data("img_update")?(c[3].addClass("d-none"),c[4].addClass("d-none")):(c[3].removeClass("d-none"),c[4].removeClass("d-none")),!e.data("yt_src")&&"#SwiperModal"!==e.data("href")&&e.data("a_tag")||c[2].addClass("d-none"),e.data("synopsis_caption")||c[1].addClass("d-none"),$("#CheckHidden").prop("checked",e.data("visible")),$("#CheckOpenWindow").prop("checked","_blank"==e.data("target")),$("#SwiperList").find(".setting").addClass("d-none"),n.removeClass("d-none"),t.removeClass("d-none"),$("#SwiperList").find("[name='label']").prop("checked",!1),e.find("[name='label']").prop("checked",!0),a.val(e.data().alt),i.val(e.data().synopsis_caption),s.val(e.data().href),o.val(e.data().yt_src),l.val(e.data().start_time),d.val(e.data().keep_time)})),o.find(".update-img").on("click",(function(){const e=$(this).closest("li").find("img");a.open(),a.onSelect((t=>{if(t&&t.id){const n=t.attributes.name.split(".");let a="";for(let e=0;e<n.length&&e!=n.length-1;e++)a+=n[e];$(this).closest("li").find(".img_alt").text()?$("#slideTitle").val:$("#slideTitle").val(a).trigger("change"),e.attr("src",t.id)}a.close()}))})),o.find(".delete-slide").on("click",(function(){window.confirm("確定要刪除此欄位嗎?")&&$(this).closest("li").remove()})),i.append(o)};$.each(s,o),$("#SwiperList").sortable();var l=new bootstrap.Modal("#SwiperModal");l.show(),$("#SwiperList li:first").find("label").trigger("click"),$("#SwiperModal .btn-add-column").off("click").on("click",(function(){o($("#SwiperList>li").length,{a_tag:!0,img_update:!0}),$("#scroll").scrollTop($("#scroll")[0].scrollHeight)})),$("#SwiperModal .btn-add-YT").off("click").on("click",(function(){o($("#SwiperList>li").length,{a_tag:!1,img_update:!1}),$("#scroll").scrollTop($("#scroll")[0].scrollHeight)})),$("#SwiperModal .sava").off("click").on("click",(function(){const a=t.toHTML(),i=$(a).find(".swiper .swiper-wrapper .swiper-slide").clone(),s=$(a).find(".swiper .swiper-wrapper"),o=function(e,t,n){return $("<iframe>").attr({src:e,title:n,width:"100%",height:"500",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0,"data-start_time":t})};s.empty(),$("#SwiperList li").each((function(t,n){const a=$(n).find("img").attr("src"),l=$(n).data("alt")?$(n).data("alt"):$(n).data("video_title"),d=$(n).data("href"),c=$(n).data("target"),r=$(n).data("yt_src"),p=$(n).data("visible"),m=$(n).data("synopsis_caption"),u=$(n).data("start_time"),f=($(n).data("keep_time"),$(n).data("order"));let b=i[f];$(b).find("h2").text().trim();if(b){if(""!=r&&null!=r){$(b).find(".synopsis_title").length||$(b).empty();const e=o(r,u,l);$(b).append(e)}else $(b).find("img").attr("src",a),$(b).find("img").attr("alt",l),d&&$(b).find("a").attr("href",d),$(b).find("a").attr("title",l),$(b).find("a").attr("target",c);$(b).find(".synopsis_title").text(l),$(b).find(".synopsis_caption").text(m),p?$(b).addClass("backstageType"):$(b).removeClass("backstageType"),s.append(b)}else{var g=e.getSelected();g.find(".swiper")[0].getEl().swiper;if(g.find(".template_slide>.swiper-slide")[0])if(b=$(g.find(".template_slide>.swiper-slide")[0].toHTML()),""!=r&&null!=r){b.find("a, img").remove();const e=o(r,u,l);$(b).append(e)}else b.find("img").attr("src",a),b.find("img").attr("alt",l),b.find("a").attr("target",c),b.find(".synopsis_title").text(l),b.find(".synopsis_caption").text(m);else{if(b=$("<div>").append($(g.find(".swiper-slide")[0].toHTML())).html(),b=$(b),""!=r&&null!=r){b.find("a, img").remove();const e=o(r,u,l);$(b).append(e)}else b.find("img").attr("src",a),b.find("img").attr("alt",l),d&&b.find("a").attr("href",d),b.find("a").attr("title",l),b.find("a").attr("target",c);b.find(".synopsis_title").text(l),b.find(".synopsis_caption").text(m)}p?$(b).addClass("backstageType"):$(b).removeClass("backstageType"),s.append(b)}}));const d=t.find(".swiper:not(.six_thumbs) .swiper-wrapper")[0];$(a).find(".six_thumbs .swiper-wrapper").empty(),d.components([]),s.children().each((function(){d.append($(this).prop("outerHTML"))}));const c=$(".gjs-frame")[0].contentWindow.$(`#${n.attr("id")}`);c.data("isInit",!1),void 0!==c.find(".swiper")[0].swiper&&c.find(".swiper")[0].swiper.destroy(!0,!0),$(".gjs-frame")[0].contentWindow.SwiperInit({autoplay:!1}),l.hide()}))}}]}}}),e.DomComponents.addType("輪播容器",{isComponent:e=>e.classList?.contains("image_link_slide"),model:{defaults:{removable:!0,editable:!1}}}),e.DomComponents.addType("QA元件",{isComponent:e=>e.classList?.contains("qa"),model:{init(){const e=this,t=e.ccid,n=$(".gjs-frame")[0].contentWindow.$;window.setTimeout((function(){const a=e.find("a.btn")[0],i=e.find(".collapse")[0];a.addAttributes({href:`#${t}_content`,Title:"展開QA","data-bs-toggle":"collapse"}),i.addAttributes({id:`${t}_content`}),n(`#${t} a`).attr({"data-bs-toggle":""})}),200)}}}),e.DomComponents.addType("QA元件鎖定版型",{isComponent:e=>{const t=$(e).parents(".qa");return $(t).length>0&&(e.classList?.contains("collapse")||e.classList?.contains("card")||e.classList?.contains("fas")||e.classList?.contains("qa-bg"))},model:{defaults:{hoverable:!1,selectable:!1,droppable:!1,copyable:!1,removable:!1,editable:!1}}}),e.DomComponents.addType("名片介紹",{isComponent:e=>e.classList?.contains("frame_type_2"),model:{defaults:{droppable:!1,copyable:!1},init(){}}}),e.DomComponents.addType("名片介紹",{isComponent:e=>e.classList?.contains("frame_type_2"),model:{defaults:{droppable:!1,copyable:!1},init(){}}}),e.DomComponents.addType("活動列表",{isComponent:e=>e.classList?.contains("articletype"),model:{defaults:{droppable:!1,copyable:!1,traits:[{name:"data-daterange",type:"date-range",label:"起訖日期"},{name:"data-location",type:"text",label:"地點",placeholder:"請輸入地點"},{name:"data-addr",type:"text",label:"地址",placeholder:"請輸入地址"},{name:"data-link",type:"text",label:"連結",placeholder:"請輸入連結"},{name:"data-organizer",type:"text",label:"主辦單位",placeholder:"請輸入主辦單位"},{name:"data-a-organizer",type:"text",label:"協辦單位",placeholder:"請輸入協辦單位"},{name:"data-r-organizer",type:"text",label:"執行單位",placeholder:"請輸入執行單位"},{name:"data-tel",type:"text",label:"電話",placeholder:"請輸入電話"}]},init(){const e=this,t=function(){setTimeout((()=>{var n=$(".gjs-frame")[0].contentWindow.date_input_change;if(void 0===n)t();else{const t=n(e.getId());e.components(t)}}),200)};e.on("change:attributes",t),t()}}}),e.TraitManager.addType("date-range",{createInput({trait:t}){const n=document.createElement("div");n.innerHTML='\n              <div class="date-range-inputs">\n                <input type="text" class="date-range" pattern="[1-9]d{3}/d{2}/d{2} d{2}:d{2} ~ [1-9]d{3}/d{2}/d{2} d{2}:d{2}" />\n              </div>\n            ';const a=$(n).find(".date-range"),i=this.model.getValue();co.Picker.Init(a);try{const e=i.split(" ~ ");a.data("daterangepicker").setStartDate(e[0]),a.data("daterangepicker").setEndDate(e[1])}catch{a.data("daterangepicker").setStartDate(Date.now)}return a.on("change",(function(){e.getSelected().addAttributes({"data-daterange":this.value})})),n}}),e.DomComponents.addType("子頁內容",{isComponent:e=>e.classList?.contains("subpage_content"),model:{defaults:{droppable:!1,editable:!1,copyable:!1}}});var l=null;e.DomComponents.addType("目錄",{isComponent:e=>e.classList?.contains("menu_directory")||e.classList?.contains("catalog_frame")||e.classList?.contains("advertise_directory"),model:{defaults:{droppable:!1,editable:!1,copyable:!1,traits:[{name:"id",type:"text",label:"ID",placeholder:"元件ID名稱"},{name:"data-diridname",type:"text",label:"目錄名稱",placeholder:"尚未關聯目錄"},{name:"data-dirpath",type:"text",label:"路徑",placeholder:"設定連結路徑"},{name:"data-dirid",type:"button",text:"設置目錄",command:e=>{var t=null;l||((l=$("#PopupDirectory").dxPopup("instance")).option("contentTemplate",$("#PopupDirectory-template")),l.option("title","設置目錄"),window.DirectoryList_SelectChange=function(e){t=e.selectedRowsData},window.setTimeout((function(){$("#PopupDirectory .cancel").on("click",(function(){l.hide()})),$("#PopupDirectory .Sure").on("click",(function(n){var a=e.getSelected().getAttributes()["data-dirid"];e.getSelected().set("attributes",{"data-dirid":t.map((function(e){return e.Id})),"data-diridname":t.map((function(e){return e.Title}))}),l.hide(),a!=e.getSelected().getAttributes()["data-dirid"].toString()&&$(".gjs-frame")[0].contentWindow.DirectoryGetDataInit()}))}),200)),l.show()}},{name:"data-shownum",type:"text",label:"單頁筆數",placeholder:"一個分頁要抓幾筆資料"},{name:"data-maxlen",type:"text",label:"最大筆數",placeholder:"該目錄僅抓幾筆資料"},{name:"data-hasbuybtn",type:"checkbox",label:"購物按鈕(僅作用於商品目錄)",valueTrue:"true",valueFalse:"false"}]},init(){var e=this;e.on("change:attributes:data-shownum",(e=>{setTimeout((()=>{const t=$(".gjs-frame")[0].contentWindow;let n=e.getAttributes();t.$(`#${e.getId()}`).data({prevdirid:n["data-prevdirid"],shownum:n["data-shownum"],hasbuybtn:n["data-hasbuybtn"]}),t.DirectoryGetDataInit()}),200)})),e.on("change:attributes:data-maxlen",(e=>{setTimeout((()=>{const t=$(".gjs-frame")[0].contentWindow;let n=e.getAttributes();t.$(`#${e.getId()}`).data({prevdirid:n["data-prevdirid"],maxlen:n["data-maxlen"],hasbuybtn:n["data-hasbuybtn"]}),t.DirectoryGetDataInit()}),200)})),e.on("change:attributes:data-dirid",(e=>{setTimeout((()=>{const t=$(".gjs-frame")[0].contentWindow;let n=e.getAttributes();void 0!==n["data-dirid"]&&(t.$(`#${e.getId()}`).data({dirid:n["data-dirid"].toString()}),t.DirectoryGetDataInit())}),200)})),e.on("change:attributes:data-hasbuybtn",(e=>{setTimeout((()=>{const t=$(".gjs-frame")[0].contentWindow;let n=e.getAttributes();t.$(`#${e.getId()}`).data({prevdirid:n["data-prevdirid"],maxlen:n["data-maxlen"],hasbuybtn:n["data-hasbuybtn"]}),t.DirectoryGetDataInit()}),200)}))}}}),e.DomComponents.addType("格列切換控制",{isComponent:e=>e.classList?.contains("switch_control"),model:{defaults:{droppable:!1,copyable:!1,traits:[{type:"checkbox",label:"文字",name:"btn_text",valueTrue:"1",valueFalse:"0"},{type:"checkbox",label:"圖片",name:"btn_grid",valueTrue:"1",valueFalse:"0"},{type:"checkbox",label:"圖文",name:"btn_list",valueTrue:"1",valueFalse:"0"}]},init(){for(var e=this,t=["btn_text","btn_grid","btn_list"],n=0;n<t.length;n++){const a=t[n];e.on(`change:attributes:${a}`,(()=>{e.components().models.forEach((function(t){t.getClasses().indexOf(a)>=0&&(t.getClasses().indexOf("d-none")>=0?(t.removeClass("d-none"),setTimeout((()=>{(0,$(".gjs-frame")[0].contentWindow.namecontrol)(e.getId())}),200)):(t.addClass("d-none"),setTimeout((()=>{(0,$(".gjs-frame")[0].contentWindow.namecontrol)(e.getId())}),200)))}))}))}}}});const d=e.DomComponents.getType("text");e.DomComponents.addType("span",{model:d.model.extend({},{isComponent(e){if("SPAN"===e.tagName)return{type:"text",src:e.src,tagName:e.tagName.toLowerCase(),content:e.innerHTML,editable:!0}}}),view:d.view}),e.DomComponents.addType("動畫背景",{isComponent:e=>e.classList?.contains(".BGCanvas"),model:{defaults:{droppable:!1,copyable:!1},init(){const e=this.ccid,t=$(".gjs-frame")[0].contentWindow.$;window.setTimeout((function(){console.log("in"),t(`#${e}`).BGCanvas()}),200)}}});e.on("load",(()=>{$(i.models).each((function(e,t){t.set("open",0==e).on("change:open",(function(e){e.get("open")&&i.each((t=>{t!==e&&t.set("open",!1)}))}))}))})),n.getComponer().done((function(e){$(e).each((function(){const e=`${co.Data.HtmlDecode(this.html)}<style>${this.css}</style>`;let t="customBlockTemplate_"+this.id,n=(this.icon||"").replace("material-symbols-outlined","").trim(),a="";/^fa/.test(this.icon)?a=`<i class="${this.icon} fa-5x"></i>`:/material-symbols-outlined/.test(this.icon)&&(a=`<i class="material-symbols-outlined fa-5x">${n}</i>`),u(t,{category:this.typeName,attributes:{custom_block_template:!0},label:`${this.title}`,media:a,content:e})}))}));const c=function(t,n,a){if(t){const i=t.components().models;if(void 0===a&&(a=[]),i){a.push(...t.get("tagName"));for(const e of i)c(e,n,a)}((t,n,a)=>{const i=t.getId(),s=t.getClasses(),o=t.get("tagName"),l=e.CssComposer.getAll().filter((e=>{const t=e.toCSS();return s.some((e=>t.includes(`.${e}`)))&&a.map((e=>t.includes(e)))||t.includes(`#${i}`)||t.includes(o)&&a.map((e=>t.includes(e)))}));co.Array.merge(n,l)})(t,n,a)}};let r=null;const p=function(e){let t;return{getInstance:function(){return t||(t=function(){const t=document.createElement("ul");t.classList.add("custom-context-menu");const{menus:n}=e;if(n&&n.length>0)for(let e of n){const n=document.createElement("li");n.textContent=e.name,n.onclick=e.onClick,t.appendChild(n)}return document.querySelector("body").appendChild(t),t}()),t}}}({menus:[{name:"加入至頁面",onClick:function(t){const n=s.get(r);e.addComponents(n.attributes.content)}},{name:"刪除元件",onClick:function(e){m()}}]});function m(){const e=r.split("_"),t=e[e.length-1];co.HtmlContent.Delete(t).done((function(e){e.success?(s.remove(r),co.sweet.success("成功",null,!0)):co.sweet.error(e.error)}))}document.addEventListener("click",(function(e){p.getInstance().style.display="none"}));const u=function(e,t){const n=`customBlockTemplate_${e}`;var a={type:"default",render:({model:e,el:a})=>{a.addEventListener("dblclick",(()=>{co.sweet.confirm("即將刪除",co.sweet.TitleHilight("是否要確認將{0}刪除?",t.label),"確認","取消",(function(){r=n,m()}))})),a.addEventListener("contextmenu",(e=>{e.preventDefault(),r=n,function(e){const t=p.getInstance();t.style.top=`${e.clientY}px`,t.style.left=`${e.clientX}px`,t.style.display="block"}(e)}))}};$.extend(!0,a,t),s.add(n,a)},f=function(){const t=e.getSelected();let n=$("#NewBlockName").val()||"新增";co.HtmlContent.AddUp({Title:n,Type:$("#ComponerTypeList>option:selected").val()}).done((function(e){if(e.success){let a="customBlockTemplate_"+e.message.split(" ").join("_"),i={id:e.message,name:n,blockId:a};!function(e,t){const n=t.blockId,a=t.name,i=[];let s=$(e.toHTML()).removeClass("gjs-selected")[0].outerHTML,o=s.substring(0,s.indexOf(" ")),l=s.substring(s.indexOf(" ")+1);o+=` custom_block_template=true block_id="${n}" `;let d=o+l,r=$("#NewBlockicon").val();c(e,i);let p="";i.forEach((e=>{p+=e.toCSS()}));const m=d+`<style>${p}</style>`,f=$("#ComponerTypeList>option:selected").text(),b={id:t.id,Title:a,icon:r,type:$("#ComponerTypeList>option:selected").val(),Html:$("<div/>").text(d).html(),css:p,disp_opt:!0};co.HtmlContent.AddUp(b).done((function(e){if(e.success){let e="";/material-symbols-outlined/.test(r)&&(e=r.replace("material-symbols-outlined","").trim()),u(n,{category:f,attributes:{custom_block_template:!0},label:`${a}`,media:`<i class="${r} fa-5x">${e}</i>`,content:m})}else co.sweet.error(e.error)}))}(t,i),document.getElementById("ComFrm").reset()}else co.sweet.error(e.error)}))};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const b=new bootstrap.Modal("#setComponents"),g=$("#NewBlockicon").iconpicker(n.iconPickerOpt);co.HtmlContent.GetTypeList().done((function(e){if(e.success){var t=$("#ComponerTypeList");$(e.type).each((function(){t.append(`<option value="${this.value}">${this.key}</option>`)})),e.type.length>1&&t.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){f(),b.hide(),co.sweet.success("加入我的最愛")})),g.on("change",(function(e){$("#NewBlockicon").val(e.icon)})),null!=n.save&&o.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(e){n.save(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),null!=n.import&&o.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(e){let t=e.getHtml();t=`<body>${$("<div>").append(t).html()}</body>`,n.import(t,e.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1}),e.on("component:clone",(t=>{const n=document.getElementsByClassName("gjs-frame")[0].contentWindow,a=t.getClasses();if(t.setAttributes({id:"id","data-key":""}),a.indexOf("anchor_title")>-1){var i=n.document.getElementsByClassName("anchor_title").length;const e=function(){n.document.getElementsByClassName("anchor_title").length!=i?n.AnchorPointInit():setTimeout(e,100)};setTimeout(e,100)}else if(a.indexOf("swiper-slide")>-1){var s=e.getSelected().parent().getEl().swiper;if(void 0!==s){i=n.document.getElementsByClassName("swiper-slide").length;const e=function(){n.document.getElementsByClassName("swiper-slide").length!=i?s.update():setTimeout(e,100)};setTimeout(e,100)}}else if(a.indexOf("one_swiper")>-1||a.indexOf("one_swiper_thumbs")>-1||a.indexOf("two_swiper")>-1||a.indexOf("four_swiper")>-1||a.indexOf("six_swiper")>-1||a.indexOf("three_two_grid_swiper")>-1||a.indexOf("vertical_swiper_thumbs")>-1){i=n.document.getElementsByClassName("swiper").length;const e=function(){n.document.getElementsByClassName("swiper").length!=i?n.SwiperInit({autoplay:!1}):setTimeout(e,100)};setTimeout(e,100)}})),e.on("component:remove",(t=>{const n=document.getElementsByClassName("gjs-frame")[0].contentWindow,a=t.getClasses();if(t.setAttributes({id:"id","data-key":""}),a.indexOf("anchor_title")>-1){var i=n.document.getElementsByClassName("anchor_title").length;const e=function(){n.document.getElementsByClassName("anchor_title").length!=i?n.AnchorPointInit():setTimeout(e,100)};setTimeout(e,100)}else if(a.indexOf("swiper-slide")>-1&&void 0!==e.getSelected()){var s=e.getSelected().getEl().swiper;if(void 0!==s){i=n.document.getElementsByClassName("swiper-slide").length;const e=function(){n.document.getElementsByClassName("swiper-slide").length!=i?s.update():setTimeout(e,100)};setTimeout(e,100)}}})),e.on("component:drag:end",(e=>{const t=e.target.getClasses(),n=document.getElementsByClassName("gjs-frame")[0].contentWindow;if(t.indexOf("anchor_title")>-1)n.AnchorPointInit();else if(t.indexOf("swiper-slide")>-1){e.target.parent().parent().getEl().swiper.update()}else(t.indexOf("one_swiper")>-1||t.indexOf("one_swiper_thumbs")>-1||t.indexOf("two_swiper")>-1||t.indexOf("four_swiper")>-1||t.indexOf("six_swiper")>-1||t.indexOf("three_two_grid_swiper")>-1||t.indexOf("vertical_swiper_thumbs")>-1)&&n.SwiperInit({autoplay:!1})}))}));