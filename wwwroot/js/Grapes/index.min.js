var grapesInit=function(e){var t={save:function(){return!1},import:function(){return!1},getComponer:function(){return!1},asset:[]};$.extend(!0,t,e);var s=grapesjs.init({showOffsets:1,noticeOnUnload:0,container:"#gjs",assetManager:{uploadFile:function(e){var t=e.dataTransfer?e.dataTransfer.files:e.target.files,n=new FormData;for(var o in t)n.append("files",t[o]);n.append("type",0),co.File.Upload(n).done((function(e){if(e.success){var t=[];$(e.files).each((function(e){t.push(this.path)}));var n=t;s.AssetManager.add(n)}}))}},plugins:["gjs-blocks-basic","grapesjs-preset-webpage","grapesjs-style-bg","grapesjs-tabs","grapesjs-custom-code","grapesjs-tui-image-editor","grapesjs-blocks-table"],pluginsOpts:{"gjs-blocks-basic":{flexGrid:!0},"grapesjs-preset-webpage":{modalImportTitle:"Import Template",modalImportLabel:'<div style="margin-bottom: 10px; font-size: 13px;">Paste here your HTML/CSS and click Import</div>',modalImportContent:function(e){return e.getHtml()+"<style>"+e.getCss()+"</style>"}},"grapesjs-tabs":{tabsBlock:{category:"Extra"}},"grapesjs-tui-image-editor":{script:["/lib/tui-code/js/tui-code-snippet.min.js","/lib/tui-code/js/tui-color-picker.min.js","/lib/tui-code/js/tui-image-editor.min.js"],style:["/lib/tui-code/css/tui-color-picker.min.css","/lib/tui-code/css/tui-image-editor.min.css"]},"grapesjs-blocks-table":{containerId:"#gjs"}},canvas:{styles:["/lib/bootstrap/dist/css/bootstrap.min.css","/lib/swiper/swiper-bundle.min.css","/css/Grapes/GrapesCss.min.css","https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200","/shared/css/Frame.min.css","/shared/css/HoverEffect.min.css","/shared/css/Swiper.min.css"],scripts:["/lib/jquery/dist/jquery.min.js","/lib/bootstrap/dist/js/bootstrap.bundle.min.js","/lib/swiper/swiper-bundle.min.js","/shared/js/Frame.min.js","/shared/js/Swiper.min.js","/shared/js/ViewTypeChange.min.js"]},domComponents:{processor:e=>{if(e.classes){const t=document.getElementsByClassName("gjs-frame")[0].contentWindow;let s=[{key:"SwiperInit",state:!1,run:!0,class:[]},{key:"FrameInit",state:!1,run:!0,class:[]},{key:"ViewTypeChangeInit",state:!1,run:!0,class:[]}];const n=function(e,t){s[e].state=!0,s[e].run=!1,s[e].class.push(`.${t}`)};$(e.classes).each((function(){var e=this.toString();switch(e){case"one_swiper":case"two_swiper":case"four_swiper":n(0,e);break;case"masonry":n(1,e);break;case"frame":n(2,e)}}));const o=function(){var e=!0;$(s).each((function(){var s=this;if(s.state){let e=!0;$(s.class).each((function(){0==t.$(this).length&&(e=!1)})),e&&(t[s.key](),s.run=!0)}e=e&&this.run})),e||setTimeout(o,300)};setTimeout(o,300)}}},fromElement:!0,storageManager:{autoload:0}});s.on("asset:remove",(e=>{let s;var n=e.get("src").split("/").reverse()[0].split(".")[0];t.asset.every((function(e,t){return!(e.path.indexOf(n)>0)||(s=e.guid,!1)})),co.File.Delete(s).done((function(e){console.log(e)}))}));var n=s.Panels;const o=s.BlockManager;var i=s.BlockManager.getCategories();const a=e=>{const t=e.getEl(),n=e.getId(),o=t.classList,i=s.CssComposer.getRule(`#${n}`),a=s.CssComposer.getRule(`#${n}:hover`);let l="";return $(o).each((function(){if(this){const e=this.toString(),t=s.CssComposer.getRule(`.${e}`),n=s.CssComposer.getRule(`.${e}:hover`);t&&(l=`${l} ${t.toCSS()}`),n&&(l=`${l} ${n.toCSS()}`)}})),i?(a&&(l=`${i.toCSS()} ${a.toCSS()} ${l}`),l=`${i.toCSS()} ${l}`):l},l=function(e){let t="";if(e){const s=e.components().models;if(s){for(const e of s)t+=l(e);return t+a(e)}return a(e)}};let c=null;const r=function(e){let t;return{getInstance:function(){return t||(t=function(){const t=document.createElement("ul");t.classList.add("custom-context-menu");const{menus:s}=e;if(s&&s.length>0)for(let e of s){const s=document.createElement("li");s.textContent=e.name,s.onclick=e.onClick,t.appendChild(s)}return document.querySelector("body").appendChild(t),t}()),t}}}({menus:[{name:"加入至頁面",onClick:function(e){const t=o.get(c);s.addComponents(t.attributes.content)}},{name:"刪除元件",onClick:function(e){d()}}]});function d(){const e=c.split("_"),t=e[e.length-1];console.log(t),co.HtmlContent.Delete(t).done((function(e){e.success?(o.remove(c),co.sweet.success("成功",null,!0)):co.sweet.error(e.error)}))}document.addEventListener("click",(function(e){r.getInstance().style.display="none"}));const m=function(e,t){const s=`customBlockTemplate_${e}`;var n={render:({model:e,el:n})=>{n.addEventListener("dblclick",(()=>{co.sweet.confirm("即將刪除",co.sweet.TitleHilight("是否要確認將{0}刪除?",t.label),"確認","取消",(function(){c=s,d()}))})),n.addEventListener("contextmenu",(e=>{e.preventDefault(),c=s,function(e){const t=r.getInstance();t.style.top=`${e.clientY}px`,t.style.left=`${e.clientX}px`,t.style.display="block"}(e)}))}};$.extend(!0,n,t),o.add(s,n)},u=function(){const e=s.getSelected();let t=$("#NewBlockName").val()||"新增";co.HtmlContent.AddUp({Title:t,Type:$("#ComponerTypeList>option:selected").val()}).done((function(s){if(s.success){let n="customBlockTemplate_"+s.message.split(" ").join("_"),o={id:s.message,name:t,blockId:n};!function(e,t){const s=t.blockId,n=t.name;let o=$(e.getEl().outerHTML).removeClass("gjs-selected")[0].outerHTML,i=o.substring(0,o.indexOf(" ")),a=o.substring(o.indexOf(" ")+1);i+=` custom_block_template=true block_id="${s}" `;let c=i+a,r=$("#NewBlockicon").val();const d=l(e),u=c+`<style>${d}</style>`,p=$("#ComponerTypeList>option:selected").text(),f={id:t.id,Title:n,icon:r,type:$("#ComponerTypeList>option:selected").val(),Html:$("<div/>").text(c).html(),css:d};co.HtmlContent.AddUp(f).done((function(e){if(e.success){let e="";/material-symbols-outlined/.test(r)&&(e=r.replace("material-symbols-outlined","").trim()),m(s,{category:p,attributes:{custom_block_template:!0},label:`${n}`,media:`<i class="${r} fa-5x">${e}</i>`,content:u})}else co.sweet.error(e.error)}))}(e,o),document.getElementById("ComFrm").reset()}else co.sweet.error(s.error)}))};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const p=new bootstrap.Modal("#setComponents"),f=$("#NewBlockicon").iconpicker({cols:4,rows:4,footer:!1,iconset:"GoogleMaterialSymbolsOutlined"});co.HtmlContent.GetTypeList().done((function(e){if(e.success){var t=$("#ComponerTypeList");$(e.type).each((function(){t.append(`<option value="${this.value}">${this.key}</option>`)})),e.type.length>1&&t.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){u(),p.hide(),co.sweet.success("加入我的最愛")})),f.on("change",(function(e){$("#NewBlockicon").val(e.icon)})),t.getComponer().done((function(e){$(e).each((function(){const e=`${co.Data.HtmlDecode(this.html)}<style>${this.css}</style>`;let t="customBlockTemplate_"+this.id,s="";/^fa/.test(this.icon)?media=`<i class="${this.icon} fa-5x"></i>`:media=`<i class="material-icons material-symbols-outlined fa-5x">${this.icon}</i>`,/material-symbols-outlined/.test(this.icon)&&(s=this.icon.replace("material-symbols-outlined","").trim()),m(t,{category:this.typeName,attributes:{custom_block_template:!0},label:`${this.title}`,media:`<i class="${this.icon} fa-5x">${s}</i>`,content:e})}))})),n.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(e){t.save(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),n.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(e){console.log("in"),t.import(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1});var b=setInterval((function(){i.models.length>1&&clearInterval(b),$(i.models).each((function(e,t){t.set("open",0==e).on("change:open",(function(e){e.get("open")&&i.each((t=>{t!==e&&t.set("open",!1)}))}))}))}),500);$.fn.extend({removeAllElemntId:function(){$(this).removeAttr("id").removeClass("gjs-selected"),$(this).children().each((function(e,t){$(t).removeAllElemntId()}))}});var g=function(){p.show()},v="default",h=s.DomComponents.getType(v),y=s.DomComponents.getType(v).model;return s.DomComponents.addType(v,{model:{initToolbar(){y.prototype.initToolbar.apply(this,arguments);const e=this.get("toolbar");e.some((e=>e.command===g))||(e.unshift({command:g,label:'<i class="fa fa-star"></i>'}),this.set("toolbar",e))}},view:h.view.extend({events:{dblclick:"editLink"},editLink:function(e){e.stopImmediatePropagation(),s.runCommand(g,{})}})}),co.File.getFileList(0).done((function(e){if(e.success){var n=[];t.asset=e.files,$(e.files).each((function(e){n.push(this.path)}));var o=n;s.AssetManager.add(o)}})),s};