var grapesInit=function(t){var e={save:function(){return!1},import:function(){return!1}};$.extend(!0,e,t);var o=grapesjs.init({showOffsets:1,noticeOnUnload:0,container:"#gjs",plugins:["gjs-blocks-basic","grapesjs-preset-webpage","grapesjs-style-bg","grapesjs-tabs","grapesjs-custom-code","grapesjs-tui-image-editor","grapesjs-blocks-table"],pluginsOpts:{"gjs-blocks-basic":{flexGrid:!0},"grapesjs-preset-webpage":{modalImportTitle:"Import Template",modalImportLabel:'<div style="margin-bottom: 10px; font-size: 13px;">Paste here your HTML/CSS and click Import</div>',modalImportContent:function(t){return t.getHtml()+"<style>"+t.getCss()+"</style>"}},"grapesjs-tabs":{tabsBlock:{category:"Extra"}},"grapesjs-tui-image-editor":{script:["https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js","https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.js"],style:["https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.css","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.css"]},"grapesjs-blocks-table":{containerId:"#gjs"}},canvas:{styles:["/lib/bootstrap/dist/css/bootstrap.min.css","/lib/swiper/swiper-bundle.min.css"],scripts:["/lib/bootstrap/dist/js/bootstrap.bundle.min.js","/lib/swiper/swiper-bundle.min.js"]},fromElement:!0,storageManager:{autoload:0}}),s=o.Panels,n=o.BlockManager.getCategories();const a=(t,e)=>{const o=t.CssComposer.getRule(`#${e}`),s=t.CssComposer.getRule(`#${e}:hover`);return o?s?o.toCSS()+" "+s.toCSS():o.toCSS():""},i=function(t){let e="";if(t){const s=t.components().models;if(s){for(const t of s)e+=i(t);return e+a(o,t.getId())}return a(o,t.getId())}},l=function(){const t=o.getSelected();let e=$("#NewBlockName").val()||"新增",s="customBlockTemplate_"+e.split(" ").join("_"),n={name:e,blockId:s};console.log($("#NewBlockicon").val()),function(t,e){const s=o.BlockManager,n=e.blockId,a=e.name;let l=t.getEl().outerHTML,c=l.substring(0,l.indexOf(" "));c+=` custom_block_template=true block_id="${n}" `;let d=c+l.substring(l.indexOf(" ")+1),r=$("#NewBlockicon").val();const m=d+`<style>${i(t)}</style>`;s.add(`customBlockTemplate_${n}`,{category:"自訂區",attributes:{custom_block_template:!0},label:`${a}`,media:`<i class="${r} fa-5x"></i>`,content:m})}(t,n)};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <div class="form-floating mb-3 input-group">\n                <input type="hidden" name="icon">\n                <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                <label for="floatingInput">元件名稱</label>\n                <div class="input-group-append">\n                    <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                </div>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const c=new bootstrap.Modal("#setComponents"),d=$("#NewBlockicon").iconpicker({cols:4,rows:4,footer:!1,iconset:"fontawesome5"});$("#setComponents").find(".btn-save").on("click",(function(){l(),c.hide(),co.sweet.success("加入我的最愛")})),d.on("change",(function(t){$("#NewBlockicon").val(t.icon)})),s.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(t){e.save(t.getHtml(),t.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),s.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(t){console.log("in"),e.import(t.getHtml(),t.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1}),o.BlockManager.add("testBlock",{category:"自訂區",label:"歡迎區",attributes:{class:"gjs-fonts gjs-f-b1",title:"hello"},content:'<div class="welecom" style="text-align:center"><span>Hello World</span></div>'}),o.addComponents('<div id="yui" class="cls">New component</div>');var r=setInterval((function(){n.models.length>1&&clearInterval(r),$(n.models).each((function(t,e){e.set("open",0==t).on("change:open",(function(t){t.get("open")&&n.each((e=>{e!==t&&e.set("open",!1)}))}))}))}),500);$.fn.extend({removeAllElemntId:function(){$(this).removeAttr("id").removeClass("gjs-selected"),$(this).children().each((function(t,e){$(e).removeAllElemntId()}))}});var m=function(){c.show()},p="default",u=o.DomComponents.getType(p),b=o.DomComponents.getType(p).model;return o.DomComponents.addType(p,{model:{initToolbar(){b.prototype.initToolbar.apply(this,arguments);const t=this.get("toolbar");t.some((t=>t.command===m))||(t.unshift({command:m,label:'<i class="fa fa-star"></i>'}),this.set("toolbar",t))}},view:u.view.extend({events:{dblclick:"editLink"},editLink:function(t){t.stopImmediatePropagation(),o.runCommand(m,{})}})}),o};