var grapesInit=function(t){var e={save:function(){return!1},import:function(){return!1}};$.extend(!0,e,t);var o=grapesjs.init({showOffsets:1,noticeOnUnload:0,container:"#gjs",plugins:["gjs-blocks-basic","grapesjs-preset-webpage","grapesjs-style-bg","grapesjs-tabs","grapesjs-custom-code","grapesjs-tui-image-editor","grapesjs-blocks-table"],pluginsOpts:{"gjs-blocks-basic":{flexGrid:!0},"grapesjs-preset-webpage":{modalImportTitle:"Import Template",modalImportLabel:'<div style="margin-bottom: 10px; font-size: 13px;">Paste here your HTML/CSS and click Import</div>',modalImportContent:function(t){return t.getHtml()+"<style>"+t.getCss()+"</style>"}},"grapesjs-tabs":{tabsBlock:{category:"Extra"}},"grapesjs-tui-image-editor":{script:["https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js","https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.js"],style:["https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.css","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.css"]},"grapesjs-blocks-table":{containerId:"#gjs"}},canvas:{styles:["/lib/bootstrap/dist/css/bootstrap.min.css","/lib/swiper/swiper-bundle.min.css"],scripts:["/lib/bootstrap/dist/js/bootstrap.bundle.min.js","/lib/swiper/swiper-bundle.min.js"]},fromElement:!0,storageManager:{autoload:0}}),s=o.Panels,n=o.BlockManager.getCategories();const i=(t,e)=>{const o=t.CssComposer.getRule(`#${e}`),s=t.CssComposer.getRule(`#${e}:hover`);return o?s?o.toCSS()+" "+s.toCSS():o.toCSS():""},a=function(t){let e="";if(t){const s=t.components().models;if(s){for(const t of s)e+=a(t);return e+i(o,t.getId())}return i(o,t.getId())}},l=function(t,e){o.BlockManager.add(`customBlockTemplate_${t}`,e)},c=function(){const t=o.getSelected();let e=$("#NewBlockName").val()||"新增",s="customBlockTemplate_"+e.split(" ").join("_"),n={name:e,blockId:s};console.log(s),function(t,e){const o=e.blockId,s=e.name;let n=t.getEl().outerHTML,i=n.substring(0,n.indexOf(" "));i+=` custom_block_template=true block_id="${o}" `;let c=i+n.substring(n.indexOf(" ")+1),d=$("#NewBlockicon").val();const r=`<style>${a(t)}</style>`,p=c+r,m=$("#ComponerTypeList>option:selected").text();$("#ComponerTypeList>option:selected").val(),l(o,{category:m,attributes:{custom_block_template:!0},label:`${s}`,media:`<i class="${d} fa-5x"></i>`,content:p})}(t,n)};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const d=new bootstrap.Modal("#setComponents"),r=$("#NewBlockicon").iconpicker({cols:4,rows:4,footer:!1,iconset:"fontawesome5"});co.HtmlContent.GetTypeList().done((function(t){if(t.success){var e=$("#ComponerTypeList");$(t.type).each((function(){e.append(`<option value="${this.value}">${this.key}</option>`)})),t.type.length>1&&e.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){c(),d.hide(),co.sweet.success("加入我的最愛")})),r.on("change",(function(t){$("#NewBlockicon").val(t.icon)})),s.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(t){e.save(t.getHtml(),t.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),s.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(t){console.log("in"),e.import(t.getHtml(),t.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1}),o.BlockManager.add("testBlock",{category:"自訂區",label:"歡迎區",attributes:{class:"gjs-fonts gjs-f-b1",title:"hello"},content:'<div class="welecom" style="text-align:center"><span>Hello World</span></div>'}),o.addComponents('<div id="yui" class="cls">New component</div>');var p=setInterval((function(){n.models.length>1&&clearInterval(p),$(n.models).each((function(t,e){e.set("open",0==t).on("change:open",(function(t){t.get("open")&&n.each((e=>{e!==t&&e.set("open",!1)}))}))}))}),500);$.fn.extend({removeAllElemntId:function(){$(this).removeAttr("id").removeClass("gjs-selected"),$(this).children().each((function(t,e){$(e).removeAllElemntId()}))}});var m=function(){d.show()},u="default",b=o.DomComponents.getType(u),g=o.DomComponents.getType(u).model;return o.DomComponents.addType(u,{model:{initToolbar(){g.prototype.initToolbar.apply(this,arguments);const t=this.get("toolbar");t.some((t=>t.command===m))||(t.unshift({command:m,label:'<i class="fa fa-star"></i>'}),this.set("toolbar",t))}},view:b.view.extend({events:{dblclick:"editLink"},editLink:function(t){t.stopImmediatePropagation(),o.runCommand(m,{})}})}),o};