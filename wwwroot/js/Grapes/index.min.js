var grapesInit=function(e){var t={save:function(){return!1},import:function(){return!1},getComponer:function(){return!1},asset:[]};$.extend(!0,t,e);var s=grapesjs.init({showOffsets:1,noticeOnUnload:0,container:"#gjs",assetManager:{uploadFile:function(e){var t=e.dataTransfer?e.dataTransfer.files:e.target.files,o=new FormData;for(var n in t)o.append("files",t[n]);o.append("type",0),co.File.Upload(o).done((function(e){if(e.success){var t=[];$(e.files).each((function(e){t.push(this.path)}));var o=t;s.AssetManager.add(o)}}))}},plugins:["gjs-blocks-basic","grapesjs-preset-webpage","grapesjs-style-bg","grapesjs-tabs","grapesjs-custom-code","grapesjs-tui-image-editor","grapesjs-blocks-table"],pluginsOpts:{"gjs-blocks-basic":{flexGrid:!0},"grapesjs-preset-webpage":{modalImportTitle:"Import Template",modalImportLabel:'<div style="margin-bottom: 10px; font-size: 13px;">Paste here your HTML/CSS and click Import</div>',modalImportContent:function(e){return e.getHtml()+"<style>"+e.getCss()+"</style>"}},"grapesjs-tabs":{tabsBlock:{category:"Extra"}},"grapesjs-tui-image-editor":{script:["https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.6.7/fabric.min.js","https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js","https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.js"],style:["https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.css","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.css"]},"grapesjs-blocks-table":{containerId:"#gjs"}},canvas:{styles:["/lib/bootstrap/dist/css/bootstrap.min.css","/lib/swiper/swiper-bundle.min.css","/css/Grapes/GrapesCss.min.css","https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200","/shared/css/Frame.min.css","/shared/css/HoverEffect.min.css","/shared/css/Swiper.min.css"],scripts:["/lib/bootstrap/dist/js/bootstrap.bundle.min.js","/lib/swiper/swiper-bundle.min.js","/shared/js/Frame.min.js","/shared/js/Swiper.min.js","/shared/js/ViewTypeChange.min.js"]},fromElement:!0,storageManager:{autoload:0}});s.on("asset:remove",(e=>{let s;var o=e.get("src").split("/").reverse()[0].split(".")[0];t.asset.every((function(e,t){return!(e.path.indexOf(o)>0)||(s=e.guid,!1)})),co.File.Delete(s).done((function(e){console.log(e)}))}));var o=s.Panels;const n=s.BlockManager;var i=s.BlockManager.getCategories();const a=e=>{const t=e.getEl(),o=e.getId(),n=t.classList,i=s.CssComposer.getRule(`#${o}`),a=s.CssComposer.getRule(`#${o}:hover`);let l="";return $(n).each((function(){if(this){const e=this.toString(),t=s.CssComposer.getRule(`.${e}`),o=s.CssComposer.getRule(`.${e}:hover`);t&&(l=`${l} ${t.toCSS()}`),o&&(l=`${l} ${o.toCSS()}`)}})),i?(a&&(l=`${i.toCSS()} ${a.toCSS()} ${l}`),l=`${i.toCSS()} ${l}`):l},l=function(e){let t="";if(e){const s=e.components().models;if(s){for(const e of s)t+=l(e);return t+a(e)}return a(e)}};let c=null;const r=function(e){let t;return{getInstance:function(){return t||(t=function(){const t=document.createElement("ul");t.classList.add("custom-context-menu");const{menus:s}=e;if(s&&s.length>0)for(let e of s){const s=document.createElement("li");s.textContent=e.name,s.onclick=e.onClick,t.appendChild(s)}return document.querySelector("body").appendChild(t),t}()),t}}}({menus:[{name:"加入至頁面",onClick:function(e){const t=n.get(c);s.addComponents(t.attributes.content)}},{name:"刪除元件",onClick:function(e){d()}}]});function d(){const e=c.split("_"),t=e[e.length-1];console.log(t),co.HtmlContent.Delete(t).done((function(e){e.success?(n.remove(c),co.sweet.success("成功",null,!0)):co.sweet.error(e.error)}))}document.addEventListener("click",(function(e){r.getInstance().style.display="none"}));const m=function(e,t){const s=`customBlockTemplate_${e}`;var o={render:({model:e,el:o})=>{o.addEventListener("dblclick",(()=>{co.sweet.confirm("即將刪除",co.sweet.TitleHilight("是否要確認將{0}刪除?",t.label),"確認","取消",(function(){c=s,d()}))})),o.addEventListener("contextmenu",(e=>{e.preventDefault(),c=s,function(e){const t=r.getInstance();t.style.top=`${e.clientY}px`,t.style.left=`${e.clientX}px`,t.style.display="block"}(e)}))}};$.extend(!0,o,t),n.add(s,o)},p=function(){const e=s.getSelected();let t=$("#NewBlockName").val()||"新增";co.HtmlContent.AddUp({Title:t,Type:$("#ComponerTypeList>option:selected").val()}).done((function(s){if(s.success){let o="customBlockTemplate_"+s.message.split(" ").join("_"),n={id:s.message,name:t,blockId:o};!function(e,t){const s=t.blockId,o=t.name;let n=$(e.getEl().outerHTML).removeClass("gjs-selected")[0].outerHTML,i=n.substring(0,n.indexOf(" ")),a=n.substring(n.indexOf(" ")+1);i+=` custom_block_template=true block_id="${s}" `;let c=i+a,r=$("#NewBlockicon").val();const d=l(e),p=c+`<style>${d}</style>`,u=$("#ComponerTypeList>option:selected").text(),f={id:t.id,Title:o,icon:r,type:$("#ComponerTypeList>option:selected").val(),Html:$("<div/>").text(c).html(),css:d};co.HtmlContent.AddUp(f).done((function(e){if(e.success){let e="";/material-symbols-outlined/.test(r)&&(e=r.replace("material-symbols-outlined","").trim()),m(s,{category:u,attributes:{custom_block_template:!0},label:`${o}`,media:`<i class="${r} fa-5x">${e}</i>`,content:p})}else co.sweet.error(e.error)}))}(e,n),document.getElementById("ComFrm").reset()}else co.sweet.error(s.error)}))};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const u=new bootstrap.Modal("#setComponents"),f=$("#NewBlockicon").iconpicker({cols:4,rows:4,footer:!1,iconset:"GoogleMaterialSymbolsOutlined"});co.HtmlContent.GetTypeList().done((function(e){if(e.success){var t=$("#ComponerTypeList");$(e.type).each((function(){t.append(`<option value="${this.value}">${this.key}</option>`)})),e.type.length>1&&t.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){p(),u.hide(),co.sweet.success("加入我的最愛")})),f.on("change",(function(e){$("#NewBlockicon").val(e.icon)})),t.getComponer().done((function(e){$(e).each((function(){const e=`${co.Data.HtmlDecode(this.html)}<style>${this.css}</style>`;let t="customBlockTemplate_"+this.id,s="";/^fa/.test(this.icon)?media=`<i class="${this.icon} fa-5x"></i>`:media=`<i class="material-icons material-symbols-outlined fa-5x">${this.icon}</i>`,/material-symbols-outlined/.test(this.icon)&&(s=this.icon.replace("material-symbols-outlined","").trim()),m(t,{category:this.typeName,attributes:{custom_block_template:!0},label:`${this.title}`,media:`<i class="${this.icon} fa-5x">${s}</i>`,content:e})}))})),o.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(e){t.save(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),o.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(e){console.log("in"),t.import(e.getHtml(),e.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1});var b=setInterval((function(){i.models.length>1&&clearInterval(b),$(i.models).each((function(e,t){t.set("open",0==e).on("change:open",(function(e){e.get("open")&&i.each((t=>{t!==e&&t.set("open",!1)}))}))}))}),500);$.fn.extend({removeAllElemntId:function(){$(this).removeAttr("id").removeClass("gjs-selected"),$(this).children().each((function(e,t){$(t).removeAllElemntId()}))}});var g=function(){u.show()},v="default",h=s.DomComponents.getType(v),y=s.DomComponents.getType(v).model;return s.DomComponents.addType(v,{model:{initToolbar(){y.prototype.initToolbar.apply(this,arguments);const e=this.get("toolbar");e.some((e=>e.command===g))||(e.unshift({command:g,label:'<i class="fa fa-star"></i>'}),this.set("toolbar",e))}},view:h.view.extend({events:{dblclick:"editLink"},editLink:function(e){e.stopImmediatePropagation(),s.runCommand(g,{})}})}),co.File.getFileList(0).done((function(e){if(e.success){var o=[];t.asset=e.files,$(e.files).each((function(e){o.push(this.path)}));var n=o;s.AssetManager.add(n)}})),s};