var grapesInit=function(t){var e={save:function(){return!1},import:function(){return!1},getComponer:function(){return!1}};$.extend(!0,e,t);var o=grapesjs.init({showOffsets:1,noticeOnUnload:0,container:"#gjs",plugins:["gjs-blocks-basic","grapesjs-preset-webpage","grapesjs-style-bg","grapesjs-tabs","grapesjs-custom-code","grapesjs-tui-image-editor","grapesjs-blocks-table"],pluginsOpts:{"gjs-blocks-basic":{flexGrid:!0},"grapesjs-preset-webpage":{modalImportTitle:"Import Template",modalImportLabel:'<div style="margin-bottom: 10px; font-size: 13px;">Paste here your HTML/CSS and click Import</div>',modalImportContent:function(t){return t.getHtml()+"<style>"+t.getCss()+"</style>"}},"grapesjs-tabs":{tabsBlock:{category:"Extra"}},"grapesjs-tui-image-editor":{script:["https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js","https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.js"],style:["https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.css","https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.css"]},"grapesjs-blocks-table":{containerId:"#gjs"}},canvas:{styles:["/lib/bootstrap/dist/css/bootstrap.min.css","/lib/swiper/swiper-bundle.min.css"],scripts:["/lib/bootstrap/dist/js/bootstrap.bundle.min.js","/lib/swiper/swiper-bundle.min.js"]},fromElement:!0,storageManager:{autoload:0}}),n=o.Panels;const s=o.BlockManager;var i=o.BlockManager.getCategories();const l=t=>{const e=t.getEl(),n=t.getId(),s=e.classList,i=o.CssComposer.getRule(`#${n}`),l=o.CssComposer.getRule(`#${n}:hover`);let c="";return $(s).each((function(){if(this){const t=this.toString(),e=o.CssComposer.getRule(`.${t}`),n=o.CssComposer.getRule(`.${t}:hover`);e&&(c=`${c} ${e.toCSS()}`),n&&(c=`${c} ${n.toCSS()}`)}})),i?(l&&(c=`${i.toCSS()} ${l.toCSS()} ${c}`),c=`${i.toCSS()} ${c}`):c},c=function(t){let e="";if(t){const o=t.components().models;if(o){for(const t of o)e+=c(t);return e+l(t)}return l(t)}};let a=null;const r=function(t){let e;return{getInstance:function(){return e||(e=function(){const e=document.createElement("ul");e.classList.add("custom-context-menu");const{menus:o}=t;if(o&&o.length>0)for(let t of o){const o=document.createElement("li");o.textContent=t.name,o.onclick=t.onClick,e.appendChild(o)}return document.querySelector("body").appendChild(e),e}()),e}}}({menus:[{name:"加入至頁面",onClick:function(t){const e=s.get(a);o.addComponents(e.attributes.content)}},{name:"刪除元件",onClick:function(t){d()}}]});function d(){const t=a.split("_"),e=t[t.length-1];console.log(e),co.HtmlContent.Delete({id:e}).done((function(t){t.success?(s.remove(a),co.sweet.success("成功",null,!0)):co.sweet.error(t.error)}))}document.addEventListener("click",(function(t){r.getInstance().style.display="none"}));const m=function(t,e){const o=`customBlockTemplate_${t}`;var n={render:({model:t,el:n})=>{n.addEventListener("dblclick",(()=>{co.sweet.confirm("即將刪除",co.sweet.TitleHilight("是否要確認將{0}刪除?",e.label),"確認","取消",(function(){a=o,d()}))})),n.addEventListener("contextmenu",(t=>{t.preventDefault(),a=o,function(t){const e=r.getInstance();e.style.top=`${t.clientY}px`,e.style.left=`${t.clientX}px`,e.style.display="block"}(t)}))}};$.extend(!0,n,e),s.add(o,n)},p=function(){const t=o.getSelected();let e=$("#NewBlockName").val()||"新增";co.HtmlContent.AddUp({Title:e,Type:$("#ComponerTypeList>option:selected").val()}).done((function(o){if(o.success){let n="customBlockTemplate_"+o.message.split(" ").join("_"),s={id:o.message,name:e,blockId:n};!function(t,e){const o=e.blockId,n=e.name;let s=$(t.getEl().outerHTML).removeClass("gjs-selected")[0].outerHTML,i=s.substring(0,s.indexOf(" ")),l=s.substring(s.indexOf(" ")+1);i+=` custom_block_template=true block_id="${o}" `;let a=i+l,r=$("#NewBlockicon").val();const d=c(t),p=a+`<style>${d}</style>`,u=$("#ComponerTypeList>option:selected").text(),b={id:e.id,Title:n,icon:r,type:$("#ComponerTypeList>option:selected").val(),Html:$("<div/>").text(a).html(),css:d};co.HtmlContent.AddUp(b).done((function(t){console.log(t),t.success?m(o,{category:u,attributes:{custom_block_template:!0},label:`${n}`,media:`<i class="${r} fa-5x"></i>`,content:p}):co.sweet.error(t.error)}))}(t,s),document.getElementById("ComFrm").reset()}else co.sweet.error(o.error)}))};$('<div id="setComponents" class="modal" tabindex="-1">\n      <div class="modal-dialog">\n        <div class="modal-content">\n          <div class="modal-header">\n            <h5 class="modal-title">Modal title</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n          </div>\n          <div class="modal-body">\n            <form id="ComFrm" class="form-horizontal needs-validation" novalidate>\n                <div class="form-floating mb-3 input-group">\n                    <input type="hidden" name="icon">\n                    <input type="text" class="form-control" id="NewBlockName" placeholder="請輸入新元件的名稱">\n                    <label for="floatingInput">元件名稱</label>\n                    <div class="input-group-append">\n                        <button type="button" id="NewBlockicon" class="btn btn-outline-secondary"></button>\n                    </div>\n                </div>\n                <div class="d-none">\n                    <select name="ComponerTypeList" id="ComponerTypeList" class="form-select item-menu" aria-label="類別">\n                        <option value="" disabled="disabled">類別</option>\n                    </select>\n                    <div class="invalid-feedback">類別必填</div>\n                </div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary btn-save">Save changes</button>\n          </div>\n        </div>\n      </div>\n    </div>').appendTo("body");const u=new bootstrap.Modal("#setComponents"),b=$("#NewBlockicon").iconpicker({cols:4,rows:4,footer:!1,iconset:"fontawesome5"});co.HtmlContent.GetTypeList().done((function(t){if(t.success){var e=$("#ComponerTypeList");$(t.type).each((function(){e.append(`<option value="${this.value}">${this.key}</option>`)})),t.type.length>1&&e.parents(".d-none").removeClass("d-none")}})),$("#setComponents").find(".btn-save").on("click",(function(){p(),u.hide(),co.sweet.success("加入我的最愛")})),b.on("change",(function(t){$("#NewBlockicon").val(t.icon)})),e.getComponer().done((function(t){$(t).each((function(){const t=`${$("<div/>").html(this.html).text()}<style>${this.css}</style>`;let e="customBlockTemplate_"+this.id;m(e,{category:this.typeName,attributes:{custom_block_template:!0},label:`${this.title}`,media:`<i class="${this.icon} fa-5x"></i>`,content:t})}))})),n.addButton("options",{id:"panelSave",className:"someClass",label:'<i title="儲存" class="fa fa-download"></i>',command:function(t){e.save(t.getHtml(),t.getCss()).done((function(){co.sweet.success("已儲存草稿")}))},attributes:{title:"save"},active:!1}),n.addButton("options",{id:"panelImport",className:"someClass",label:'<i title="發布" class="fa fa-cloud-arrow-up""></i>',command:function(t){console.log("in"),e.import(t.getHtml(),t.getCss()).done((function(){co.sweet.success("已儲存並發布")}))},attributes:{title:"save"},active:!1});var g=setInterval((function(){i.models.length>1&&clearInterval(g),$(i.models).each((function(t,e){e.set("open",0==t).on("change:open",(function(t){t.get("open")&&i.each((e=>{e!==t&&e.set("open",!1)}))}))}))}),500);$.fn.extend({removeAllElemntId:function(){$(this).removeAttr("id").removeClass("gjs-selected"),$(this).children().each((function(t,e){$(e).removeAllElemntId()}))}});var f=function(){u.show()},v="default",C=o.DomComponents.getType(v),h=o.DomComponents.getType(v).model;return o.DomComponents.addType(v,{model:{initToolbar(){h.prototype.initToolbar.apply(this,arguments);const t=this.get("toolbar");t.some((t=>t.command===f))||(t.unshift({command:f,label:'<i class="fa fa-star"></i>'}),this.set("toolbar",t))}},view:C.view.extend({events:{dblclick:"editLink"},editLink:function(t){t.stopImmediatePropagation(),o.runCommand(f,{})}})}),o};