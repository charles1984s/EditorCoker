var $btn_display,$title,$illustrate,$illustrate_count,$input_sort,$check_sort,$date,$permanent,startDate,endDate,keyId,technicalCertificate_list,disp_opt=!0;function PageReady(){const e=grapesInit({save:null,import:function(e,t){var a=$.Deferred();return co.TechnicalCertificate.SaveConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:t}).done((function(e){e.success?a.resolve():co.sweet.error(e.error)})),a.promise()},getComponer:function(){var e=$.Deferred();return co.HtmlContent.GetAllComponent().done((function(t){t.success?e.resolve(t.list):co.sweet.error(resutlt.error)})),e.promise()}});setPage=function(t){$("body").addClass("grapesEdit"),console.log(co.TechnicalCertificate),co.TechnicalCertificate.GetConten({Id:t}).done((function(t){if(t.success){var a=co.Data.HtmlDecode(t.conten.saveHtml);co.Grapes.setEditor(e,a,t.conten.saveCss),t.title&&$("#TopLine .title").text(t.title)}else co.sweet.error(t.error)}))},ImageUploadModalInit($("#ImageUpload")),ElementInit(),co.Picker.Init($picker),$picker.on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("YYYY/MM/DD HH:mm")+" ~ "+t.endDate.format("YYYY/MM/DD HH:mm")),startDate=t.startDate.format(""),endDate=t.endDate.format("")}));const t=$("#TechnicalCertificateForm");Array.from(t).forEach((e=>{e.addEventListener("submit",(t=>{e.checkValidity()||(t.preventDefault(),t.stopPropagation()),t.preventDefault(),$("#ImageUpload").find(".img_input").length<=1?co.sweet.error("資料有誤","至少需上傳一張圖片",null,!1):Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp(disp_opt,"已成功發布","發布發生未知錯誤")})),e.classList.add("was-validated"),WasValidated()}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回技術證照列表","資料將不被保存","確定","取消",(function(){history.back()}))})),$(".btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),$(".btn_expand").on("click",(function(){var e=$(this);"expand_more"==e.children("span").text()?e.children("span").text("expand_less"):e.children("span").text("expand_more")})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$illustrate.on("keyup",(function(){$illustrate_count.text($illustrate.val().length)})),$check_sort.on("click",(function(){$check_sort.is(":checked")?$input_sort.removeAttr("disabled"):($input_sort.val(""),$input_sort.attr("disabled","disabled"))})),$permanent.on("click",(function(){$permanent.is(":checked")?($date.val(""),$date.attr("disabled","disabled"),startDate=null,endDate=null):$date.removeAttr("disabled")})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$picker=$("#InputDate"),$btn_display=$("#Btn_Display"),$title=$("#InputTitle"),$illustrate=$("#InputIllustrate"),$illustrate_count=$("#TechnicalCertificateForm > .illustrate .illustrate_count"),$input_sort=$("#InputSort"),$check_sort=$("#SortCheck"),$date=$("#InputDate"),$permanent=$("#PermanentCheck")}function contentReady(e){technicalCertificate_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");0==parseInt(e)?(FormDataClear(),MoveToContent()):co.TechnicalCertificate.Get(parseInt(e)).done((function(t){keyId=parseInt(e),e.indexOf("-")>0?MoveToCanvas():(MoveToContent(),null!=t?co.File.getImgFile({Sid:t.id,Type:4,Size:3}).done((function(e){FormDataSet(t,e)})):window.location.hash="")}))}}else BackToList()}function editButtonClicked(e){MoveToContent(),keyId=e.row.key,window.location.hash=keyId}function paletteButtonClicked(e){keyId=e.row.key,window.location.hash=keyId+"-1"}function FormDataSet(e,t){FormDataClear(),keyId=e.id,startDate=e.startDate,endDate=e.endDate,$btn_display.children("span").text(e.disp_opt?"visibility":"visibility_off"),disp_opt=e.disp_opt,$title.val(e.title),500!=e.ser_no&&($check_sort.prop("checked",!0),$input_sort.removeAttr("disabled","disabled"),$input_sort.val(e.ser_no)),$illustrate.val(e.description),$illustrate_count.text($illustrate.val().length),e.permanent?($date.val(""),$date.attr("disabled","disabled"),$permanent.prop("checked",!0)):(null!=startDate&&$picker.data("daterangepicker").setStartDate(startDate),null!=endDate&&$picker.data("daterangepicker").setEndDate(endDate));for(var a=0;a<t.length;a++)ImageUploadModalDataInsert($("#ImageUpload"),t[a].id,t[a].link,t[a].name)}function FormDataClear(){ImageUploadModalClear($("#ImageUpload")),keyId=0,$btn_display.children("span").text("visibility"),disp_opt=!0,$title.val(""),$illustrate.val(""),$illustrate_count.text(0),$input_sort.val(""),$input_sort.attr("disabled","disabled"),$check_sort.prop("checked",!1),$permanent.prop("checked",!0),$date.val(""),$date.attr("disabled","disabled"),startDate=null,endDate=null}function deleteButtonClicked(e){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.TechnicalCertificate.Delete(e.row.key).done((function(t){t.success?e.component.refresh():Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)})).fail((function(){Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)}))}))}function AddUp(e,t,a){void 0!==$("#ImageUpload").find(".img_input_frame").data("delectList")&&null!=$("#ImageUpload").find(".img_input_frame").data("delectList")&&co.File.DeleteFileById({sid:keyId,type:4,fid:$("#ImageUpload").find(".img_input_frame").data("delectList")}),co.TechnicalCertificate.AddUp({Id:keyId,TId:$.cookie("secret"),Disp_opt:e,Img:"",Title:$title.val(),Description:$illustrate.val(),Ser_no:$check_sort.is(":checked")?$input_sort.val():500,StartDate:startDate,EndDate:endDate,permanent:$permanent.is(":checked")}).done((function(e){if(e.success){var n=0,i=0,o=0;$("#ImageUpload .img_input_frame > .img_input").each((function(){var t=$(this);if(void 0!==t.data("file")&&0==t.data("file").id){n++;var a=new FormData;a.append("type",4),a.append("sid",e.message),a.append("serno",500),a.append("files",t.data("file").File[0]),a.append("files",t.data("file").File[1]),a.append("files",t.data("file").File[2]),co.File.Upload(a).done((function(e){e.success?i++:o++}))}}));const s=function(){n==i+o?o>0?Coker.sweet.error("錯誤",a,null,!0):(Coker.sweet.success(t,null,!0),setTimeout((function(){BackToList(),FormDataClear(),technicalCertificate_list.component.refresh()}),1e3)):setTimeout(s,100)};setTimeout(s,100)}else Coker.sweet.error("錯誤",a,null,!0)})).fail((function(){Coker.sweet.error("錯誤",a,null,!0)}))}function MoveToCanvas(){UnValidated(),$("#gjs").data("id",keyId),setPage(keyId),$("#TopLine > div > a").removeClass("d-none"),$("#TechnicalCertificateList,#TechnicalCertificateContent").addClass("d-none"),$("#TechnicalCertificateCanvas").removeClass("d-none")}function MoveToContent(){UnValidated(),$("#TechnicalCertificateList,#TechnicalCertificateCanvas").addClass("d-none"),$("#TechnicalCertificateContent").removeClass("d-none")}function BackToList(){$("#TechnicalCertificateList").removeClass("d-none"),$("#TechnicalCertificateContent,#TechnicalCertificateCanvas").addClass("d-none"),$("#TopLine > div > a").addClass("d-none"),$("body").removeClass("grapesEdit"),$("#TopLine .title").text("技術證照"),window.location.hash=""}function WasValidated(){$(".icon_hint").addClass("pe-4"),$check_sort.parents(".checkbox").first().addClass("pe-4"),$permanent.parents(".checkbox").first().addClass("pe-4")}function UnValidated(){$("#TechnicalCertificateForm").removeClass("was-validated"),$(".icon_hint").removeClass("pe-4"),$check_sort.parents(".checkbox").first().removeClass("pe-4"),$permanent.parents(".checkbox").first().removeClass("pe-4")}