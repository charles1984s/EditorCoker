var $btn_display,$name,$name_count,$introduction,$introduction_count,$illustrate,$illustrate_count,$marks,$tag,$price,$stock_number,$alert_number,$min_number,$date,$picker,$permanent,startDate,endDate,keyId,price_tid,temp_psid,product_list,$price_modal,priceModal,$techcert_body,techcertModal,techcert_changedBySelectBox,techcert_clearSelectionButton,tag_changedBySelectBox,tag_clearSelectionButton,techcert_text,tag_text,disp_opt=!0,spec_num=0,spec_price_num=0,spec_remove_list=[],modal_price_list=[],techcert_list=[],tag_list=[],techcert_check_list=[],tag_check_list=[];function PageReady(){co.Product={AddUp:{Product:function(t){return $.ajax({url:"/api/Product/ProductAddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},Stock:function(t){return $.ajax({url:"/api/Product/StockAddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},ProdTechCert:function(t){return $.ajax({url:"/api/Product/TechCertAddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},ProdPrice:function(t){return $.ajax({url:"/api/Product/ProdPriceAddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})}},Get:{ProdOne:function(t){return $.ajax({url:"/api/Product/GetProdDataOne/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{id:t}})},ProdStock:function(t){return $.ajax({url:"/api/Product/GetStockDataAll/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{PId:t}})},ProdSpec:function(t){return $.ajax({url:"/api/Product/GetSpecDetail/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{typeid:t}})},ProdTechCert:function(t){return $.ajax({url:"/api/Product/GetTechCertDataAll/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{PId:t}})},ProdPrice:function(t){return $.ajax({url:"/api/Product/GetPriceDataAll/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{PSId:t}})}},Delete:{Prod:function(t){return $.ajax({url:"/api/Product/ProdDelete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})},Stock:function(t){return $.ajax({url:"/api/Product/StockDelete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})},Price:function(t){return $.ajax({url:"/api/Product/PriceDelete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})}}},co.Tag={AddDelect:function(t){return $.ajax({url:"/api/Tag/TagAssociateAddDelect",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},Get:function(t){return $.ajax({url:"/api/Tag/GetProductDataAll/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{PId:t}})}},ElementInit(),$picker=$("#InputDate"),co.Picker.Init($picker),$picker.on("apply.daterangepicker",(function(t,e){$(this).val(e.startDate.format("YYYY/MM/DD HH:mm")+" ~ "+e.endDate.format("YYYY/MM/DD HH:mm")),startDate=e.startDate.format(""),endDate=e.endDate.format("")}));const t=$("#ProductForm");Array.from(t).forEach((t=>{t.addEventListener("submit",(e=>{if(t.checkValidity())if(e.preventDefault(),ISpecRepect())co.sweet.error("錯誤","商品規格不可重複",null,!1);else{var n,a=!1;$(".input_price").each((function(){if(""==$(this).val())return a=!0,n=$(this),!1})),a?co.sweet.error("錯誤","請確實填寫價格",(function(){setTimeout((function(){$("html, body").animate({scrollTop:n.offset().top-2*$("header").height()},0)}),500)}),!1):Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp("已成功發布","發布發生未知錯誤","List")}))}else e.preventDefault(),e.stopPropagation();t.classList.add("was-validated")}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回商品列表","資料將不被保存","確定","取消",(function(){history.back()}))})),$(".btn_add").on("click",(function(){window.location.hash=0,HashDataEdit()})),$(".btn_input_pic").on("click",(function(t){t.preventDefault(),$(".input_pic").click()})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$(".btn_expand_out").on("click",(function(){var t=$(this);"expand_less"==t.children("span").text()?t.children("span").text("expand_more"):t.children("span").text("expand_less")})),$(".btn_spec_add").on("click",(function(){SpecAdd(null)})),$(".btn_spec_price_add").on("click",(function(){SpecPriceAdd(null)})),$(".btn_price_save").on("click",SpecPriceSave),$name.on("keyup",(function(){$name_count.text($name.val().length)})),$introduction.on("keyup",(function(){$introduction_count.text($introduction.val().length)})),$illustrate.on("keyup",(function(){$illustrate_count.text($illustrate.val().length)})),$permanent.on("click",(function(){$permanent.is(":checked")?($date.val(""),$date.attr("disabled","disabled"),startDate=null,endDate=null):$date.removeAttr("disabled")})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3),$(".btn_techcert_save").on("click",(function(){techcert_check_list.length>0&&(techcert_list.forEach((function(t){var e=techcert_check_list.indexOf(t.FK_TCId);e>-1?(t.Checked=!0,techcert_check_list.splice(e,1)):t.Checked=!1})),techcert_check_list.length>0&&techcert_check_list.forEach((function(t){var e={Id:0};e.FK_TCId=t,e.Checked=!0,techcert_list.push(e)}))),$marks.val(techcert_text),techcertModal.hide()})),$(".btn_tag_save").on("click",(function(){tag_check_list.length>0&&(tag_list.forEach((function(t){var e=tag_check_list.indexOf(t.FK_TId);e>-1?(t.Checked=!0,tag_check_list.splice(e,1)):t.Checked=!1})),tag_check_list.length>0&&tag_check_list.forEach((function(t){var e={Id:0};e.FK_TId=t,e.Checked=!0,tag_list.push(e)}))),$tag.val(tag_text),tagModal.hide()})),$(".btn_to_canvas").on("click",(function(t){t.preventDefault(),Swal.fire({icon:"info",title:"前往內容編輯頁",html:"是否保存資料?",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"　是　",cancelButtonText:"　否　",reverseButtons:!0}).then((t=>{if(t.isConfirmed)AddUp("已成功發布","發布發生未知錯誤","Canvas");else{var e=window.location.hash.replace("#","")+"-1";window.location.hash=e}}))}))}function ElementInit(){$btn_display=$("#Btn_Display"),$name=$("#InputName"),$name_count=$("#ProductForm > .name .name_count"),$introduction=$("#InputIntroduction"),$introduction_count=$("#ProductForm > .introduction .introduction_count"),$illustrate=$("#InputIllustrate"),$illustrate_count=$("#ProductForm > .illustrate .illustrate_count"),$marks=$("#InputMarks"),$tag=$("#InputTag"),$spec_select=$(".spec_select"),$price=$(".input_price"),$stock_number=$(".input_stock_number"),$min_number=$(".input_min_number"),$alert_number=$(".input_alert_number"),$date=$("#InputDate"),$permanent=$("#PermanentCheck"),techcertModal=new bootstrap.Modal(document.getElementById("TechCertModal")),$("#TechCertModal").on("hidden.bs.modal",(function(){var t=[];techcert_list.forEach((function(e){e.Checked&&t.push(e.FK_TCId)})),getTechCertListDataGridInstance().selectRows(t)})),tagModal=new bootstrap.Modal(document.getElementById("TagModal")),$("#TagModal").on("hidden.bs.modal",(function(){var t=[];tag_list.forEach((function(e){e.Checked&&t.push(e.FK_TId)})),getTagListDataGridInstance().selectRows(t)})),priceModal=new bootstrap.Modal(document.getElementById("PriceModal")),$price_modal=$("#PriceModal >.modal-dialog > .modal-content > .modal-body >.price_option"),document.getElementById("PriceModal").addEventListener("hidden.bs.modal",(function(t){$price_modal.children(".frame").each((function(){$(this).remove(),spec_price_num=0})),$(".input_price").each((function(){var t=$(this),e=t.parents(".frame").data("psid"),n=t.parents(".frame").data("temppsid"),a=modal_price_list.findIndex((t=>t.PSid==e||null!=t.TempPSid&&t.TempPSid==n));a>-1?(text="現金："+modal_price_list[a].Price+" 紅利："+modal_price_list[a].Bonus,t.val(text)):t.val("")})),$(".alert_text").addClass("d-none")}))}function getTechCertListDataGridInstance(){return $("#TechCertList").dxDataGrid("instance")}function TechCertList_ClearBtnInit(t){techcert_clearSelectionButton=t.component}function TechCertList_ClearBtnClick(){techcert_list.length>0&&techcert_list.forEach((function(t){t.Checked=!1})),getTechCertListDataGridInstance().clearSelection()}function TechCertList_SelectChange(t){var e=t.selectedRowsData;techcert_check_list=[],e.length>0?(techcert_text=e.map((t=>`${t.Title}`)).join("、"),e.forEach((function(t){techcert_check_list.push(t.Id)}))):techcert_text="無",techcert_changedBySelectBox=!1,techcert_clearSelectionButton.option("disabled",!e.length)}function getTagListDataGridInstance(){return $("#TagList").dxDataGrid("instance")}function TagList_ClearBtnInit(t){tag_clearSelectionButton=t.component}function TagList_ClearBtnClick(){tag_list.length>0&&tag_list.forEach((function(t){t.Checked=!1})),getTagListDataGridInstance().clearSelection()}function TagList_SelectChange(t){var e=t.selectedRowsData;tag_check_list=[],e.length>0?(tag_text=e.map((t=>`${t.Title}`)).join("、"),e.forEach((function(t){tag_check_list.push(t.Id)}))):tag_text="無",tag_changedBySelectBox=!1,tag_clearSelectionButton.option("disabled",!e.length)}function FormDataClear(){$("#Spec_Frame > .frame").each((function(){$(this).remove()})),spec_num=0,keyId=0,$btn_display.children("span").text("visibility"),disp_opt=!0,$name.val(""),$name_count.text(0),$introduction.val(""),$introduction_count.text(0),$illustrate.val(""),$illustrate_count.text(0),$marks.val(""),$tag.val(""),$price.val(""),$stock_number.val(""),$alert_number.val(""),$min_number.val(""),$permanent.prop("checked",!1),$date.val(""),$date.removeAttr("disabled"),startDate=null,endDate=null,spec_remove_list=[],techcert_list=[],tag_list=[],modal_price_list=[],price_tid=0,temp_psid=0,techcert_text="",TechCertList_ClearBtnClick()}function contentReady(t){product_list=t,HashDataEdit()}function hashChange(t){t?(HashDataEdit(),t.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var t=window.location.hash.replace("#","");0==parseInt(t)?t.includes("-1")?MoveToCanvas():(FormDataClear(),SpecAdd(null),MoveToContent()):t.includes("-1")?MoveToCanvas():co.Product.Get.ProdOne(parseInt(t)).done((function(t){null!=t?(FormDataSet(t),MoveToContent()):window.location.hash=""}))}}else BackToList()}function editButtonClicked(t){MoveToContent(),keyId=t.row.key,window.location.hash=keyId}function paletteButtonClicked(t){keyId=t.row.key+"-1",window.location.hash=keyId}function FormDataSet(t){FormDataClear(),co.Product.Get.ProdStock(t.id).done((function(t){t.forEach((function(t){co.Product.Get.ProdPrice(t.id).done((function(e){e.forEach((function(t){var e={};e.Id=t.id,e.Tempid=price_tid,e.PSid=t.fK_PSId,e.TempPSid=0,e.Rid=t.fK_RId,e.Price=t.price,e.Bonus=t.bonus,e.IsDelete=!1,price_tid+=1,modal_price_list.push(e)})),SpecAdd(t)}))}))})),startDate=t.startTime,endDate=t.endTime,keyId=t.id,disp_opt=t.disp_Opt,$btn_display.children("span").text(t.disp_Opt?"visibility":"visibility_off"),$name.val(t.title),$name_count.text($name.val().length),$introduction.val(t.introduction),$introduction_count.text($introduction.val().length),$illustrate.val(t.description),$illustrate_count.text($illustrate.val().length),co.Product.Get.ProdTechCert(t.id).done((function(t){var e="";if(null!=t&&t.length>0){var n=[];t.forEach((function(t){var a={};a.Id=t.id,a.FK_TCId=t.fK_TCId,a.Checked=t.isChecked,t.isChecked&&(n.push(t.fK_TCId),e=""==e?t.title:e+"、"+t.title),techcert_list.push(a)})),getTechCertListDataGridInstance().selectRows(n)}$marks.val(""==e?"無":e)})),co.Tag.Get(t.id).done((function(t){var e="";if(null!=t&&t.length>0){var n=[];t.forEach((function(t){var a={};a.Id=t.id,a.FK_TId=t.fK_TId,a.Checked=!0,n.push(t.fK_TId),e=""==e?t.title:e+"、"+t.title,tag_list.push(a)})),getTagListDataGridInstance().selectRows(n)}$tag.val(""==e?"無":e)})),$date=$("#InputDate"),t.permanent?($date.val(""),$date.attr("disabled","disabled"),$permanent.prop("checked",!0)):(null!=startDate&&$picker.data("daterangepicker").setStartDate(startDate),null!=endDate&&$picker.data("daterangepicker").setEndDate(endDate))}function deleteButtonClicked(t){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Product.Delete.Prod(t.row.key).done((function(){product_list.component.refresh()})).fail((function(){Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)}))}))}function SpecPriceAdd(t){spec_price_num+=1;var e=$($("#ModalTemplatePrice").html()).clone(),n=e.find(".select_role"),a=e.find(".input_cash"),i=e.find(".input_bonus"),c=e.find(".btn_price_delete");e.data("ppid",null==t?0:t.Id),e.data("tempid",null==t?-1:t.Tempid),null!=t&&(n.val(t.Rid),a.val(t.Price),i.val(t.Bonus)),c.on("click",(function(){var t=$(this).parents(".frame").first();1==spec_price_num?co.sweet.error("商品至少需有一種價格",null,!1):co.sweet.confirm("移除價格","確定要移除此項價格嗎?","　是　","　否　",(function(){if(0==t.data("ppid")){if(t.data("tempid")>-1){var e=modal_price_list.findIndex((e=>e.Tempid==t.data("tempid")));modal_price_list[e].IsDelete=!0}}else{e=modal_price_list.findIndex((e=>e.Id==t.data("ppid")));modal_price_list[e].IsDelete=!0}spec_price_num-=1,t.remove()}))})),$("#PriceModal > .modal-dialog > .modal-content > .modal-body > .price_option").append(e),$("input[type='number']").on("input",(function(){$(this).val($(this).val()<0?0:$(this).val())}))}function SpecPriceSave(){var t=[],e=!0;$price_modal.children(".frame").each((function(){$self=$(this);var n={};if(n.Id=$self.data("ppid"),n.Tempid=price_tid,n.PSid=$self.parents(".modal-body").first().data("psid"),n.TempPSid=$self.parents(".modal-body").first().data("temppsid"),n.Rid=$self.find(".select_role").val(),n.Price=$self.find(".input_cash").val(),n.Bonus=$self.find(".input_bonus").val(),n.IsDelete=!1,0==n.Price&&0==n.Bonus)$(".alert_text").text("商品現金與紅利不可同時為空"),$(".alert_text").removeClass("d-none"),e=!1;else if(null!=t.find((t=>t.Rid==n.Rid&&t.Price==n.Price&&t.Bonus==n.Bonus)))$(".alert_text").removeClass("d-none"),$(".alert_text").text("價格不可重複"),e=!1;else if(t.push(n),$(".alert_text").addClass("d-none"),$self.data("tempid")<0)modal_price_list.push(n),price_tid+=1;else{var a=modal_price_list.findIndex((t=>t.Tempid==$self.data("tempid")));modal_price_list[a].Rid=$self.find(".select_role").val(),modal_price_list[a].Price=$self.find(".input_cash").val(),modal_price_list[a].Bonus=$self.find(".input_bonus").val()}})),e&&priceModal.hide()}function SpecAdd(t){spec_num+=1;var e=$($("#TemplateSpecification").html()).clone(),n=e.find(".topline"),a=e.find(".input_spec").first(),i=e.find(".input_spec").last(),c=e.find("datalist").first(),o=e.find("datalist").last(),d=e.find(".input_price"),r=e.find(".input_min_number"),l=e.find(".input_stock_number"),s=e.find(".input_alert_number"),p=e.find(".collapse"),u=e.find(".btn_expand"),_=e.find(".btn_delete");n.children(".spec").each((function(){var t=$($("#TemplateSpecType").html()).clone();$(this).prepend(t)}));var h=e.find(".spec_select").first(),f=e.find(".spec_select").last();null!=t&&null!=t.fK_ST1id&&(h.val(t.fK_ST1id),t.fK_ST1id>0&&(h.parents(".spec").first().siblings(".spec").children(".spec_select").children("option").each((function(){var t=$(this);t.val()==h.val()&&(t.attr("disabled","disabled"),t.addClass("bg-secondary-light25"))})),a.removeAttr("disabled"),co.Product.Get.ProdSpec(h.val()).done((function(e){null!=e&&e.forEach((function(e){c.append('<option value="'+e.title+'" data-sid="'+e.id+'"></option>'),e.id==t.fK_S1id&&a.val(e.title)}))}))));null!=t&&null!=t.fK_ST2id&&(f.val(t.fK_ST2id),t.fK_ST2id>0&&(f.parents(".spec").first().siblings(".spec").children(".spec_select").children("option").each((function(){var t=$(this);t.val()==f.val()&&(t.attr("disabled","disabled"),t.addClass("bg-secondary-light25"))})),i.removeAttr("disabled"),co.Product.Get.ProdSpec(f.val()).done((function(e){null!=e&&e.forEach((function(e){o.append('<option value="'+e.title+'" data-sid="'+e.id+'"></option>'),e.id==t.fK_S2id&&i.val(e.title)}))}))));null!=t?e.data("psid",t.id):(temp_psid+=1,e.data("temppsid",temp_psid));var m=modal_price_list.findIndex((t=>t.PSid==e.data("psid")||null!=t.TempPSid&&t.TempPSid==e.data("temppsid")));m>-1?(text="現金："+modal_price_list[m].Price+" 紅利："+modal_price_list[m].Bonus,d.val(text)):d.val(""),r.val(null!=t?t.min_Qty:""),l.val(null!=t?t.stock:""),s.val(""),s.val(null!=t?t.alert_Qty:""),p.attr("id","CollapseDetail"+spec_num),u.attr("data-bs-target","#CollapseDetail"+spec_num),u.attr("aria-controls","CollapseDetail"+spec_num),a.attr("list","SpecListOpt"+spec_num+"-1"),i.attr("list","SpecListOpt"+spec_num+"-2"),c.attr("id","SpecListOpt"+spec_num+"-1"),o.attr("id","SpecListOpt"+spec_num+"-2"),d.on("click",(function(){var t=!0,e=$(this),n=e.parents(".frame").data("psid"),a=e.parents(".frame").data("temppsid");$price_modal.parents(".modal-body").first().data("psid",null!=n?n:""),$price_modal.parents(".modal-body").first().data("temppsid",null!=a?a:""),modal_price_list.forEach((function(e){(e.PSid==n||null!=e.TempPsid&&e.TempPsid==a)&&(SpecPriceAdd(e),t=!1)})),t&&SpecPriceAdd(null),priceModal.show()})),null!=t&&(u.children("span").text("expand_more"),u.parents("div").first().prev().removeClass("show")),u.on("click",(function(){var t=$(this);"expand_less"==t.children("span").text()?t.children("span").text("expand_more"):t.children("span").text("expand_less")})),_.on("click",(function(){$self_p=$(this).parents(".frame").first(),1==spec_num?co.sweet.error("商品至少需有一種規格",null,!1):co.sweet.confirm("移除規格","確定要移除此項規格嗎?","　是　","　否　",(function(){spec_remove_list.push($self_p.data("psid")),spec_num-=1,$self_p.remove()}))})),$("#Spec_Frame").append(e),$spec_select=$(".spec_select"),$spec_select.each((function(){$self=$(this),$self.on("change",(function(){var t=$(this),e=t.parents(".spec").first().siblings(".spec"),n=t.siblings(".input_spec"),a=t.siblings("datalist");n.val(""),a.children("option").each((function(){$(this).remove()})),e.children(".spec_select").children("option").each((function(){var t=$(this);t.removeAttr("disabled"),t.removeClass("bg-secondary-light25")})),0==t.val()?n.attr("disabled","disabled"):(e.children(".spec_select").children("option").each((function(){var e=$(this);e.val()==t.val()&&(e.attr("disabled","disabled"),e.addClass("bg-secondary-light25"))})),n.removeAttr("disabled"),co.Product.Get.ProdSpec(t.val()).done((function(t){null!=t&&t.forEach((function(t){a.append('<option value="'+t.title+'" data-sid="'+t.id+'"></option>')}))})))}))})),$price=$(".input_price"),$stock_number=$(".input_stock_number"),$min_number=$(".input_min_number"),$alert_number=$(".input_alert_number"),$("input[type='number']").on("input",(function(){$(this).val($(this).val()<0?0:$(this).val())}))}function ISpecRepect(){var t=[],e=[],n=!1;return $("#Spec_Frame > .frame").each((function(){$self=$(this),$self.find(".input_spec").each((function(){t.push($(this).val())})),null!=e.find((e=>e[0]==t[0]&&e[1]==t[1]))?n=!0:(e.push(t),t=[])})),n}function AddUp(t,e,n){spec_remove_list.length>0&&spec_remove_list.forEach((function(t){co.Product.Delete.Stock(t)})),co.Product.AddUp.Product({Id:keyId,Title:$name.val(),Disp_Opt:disp_opt,Ser_No:500,Introduction:$introduction.val(),Description:$illustrate.val(),StartTime:startDate,EndTime:endDate,Permanent:$permanent.is(":checked")}).done((function(a){if(a.success){keyId=null==a.message?keyId:a.message;var i=[];null!=techcert_list&&techcert_list.forEach((function(t){var e={};e.Id=t.Id,e.FK_PId=keyId,e.FK_TCId=t.FK_TCId,e.IsChecked=t.Checked,i.push(e)})),co.Product.AddUp.ProdTechCert(i).done((function(a){if(a.success){var i=[];null!=tag_list&&tag_list.forEach((function(t){var e={};e.Id=t.Id,e.FK_TId=t.FK_TId,e.FK_AId=keyId,e.IsChecked=t.Checked,e.Type=1,i.push(e)})),co.Tag.AddDelect(i).done((function(a){if(a.success){var i=[];$("#Spec_Frame > .frame").each((function(){var t=$(this),e={},n=[];t.find(".input_spec").each((function(){var t=-1;$self_input=$(this),$self_input.siblings("datalist").children("option").each((function(){var e=$(this);e.val()==$self_input.val()&&(t=e.data("sid"))})),n.push(t>-1?t:0)})),e.Id=""==t.data("psid")?0:t.data("psid"),e.Pid=keyId,e.FK_S1id=n[0],e.FK_S2id=n[1],e.Stock=t.find(".input_stock_number").val(),e.Min_Qty=t.find(".input_min_number").val(),e.Alert_Qty=t.find(".input_alert_number").val(),i.push(e)})),co.Product.AddUp.Stock(i).done((function(a){if(a.success){console.log(a);var i=a.message.split(","),c=[];modal_price_list.forEach((function(t){if(console.log(t),t.IsDelete)null!=t.PSid&&null!=t.Id&&co.Product.Delete.Price(t.Id);else{var e={};e.Id=t.Id,null!=t.PSid&&""!=t.PSid?e.FK_PSId=t.PSid:e.FK_PSId=i[t.TempPSid-1],e.FK_RId=t.Rid,e.Price=t.Price,e.Bonus=t.Bonus,c.push(e)}})),co.Product.AddUp.ProdPrice(c).done((function(){a.success?"List"==n?(Coker.sweet.success(t,null,!0),setTimeout((function(){BackToList(),product_list.component.refresh()}),1e3)):"Canvas"==n&&(Coker.sweet.success(t,null,!0),setTimeout((function(){var t=window.location.hash.replace("#","")+"-1";window.location.hash=t}),1e3)):Coker.sweet.error("錯誤",e,null,!0)})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}else Coker.sweet.error("錯誤",e,null,!0)})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}else Coker.sweet.error("錯誤",e,null,!0)})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}else Coker.sweet.error("錯誤",e,null,!0)})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}else Coker.sweet.error("錯誤",e,null,!0)})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}function MoveToContent(){$("#ProductForm").removeClass("was-validated"),$("#ProductList").addClass("d-none"),$("#ProductCanvas").addClass("d-none"),$("#ProductContent").removeClass("d-none")}function MoveToCanvas(){$("#ProductList").addClass("d-none"),$("#ProductContent").addClass("d-none"),$("#ProductCanvas").removeClass("d-none")}function BackToList(){$("#ProductList").removeClass("d-none"),$("#ProductCanvas").addClass("d-none"),$("#ProductContent").addClass("d-none"),window.location.hash=""}