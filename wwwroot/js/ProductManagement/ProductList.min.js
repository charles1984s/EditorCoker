var $display,$removedFromShelves,$name,$name_count,$introduction,$introduction_count,$illustrate,$illustrate_count,$marks,$price,$subItemNo,$stock_number,$alert_number,$min_number,$date,$picker,$permanent,$itemNo,$itemNo_count,startDate,endDate,keyId,price_tid,temp_psid,product_list,spec_pick_list,$price_modal,priceModal,spec_num=0,spec_price_num=0,spec_remove_list=[],modal_price_list=[],total_files=[];let importProdPopup=null;function ImportProd(){var e=new FormData($('[name="fileUploadForm"]')[0]);co.Product.AddUp.Import(e).done((function(e){importProdPopup.hide(),co.sweet.success("檔案上傳成功"),null!=product_list&&product_list.component.refresh()})).fail((function(){co.sweet.error("檔案格式錯誤，無法解讀。")}))}function showImportProdPopup(){importProdPopup=$("#importProdPopup").dxPopup("instance"),importProdPopup.option("contentTemplate",$("#importProdPopup-template")),importProdPopup.option("title","商品匯入"),importProdPopup.show()}function toolbarPreparing(e){e.component;e.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{icon:"fa-solid fa-file-excel",text:"商品匯入",onClick:showImportProdPopup}})}function PageReady(){ElementInit(),TechCertListModalInit(),TagListModalInit();const e=grapesInit({save:function(e,t){var n=$.Deferred();return co.Product.Content.SaveConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:t}).done((function(e){e.success?n.resolve():co.sweet.error(e.error)})),n.promise()},import:function(e,t){var n=$.Deferred();return co.Product.Content.ImportConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:t}).done((function(e){e.success?n.resolve():co.sweet.error(e.error)})),n.promise()},getComponer:function(){var e=$.Deferred();return co.HtmlContent.GetAllComponent().done((function(t){t.success?e.resolve(t.list):co.sweet.error(resutlt.error)})),e.promise()}});setPage=function(t){co.Product.Content.GetConten({Id:t}).done((function(t){if(t.success){var n=co.Data.HtmlDecode(t.conten.saveHtml);co.Grapes.setEditor(e,n,t.conten.saveCss)}else co.sweet.error(t.error)}))},co.File.ListFileInit(),$picker=$("#InputDate"),co.Picker.Init($picker),$picker.on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("YYYY/MM/DD HH:mm")+" ~ "+t.endDate.format("YYYY/MM/DD HH:mm")),startDate=t.startDate.format(""),endDate=t.endDate.format("")}));const t=$("#ProductForm");Array.from(t).forEach((e=>{e.addEventListener("submit",(t=>{if(e.checkValidity())if(t.preventDefault(),ISpecRepect())co.sweet.error("錯誤","商品規格不可重複",null,!1);else{var n,a=!1;$(".input_price").each((function(){if(""==$(this).val())return a=!0,n=$(this),!1})),a?co.sweet.error("錯誤","請確實填寫價格",(function(){setTimeout((function(){$("html, body").animate({scrollTop:n.offset().top-2*$("header").height()},0)}),500)}),!1):Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp("已成功發布","發布發生未知錯誤","List")}))}else t.preventDefault(),t.stopPropagation();e.classList.add("was-validated")}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回商品列表","資料將不被保存","確定","取消",(function(){window.location.hash=""}))})),$(".btn_add").on("click",(function(){window.location.hash=0})),$(".btn_input_pic").on("click",(function(e){e.preventDefault(),$(".input_pic").click()})),$(".btn_expand_out").on("click",(function(){var e=$(this);"expand_less"==e.children("span").text()?e.children("span").text("expand_more"):e.children("span").text("expand_less")})),$(".btn_spec_add").on("click",(function(){SpecAdd(null)})),$(".btn_spec_price_add").on("click",(function(){SpecPriceAdd(null)})),$(".btn_price_save").on("click",SpecPriceSave),$name.on("keyup",(function(){$name_count.text($name.val().length)})),$introduction.on("keyup",(function(){$introduction_count.text($introduction.val().length)})),$illustrate.on("keyup",(function(){$illustrate_count.text($illustrate.val().length)})),$permanent.on("click",(function(){$permanent.is(":checked")?($date.val(""),$date.attr("disabled","disabled"),startDate=null,endDate=null):$date.removeAttr("disabled")})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3),$(".btn_to_canvas").on("click",(function(e){e.preventDefault(),Swal.fire({icon:"info",title:"前往內容編輯頁",html:"是否保存資料?",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#888888",denyButtonColor:"#d33",confirmButtonText:"　是　",cancelButtonText:"　取消　",denyButtonText:"　否　",reverseButtons:!0}).then((e=>{if(e.isConfirmed)AddUp("已成功發布","發布發生未知錯誤","Canvas");else if(e.isDenied){var t=window.location.hash.replace("#","")+"-1";window.location.hash=t}}))}))}function ElementInit(){$name=$("#InputName"),$name_count=$("#ProductForm > .name .name_count"),$introduction=$("#InputIntroduction"),$introduction_count=$("#ProductForm > .introduction .introduction_count"),$illustrate=$("#InputIllustrate"),$illustrate_count=$("#ProductForm > .illustrate .illustrate_count"),$marks=$("#InputMarks"),$spec_select=$(".spec_select"),$price=$(".input_price"),$subItemNo=$(".input_subItemNo"),$stock_number=$(".input_stock_number"),$min_number=$(".input_min_number"),$alert_number=$(".input_alert_number"),$date=$("#InputDate"),$permanent=$("#PermanentCheck"),$itemNo=$("#InputItemNo"),$itemNo_count=$("#ProductForm > .itemNo .itemNo_count"),$display=$('#ProductForm [name="Visible"]'),$removedFromShelves=$('#ProductForm [name="RemovedFromShelves"]'),priceModal=new bootstrap.Modal(document.getElementById("PriceModal")),$price_modal=$("#PriceModal >.modal-dialog > .modal-content > .modal-body >.price_option"),document.getElementById("PriceModal").addEventListener("hidden.bs.modal",(function(e){$price_modal.children(".frame").each((function(){$(this).remove(),spec_price_num=0})),$(".input_price").each((function(){var e=$(this),t=e.parents(".frame").data("psid"),n=e.parents(".frame").data("temppsid"),a=modal_price_list.findIndex((e=>e.FK_PSId==t||null!=e.TempPSid&&e.TempPSid==n));a>-1?(text="現金："+modal_price_list[a].Price+" 紅利："+modal_price_list[a].Bonus,e.val(text)):e.val("")})),$(".alert_text").addClass("d-none")}))}function FormDataClear(){TechCertDataClear(),TagDataClear(),$("#Spec_Frame > .frame").each((function(){$(this).remove()})),spec_num=0,keyId=0,$removedFromShelves.prop("checked",!1),$display.prop("checked",!1),$name.val(""),$name_count.text(0),$itemNo.val(""),$itemNo_count.text(0),$introduction.val(""),$introduction_count.text(0),$illustrate.val(""),$illustrate_count.text(0),$marks.val(""),$price.val(""),$subItemNo.val(""),$stock_number.val(""),$alert_number.val(""),$min_number.val(""),$permanent.prop("checked",!1),$date.val(""),$date.removeAttr("disabled"),startDate=null,endDate=null,spec_remove_list=[],modal_price_list=[],price_tid=0,temp_psid=0,$(".data_upload").each((function(){UploadPreviewFrameClear($(this))})),$(".data_upload > ul").children(".upload_list").remove(),total_files=[]}function contentReady(e){product_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(FormDataClear(),""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");0==parseInt(e)?e.includes("-1")?MoveToCanvas():(SpecAdd(null),MoveToContent()):e.includes("-1")?(keyId=parseInt(e),MoveToCanvas()):co.Product.Get.ProdOne(parseInt(e)).done((function(e){null!=e?co.Spec.GetPickSpecList().done((function(t){spec_pick_list=t,FormDataSet(e),MoveToContent()})):window.location.hash=""}))}}else BackToList()}function editButtonClicked(e){MoveToContent(),keyId=e.row.key,window.location.hash=keyId}function paletteButtonClicked(e){$("#gjs").data("id",e.row.key),setPage(e.row.key),keyId=e.row.key+"-1",window.location.hash=keyId}function FormDataSet(e){TagDataSet(e.tagDatas),TechCertDataSet(e.techCertDatas),e.multimedia.forEach((e=>{UploadListAdd(e,$("#ProdMedia"))})),e.files.forEach((e=>{UploadListAdd(e,$("#ProdFiles"))})),e.stocks.forEach((function(e){e.prices.forEach((function(e){var t={};t.Id=e.id,t.Tempid=price_tid,t.FK_PSId=e.fK_PSId,t.TempPSid=0,t.FK_RId=e.fK_RId,t.Price=e.price,t.Bonus=e.bonus,t.SubItemNo=e.subItemNo,t.IsDelete=!1,price_tid+=1,modal_price_list.push(t)})),SpecAdd(e)})),startDate=e.startTime,endDate=e.endTime,keyId=e.id,disp_opt=e.disp_Opt,$removedFromShelves.prop("checked",!e.removedFromShelves),$display.prop("checked",e.visible),$name.val(e.title),$name_count.text($name.val().length),$itemNo.val(e.itemNo),$itemNo_count.text($itemNo.val().length),$introduction.val(e.introduction),$introduction_count.text($introduction.val().length),$illustrate.val(e.description),$illustrate_count.text($illustrate.val().length),$date=$("#InputDate"),$(".linkToF").attr("href",`${defaultUrl}/${OrgName}/search/product/${e.id}`),e.permanent?($date.val(""),$date.attr("disabled","disabled"),$permanent.prop("checked",!0)):(null!=startDate&&$picker.data("daterangepicker").setStartDate(startDate),null!=endDate&&$picker.data("daterangepicker").setEndDate(endDate))}function deleteButtonClicked(e){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Product.Delete.Prod(e.row.key).done((function(){product_list.component.refresh()})).fail((function(){Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)}))}))}function SpecPriceAdd(e){spec_price_num+=1;var t=$($("#ModalTemplatePrice").html()).clone(),n=t.find(".select_role"),a=t.find(".input_cash"),i=t.find(".input_bonus"),o=t.find(".btn_price_delete");t.data("ppid",null==e?0:e.Id),t.data("tempid",null==e?-1:e.Tempid),null!=e&&(n.val(e.FK_RId),a.val(e.Price),i.val(e.Bonus)),o.on("click",(function(){var e=$(this).parents(".frame").first();1==spec_price_num?co.sweet.error("商品至少需有一種價格",null,!1):co.sweet.confirm("移除價格","確定要移除此項價格嗎?","　是　","　否　",(function(){if(0==e.data("ppid")){if(e.data("tempid")>-1){var t=modal_price_list.findIndex((t=>t.Tempid==e.data("tempid")));modal_price_list[t].IsDelete=!0}}else{t=modal_price_list.findIndex((t=>t.Id==e.data("ppid")));modal_price_list[t].IsDelete=!0}spec_price_num-=1,e.remove()}))})),$("#PriceModal > .modal-dialog > .modal-content > .modal-body > .price_option").append(t),$("input[type='number']").on("input",(function(){$(this).val($(this).val()<0?0:$(this).val())}))}function SpecPriceSave(){var e=[],t=!0;$price_modal.children(".frame").each((function(){$self=$(this);var n={};if(n.Id=$self.data("ppid"),n.Tempid=price_tid,n.FK_PSId=$self.parents(".modal-body").first().data("psid"),n.TempPSid=$self.parents(".modal-body").first().data("temppsid"),n.FK_RId=$self.find(".select_role").val(),n.Price=$self.find(".input_cash").val(),n.Bonus=$self.find(".input_bonus").val(),n.IsDelete=!1,0==n.Price&&0==n.Bonus)$(".alert_text").text("商品現金與紅利不可同時為空"),$(".alert_text").removeClass("d-none"),t=!1;else if(null!=e.find((e=>e.FK_RId==n.FK_RId&&e.Price==n.Price&&e.Bonus==n.Bonus)))$(".alert_text").removeClass("d-none"),$(".alert_text").text("價格不可重複"),t=!1;else if(e.push(n),$(".alert_text").addClass("d-none"),$self.data("tempid")<0)modal_price_list.push(n),price_tid+=1;else{var a=modal_price_list.findIndex((e=>e.Tempid==$self.data("tempid")));modal_price_list[a].FK_RId=$self.find(".select_role").val(),modal_price_list[a].Price=$self.find(".input_cash").val(),modal_price_list[a].Bonus=$self.find(".input_bonus").val()}})),t&&priceModal.hide()}function SpecAdd(e){spec_num+=1;var t=$($("#TemplateSpecification").html()).clone(),n=t.find(".topline"),a=t.find(".input_spec").first(),i=t.find(".input_spec").last(),o=t.find("datalist").first(),d=t.find("datalist").last(),l=t.find(".input_price"),s=t.find(".input_subItemNo"),r=t.find(".input_min_number"),c=t.find(".input_stock_number"),p=t.find(".input_alert_number"),u=t.find(".collapse"),m=t.find(".btn_expand"),f=t.find(".btn_delete");n.children(".spec").each((function(){var e=$($("#TemplateSpecType").html()).clone();$(this).prepend(e)}));var _=t.find(".spec_select").first(),v=t.find(".spec_select").last();if(null!=e&&null!=e.fK_ST1id&&(_.val(e.fK_ST1id),e.fK_ST1id>0)){_.parents(".spec").first().siblings(".spec").children(".spec_select").children("option").each((function(){var e=$(this);e.val()==_.val()&&(e.attr("disabled","disabled"),e.addClass("bg-secondary-light25"))})),a.removeAttr("disabled");var h=spec_pick_list.find((e=>e.id==_.val()));h.specs.length>0&&h.specs.forEach((t=>{o.append(`<option value="${t.title}" data-sid="${t.id}"></option>`),t.id==e.fK_S1id&&(a.val(t.title),a.data("id",t.id))}))}if(null!=e&&null!=e.fK_ST2id&&(v.val(e.fK_ST2id),e.fK_ST2id>0)){v.parents(".spec").first().siblings(".spec").children(".spec_select").children("option").each((function(){var e=$(this);e.val()==v.val()&&(e.attr("disabled","disabled"),e.addClass("bg-secondary-light25"))})),i.removeAttr("disabled");h=spec_pick_list.find((e=>e.id==v.val()));h.specs.length>0&&h.specs.forEach((t=>{d.append(`<option value="${t.title}" data-sid="${t.id}"></option>`),t.id==e.fK_S2id&&(i.val(t.title),i.data("id",t.id))}))}null!=e?t.data("psid",e.id):(temp_psid+=1,t.data("temppsid",temp_psid));var I=modal_price_list.findIndex((e=>e.FK_PSId==t.data("psid")||null!=e.TempPSid&&e.TempPSid==t.data("temppsid")));I>-1?(text="現金："+modal_price_list[I].Price+" 紅利："+modal_price_list[I].Bonus,l.val(text)):l.val(""),s.val(null!=e?e.subItemNo:""),r.val(null!=e?e.min_Qty:""),c.val(null!=e?e.stock:""),p.val(""),p.val(null!=e?e.alert_Qty:""),u.attr("id","CollapseDetail"+spec_num),m.attr("data-bs-target","#CollapseDetail"+spec_num),m.attr("aria-controls","CollapseDetail"+spec_num),a.attr("list","SpecListOpt"+spec_num+"-1"),i.attr("list","SpecListOpt"+spec_num+"-2"),o.attr("id","SpecListOpt"+spec_num+"-1"),d.attr("id","SpecListOpt"+spec_num+"-2"),l.on("click",(function(){var e=!0,t=$(this),n=t.parents(".frame").data("psid"),a=t.parents(".frame").data("temppsid");$price_modal.parents(".modal-body").first().data("psid",null!=n?n:""),$price_modal.parents(".modal-body").first().data("temppsid",null!=a?a:""),modal_price_list.forEach((function(t){(t.FK_PSId==n||null!=t.TempPsid&&t.TempPsid==a)&&(SpecPriceAdd(t),e=!1)})),e&&SpecPriceAdd(null),priceModal.show()})),null!=e&&(m.children("span").text("expand_more"),m.parents("div").first().prev().removeClass("show")),m.on("click",(function(){var e=$(this);"expand_less"==e.children("span").text()?e.children("span").text("expand_more"):e.children("span").text("expand_less")})),f.on("click",(function(){$self_p=$(this).parents(".frame").first(),1==spec_num?co.sweet.error("商品至少需有一種規格",null,!1):co.sweet.confirm("移除規格","確定要移除此項規格嗎?","　是　","　否　",(function(){spec_remove_list.push($self_p.data("psid")),spec_num-=1,$self_p.remove()}))})),$("#Spec_Frame").append(t),$spec_select=$(".spec_select"),$spec_select.each((function(){$self=$(this),$self.on("change",(function(){var t=$(this),n=t.parents(".spec").first().siblings(".spec"),a=t.siblings("datalist");if(e.val(""),a.children("option").each((function(){$(this).remove()})),n.children(".spec_select").children("option").each((function(){var e=$(this);e.removeAttr("disabled"),e.removeClass("bg-secondary-light25")})),0==t.val())e.attr("disabled","disabled");else{n.children(".spec_select").children("option").each((function(){var e=$(this);e.val()==t.val()&&(e.attr("disabled","disabled"),e.addClass("bg-secondary-light25"))})),e.removeAttr("disabled");var i=spec_pick_list.find((e=>e.id==t.val()));i.specs.length>0&&i.specs.forEach((e=>{a.append(`<option value="${e.title}" data-sid="${e.id}"></option>`)}))}}));var e=$self.siblings(".input_spec");e.blur((function(){var t,n;""!=e.val()&&(n=0,e.each((function(){$self_input=$(this),$self_input.siblings("datalist").children("option").each((function(){(t=$(this)).val()==$self_input.val()&&(n=t.data("sid"))}))})),0==n&&co.Spec.SpecAddUp({FK_Tid:e.prev("select").val(),Title:e.val()}).done((function(t){t.success&&co.Spec.GetPickSpecList().done((function(n){spec_pick_list=n,$self_input.siblings("datalist").append(`<option value="${e.val()}" data-sid="${t.message}"></option>`)}))})))}))})),$price=$(".input_price"),$stock_number=$(".input_stock_number"),$min_number=$(".input_min_number"),$alert_number=$(".input_alert_number"),$("input[type='number']").on("input",(function(){$(this).val($(this).val()<0?0:$(this).val())}))}function ISpecRepect(){var e=[],t=[],n=!1;return $("#Spec_Frame > .frame").each((function(){$self=$(this),$self.find(".input_spec").each((function(){e.push($(this).val())})),null!=t.find((t=>t[0]==e[0]&&t[1]==e[1]))?n=!0:(t.push(e),e=[])})),n}function UploadListAdd(e,t){var n=$($("#TemplateUploadList").html()).clone(),a=n.find(".ser_no"),i=n.find(".btn_remove"),o=t.find("ul > li").length-1;if(void 0===o&&(o=0),null==e)t.find("ul > li").each((function(){var e=$(this);e.hasClass("upload_list")&&""==e.find(".title").text()&&(e.remove(),o-=1)})),o+=1,n.data("tempid",o),n.data("serno",o),a.val(o),0==t.find(".select_frame").length&&void 0!==t.data("uploadtype")?n.data("uploadtype",t.data("uploadtype")):n.data("uploadtype",0),n.data("edit",!1),n.on("click",(function(){co.File.ListFile($(this))}));else if(void 0===e.id)n.data("tempid",e.TempId),n.data("serno",o),a.val(o),n.data("uploadtype",e.Type),n.data("edit",!1),n.find(".title").text(e.Name),n.on("click",(function(){co.File.ListFile($(this))}));else{o+=1,n.data("id",e.id),n.data("serno",o),a.val(o),n.data("uploadtype",e.fileType),n.data("edit",!1),n.find(".title").text(e.name);var d={};d.Id=e.id,d.Name=e.name;var l=e.link[0];4==e.fileType?d.File=e.name:d.File=l,d.Type=e.fileType,d.IsDelete=!1,total_files.push(d),n.on("click",(function(){co.File.ListFile($(this))}))}t.data("file_num",o),a.on("blur",(function(){var e=$(this);e.val()<1?e.val(1):e.val()>$(".upload_list").length&&e.val($(".upload_list").length),e.val()!=n.data("serno")&&(e.val()>n.data("serno")?(SortChange("bigger",n.data("serno"),e.val()),$("#ProductForm > .data_upload > ul").children("li").eq(parseInt(e.val())-1).after(n)):e.val()<n.data("serno")&&(SortChange("smaller",e.val(),n.data("serno")),$("#ProductForm > .data_upload > ul").children("li").eq(parseInt(e.val())-1).before(n))),n.data("serno",e.val())})),i.on("click",(function(e){e.preventDefault();var a=$(this).parents("li").first();if(n.data("serno")<t.data("file_num")&&SortChange("bigger",n.data("serno"),t.data("file_num")),void 0!==a.data("id"))total_files.find((e=>e.Id==a.data("id"))).IsDelete=!0;else if(void 0!==a.data("tempid")){var i=a.data("tempid"),o=total_files.findIndex((e=>e.TempId==i));total_files.splice(o,1),total_files.forEach((e=>{e.TempId=e.TempId>i?e.TempId-1:e.TempId}))}UploadPreviewFrameClear(t),a.remove(),t.data("file_num",t.data("file_num")-1)})),t.find("ul > .btn_upload_add").before(n),co.File.ListFile(n)}function UploadPreviewFrameClear(e){var t=e.find(".preview_frame");t.find(".default_frame").addClass("d-flex"),t.find(".upload_frame").addClass("d-none"),t.find(".media_frame").removeClass("d-flex"),t.find(".youtube_frame").removeClass("d-flex"),t.find(".select_frame").removeClass("d-flex")}function SortChange(e,t,n){$(".upload_list").each((function(){var a=$(this);"bigger"==e?a.data("serno")>t&&a.data("serno")<=n&&(a.find(".ser_no").val(parseInt(a.data("serno"))-1),a.data("serno",a.find(".ser_no").val())):"smaller"==e&&a.data("serno")>=t&&a.data("serno")<n&&(a.find(".ser_no").val(parseInt(a.data("serno"))+1),a.data("serno",a.find(".ser_no").val()))}))}function AddUp(e,t,n){var a=[],i=1;$("#Spec_Frame > .frame").each((function(){var e=$(this),t={},n=[];e.find(".input_spec").each((function(){var e=0;$self_input=$(this),$self_input.siblings("datalist").children("option").each((function(){var t=$(this);t.val()==$self_input.val()&&(e=t.data("sid"))})),n.push(e)})),t.Id=""==e.data("psid")?0:e.data("psid"),t.FK_S1id=n[0],t.FK_S2id=n[1],t.Stock=e.find(".input_stock_number").val(),t.Alert_Qty=e.find(".input_alert_number").val(),t.Min_Qty=e.find(".input_min_number").val(),t.Ser_No=i,i++;var o=[];modal_price_list.forEach((function(t){if(t.FK_PSId==e.data("psid")||t.TempPSid==e.data("temppsid")){var n={};n.Id=t.Id,n.FK_PSId=t.FK_PSId,n.FK_RId=t.FK_RId,n.Price=t.Price,n.Bonus=t.Bonus,n.IsDelete=t.IsDelete,o.push(n)}})),t.Prices=o,a.push(t)})),co.Product.AddUp.Product({Id:keyId,Title:$name.val(),ItemNo:$itemNo.val(),Visible:$display.is(":checked"),RemovedFromShelves:!$removedFromShelves.is(":checked"),Ser_No:500,Introduction:$introduction.val(),Description:$illustrate.val(),StartTime:startDate,EndTime:endDate,Permanent:$permanent.is(":checked"),TagSelected:tag_list,TechCertSelected:techcert_list,Stocks:a}).done((function(a){var i=parseInt(a.message);a.success?total_files.length>0?($("#ProductForm > .data_upload > ul > li").each((function(){var e=$(this);if(!e.hasClass("btn_upload_add")){var t=[];switch(total_files.forEach((n=>{(void 0!==n.Id&&n.Id==e.data("id")||void 0!==n.TempId&&n.TempId==e.data("tempid"))&&t.push(n)})),t[0].Type){case 1:if("string"==typeof t[0].File)co.File.fileSortChange({Id:t[0].Id,SerNo:e.find(".ser_no").val()});else(d=new FormData).append("type",1),d.append("sid",i),d.append("serno",e.find(".ser_no").val()),t.forEach((e=>{for(var t=0;t<e.File.length;t++)d.append("files",e.File[t]);co.File.Upload(d),d.delete("files")}));break;case 2:(d=new FormData).append("type",1),d.append("sid",i),d.append("serno",e.find(".ser_no").val());for(var n=0;n<t.length;n+=3){for(var a=n;a<n+3;a++)d.append("files",t[a]);d.delete("files")}break;case 3:if("string"==typeof t[0].File)co.File.fileSortChange({Id:t[0].Id,SerNo:e.find(".ser_no").val()});else(d=new FormData).append("files",t[0].File),d.append("type",1),d.append("sid",i),d.append("serno",e.find(".ser_no").val()),co.File.Upload(d);break;case 4:var o=void 0===t[0].Id?0:t[0].Id;co.File.UploadYTLink({Id:o,File:t[0].File+"",SId:i,Type:1,SerNo:e.find(".ser_no").val()});break;case 5:var d;if("string"==typeof t[0].File)co.File.fileSortChange({Id:t[0].Id,SerNo:e.find(".ser_no").val()});else(d=new FormData).append("files",t[0].File),d.append("type",8),d.append("sid",i),d.append("serno",e.find(".ser_no").val()),co.File.Upload(d)}}})),total_files.forEach((e=>{if(void 0!==e.IsDelete&&1==e.IsDelete)switch(e.Type){case 2:break;case 1:case 3:case 4:if(void 0!==e.Id){var t=[];t.push(e.Id),co.File.DeleteFileById({Sid:parseInt(a.message),Type:1,Fid:t})}}})),"List"==n?(Coker.sweet.success(e,null,!0),setTimeout((function(){BackToList(),product_list.component.refresh()}),1e3)):"Canvas"==n&&(Coker.sweet.success(e,null,!0),setTimeout((function(){var e=window.location.hash.replace("#","")+"-1";window.location.hash=e}),1e3))):"List"==n?(Coker.sweet.success(e,null,!0),setTimeout((function(){BackToList(),product_list.component.refresh()}),1e3)):"Canvas"==n&&(Coker.sweet.success(e,null,!0),setTimeout((function(){var e=window.location.hash.replace("#","")+"-1";window.location.hash=e}),1e3)):Coker.sweet.error("錯誤",t,null,!0)})).fail((function(){Coker.sweet.error("錯誤",t,null,!0)})),spec_remove_list.length>0&&spec_remove_list.forEach((function(e){co.Product.Delete.Stock(e)}))}function MoveToContent(){0==keyId?$("#ProductContent .card-header .titile").text("新增商品"):$("#ProductContent .card-header .titile").text("編輯商品"),$("#ProductForm").removeClass("was-validated"),$("#ProductList").addClass("d-none"),$("#ProductCanvas").addClass("d-none"),$("#ProductContent").removeClass("d-none")}function MoveToCanvas(){$("#gjs").data("id",keyId),setPage(keyId),$("#TopLine > a").removeClass("d-none"),$("#ProductList").addClass("d-none"),$("#ProductContent").addClass("d-none"),$("#ProductCanvas").removeClass("d-none")}function BackToList(){$("#TopLine > a").addClass("d-none"),$("#ProductList").removeClass("d-none"),$("#ProductCanvas").addClass("d-none"),$("#ProductContent").addClass("d-none"),window.location.hash=""}