var $btn_display,$name,$name_count,$introduction,$introduction_count,$illustrate,$illustrate_count,$marks,$price,$stock_number,$alert_number,$min_number,$date,$picker,$permanent,startDate,endDate,keyId,price_tid,temp_psid,product_list,$price_modal,priceModal,disp_opt=!0,spec_num=0,spec_price_num=0,spec_remove_list=[],modal_price_list=[],file_num=0;let importProdPopup=null;function ImportProd(){var e=new FormData($('[name="fileUploadForm"]')[0]);co.Product.AddUp.Import(e).done((function(e){importProdPopup.hide(),co.sweet.success("檔案上傳成功")})).fail((function(){co.sweet.error("檔案格式錯誤，無法解讀。")}))}function showImportProdPopup(){importProdPopup=$("#importProdPopup").dxPopup("instance"),importProdPopup.option("contentTemplate",$("#importProdPopup-template")),importProdPopup.option("title","商品匯入"),importProdPopup.show()}function toolbarPreparing(e){e.component;e.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{icon:"fa-solid fa-file-excel",text:"商品匯入",onClick:showImportProdPopup}})}function PageReady(){ElementInit(),TechCertListModalInit(),TagListModalInit(),$(".upload_list").on("click",(function(){UploadFile($(this))})),$(".upload_list > .btn_remove").on("click",(function(){$(this).parents("li").first().remove(),file_num-=1})),$(".btn_upload_add > button").on("click",(function(e){e.preventDefault(),UploadListAdd(!0)})),$(window).on("fileUploadWithPreview:imagesAdded",(function(e){var t=upload_file.cachedFileArray;$("#ProductForm > .data_upload > ul > li").each((function(){var e=$(this);if(e.data("edit"))if(1==e.data("uploadtype")||3==e.data("uploadtype")){var a=t[0].name.substring(0,t[0].name.indexOf(":")),n=t[0].type;e.data("file",new File(t,a,{type:n})),e.find(".title").text(a)}else if(2==e.data("uploadtype")){var i=[];t.forEach((function(e,o){a=e.name.substring(0,e.name.indexOf(":")),n=e.type,i.push(new File(t.slice(o,o+1),a,{type:n}))})),e.data("file",i);var o=a.substring(0,t[0].name.lastIndexOf("-"))+"-n"+a.substring(t[0].name.lastIndexOf("."));e.find(".title").text(o)}}))})),$(window).on("fileUploadWithPreview:imageDeleted",(function(e){$("#ProductForm > .data_upload > ul > li").each((function(){var e=$(this);if(e.data("edit")){var t=upload_file.cachedFileArray;if(t.length<1)e.data("file",""),e.find(".title").text("");else{var a=[];t.forEach((function(e,n){var i=e.name.substring(0,e.name.indexOf(":")),o=e.type;a.push(new File(t.slice(n,n+1),i,{type:o}))})),e.data("file",a)}}}))})),$(window).on("fileUploadWithPreview:clearButtonClicked",(function(e){$("#ProductForm > .data_upload > ul > li").each((function(){var e=$(this);e.data("edit")&&(e.data("file",""),e.find(".title").text(""))}))})),$("#BtnConnect").on("click",(function(e){var t;e.preventDefault(),$("#ProductForm > .data_upload > ul > .upload_list").each((function(){var e=$(this);e.data("edit")&&(t=e)}));var a=$(this).prev().val(),n=a.indexOf("watch?v=")+8;if($(".youtube_preview").children("*").remove(),""!=a&&n>-1&&""!=a.substring(n)){var i=`<iframe class="yt_preview w-100 h-100" src="${"https://www.youtube.com/embed/"+a.substring(n)}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`;$(".youtube_preview").append(i),t.find(".title").text(a),t.data("file",a.substring(n))}else{$(".youtube_preview").append("<div class='w-100 h-100 d-flex justify-content-center align-items-center bg-black bg-opacity-25 fw-bold'>請輸入正確的Youtube連結</div>"),t.find(".title").text(""),t.data("file","")}})),$((function(){var e,t,a;$("#ProductForm > .data_upload > ul").sortable({items:"> .upload_list",axis:"y",cursor:"move",dropOnEmpty:!1,start:function(t,n){e=n.item.offset().top,a=1.5*n.item.height()},stop:function(n,i){t=i.item.offset().top;var o=Math.trunc((t-e)/a),l=i.item.find(".ser_no");o>0?(l.val(parseInt(l.val())+o),SortChange("bigger",i.item.data("serno"),l.val()),i.item.data("serno",l.val())):o<0&&(l.val(parseInt(l.val())+o),SortChange("smaller",l.val(),i.item.data("serno")),i.item.data("serno",l.val()))}})})),$picker=$("#InputDate"),co.Picker.Init($picker),$picker.on("apply.daterangepicker",(function(e,t){$(this).val(t.startDate.format("YYYY/MM/DD HH:mm")+" ~ "+t.endDate.format("YYYY/MM/DD HH:mm")),startDate=t.startDate.format(""),endDate=t.endDate.format("")}));const e=$("#ProductForm");Array.from(e).forEach((e=>{e.addEventListener("submit",(t=>{if(e.checkValidity())if(t.preventDefault(),ISpecRepect())co.sweet.error("錯誤","商品規格不可重複",null,!1);else{var a,n=!1;$(".input_price").each((function(){if(""==$(this).val())return n=!0,a=$(this),!1})),n?co.sweet.error("錯誤","請確實填寫價格",(function(){setTimeout((function(){$("html, body").animate({scrollTop:a.offset().top-2*$("header").height()},0)}),500)}),!1):Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp("已成功發布","發布發生未知錯誤","List")}))}else t.preventDefault(),t.stopPropagation();e.classList.add("was-validated")}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回商品列表","資料將不被保存","確定","取消",(function(){window.location.hash=""}))})),$(".btn_add").on("click",(function(){window.location.hash=0})),$(".btn_input_pic").on("click",(function(e){e.preventDefault(),$(".input_pic").click()})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$(".btn_expand_out").on("click",(function(){var e=$(this);"expand_less"==e.children("span").text()?e.children("span").text("expand_more"):e.children("span").text("expand_less")})),$(".btn_spec_add").on("click",(function(){SpecAdd(null)})),$(".btn_spec_price_add").on("click",(function(){SpecPriceAdd(null)})),$(".btn_price_save").on("click",SpecPriceSave),$name.on("keyup",(function(){$name_count.text($name.val().length)})),$introduction.on("keyup",(function(){$introduction_count.text($introduction.val().length)})),$illustrate.on("keyup",(function(){$illustrate_count.text($illustrate.val().length)})),$permanent.on("click",(function(){$permanent.is(":checked")?($date.val(""),$date.attr("disabled","disabled"),startDate=null,endDate=null):$date.removeAttr("disabled")})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3),$(".btn_to_canvas").on("click",(function(e){e.preventDefault(),Swal.fire({icon:"info",title:"前往內容編輯頁",html:"是否保存資料?",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#888888",denyButtonColor:"#d33",confirmButtonText:"　是　",cancelButtonText:"　取消　",denyButtonText:"　否　",reverseButtons:!0}).then((e=>{if(e.isConfirmed)AddUp("已成功發布","發布發生未知錯誤","Canvas");else if(e.isDenied){var t=window.location.hash.replace("#","")+"-1";window.location.hash=t}}))}))}function ElementInit(){$btn_display=$("#Btn_Display"),$name=$("#InputName"),$name_count=$("#ProductForm > .name .name_count"),$introduction=$("#InputIntroduction"),$introduction_count=$("#ProductForm > .introduction .introduction_count"),$illustrate=$("#InputIllustrate"),$illustrate_count=$("#ProductForm > .illustrate .illustrate_count"),$marks=$("#InputMarks"),$spec_select=$(".spec_select"),$price=$(".input_price"),$stock_number=$(".input_stock_number"),$min_number=$(".input_min_number"),$alert_number=$(".input_alert_number"),$date=$("#InputDate"),$permanent=$("#PermanentCheck"),priceModal=new bootstrap.Modal(document.getElementById("PriceModal")),$price_modal=$("#PriceModal >.modal-dialog > .modal-content > .modal-body >.price_option"),document.getElementById("PriceModal").addEventListener("hidden.bs.modal",(function(e){$price_modal.children(".frame").each((function(){$(this).remove(),spec_price_num=0})),$(".input_price").each((function(){var e=$(this),t=e.parents(".frame").data("psid"),a=e.parents(".frame").data("temppsid"),n=modal_price_list.findIndex((e=>e.FK_PSId==t||null!=e.TempPSid&&e.TempPSid==a));n>-1?(text="現金："+modal_price_list[n].Price+" 紅利："+modal_price_list[n].Bonus,e.val(text)):e.val("")})),$(".alert_text").addClass("d-none")}))}function FormDataClear(){TechCertDataClear(),TagDataClear(),$("#Spec_Frame > .frame").each((function(){$(this).remove()})),spec_num=0,keyId=0,$btn_display.children("span").text("visibility"),disp_opt=!0,$name.val(""),$name_count.text(0),$introduction.val(""),$introduction_count.text(0),$illustrate.val(""),$illustrate_count.text(0),$marks.val(""),$price.val(""),$stock_number.val(""),$alert_number.val(""),$min_number.val(""),$permanent.prop("checked",!1),$date.val(""),$date.removeAttr("disabled"),startDate=null,endDate=null,spec_remove_list=[],modal_price_list=[],price_tid=0,temp_psid=0,UploadPreviewFrameClear(),$("#ProductForm > .data_upload > ul").children(".upload_list").remove(),file_num=0}function contentReady(e){product_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(FormDataClear(),""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");0==parseInt(e)?e.includes("-1")?MoveToCanvas():(SpecAdd(null),MoveToContent()):e.includes("-1")?MoveToCanvas():co.Product.Get.ProdOne(parseInt(e)).done((function(e){null!=e?(FormDataSet(e),MoveToContent()):window.location.hash=""}))}}else BackToList()}function editButtonClicked(e){MoveToContent(),keyId=e.row.key,window.location.hash=keyId}function paletteButtonClicked(e){keyId=e.row.key+"-1",window.location.hash=keyId}function FormDataSet(e){TagDataSet(e.tagDatas),TechCertDataSet(e.techCertDatas),e.stocks.forEach((function(e){e.prices.forEach((function(e){var t={};t.Id=e.id,t.Tempid=price_tid,t.FK_PSId=e.fK_PSId,t.TempPSid=0,t.FK_RId=e.fK_RId,t.Price=e.price,t.Bonus=e.bonus,t.IsDelete=!1,price_tid+=1,modal_price_list.push(t)})),SpecAdd(e)})),startDate=e.startTime,endDate=e.endTime,keyId=e.id,disp_opt=e.disp_Opt,$btn_display.children("span").text(e.disp_Opt?"visibility":"visibility_off"),$name.val(e.title),$name_count.text($name.val().length),$introduction.val(e.introduction),$introduction_count.text($introduction.val().length),$illustrate.val(e.description),$illustrate_count.text($illustrate.val().length),$date=$("#InputDate"),e.permanent?($date.val(""),$date.attr("disabled","disabled"),$permanent.prop("checked",!0)):(null!=startDate&&$picker.data("daterangepicker").setStartDate(startDate),null!=endDate&&$picker.data("daterangepicker").setEndDate(endDate))}function deleteButtonClicked(e){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Product.Delete.Prod(e.row.key).done((function(){product_list.component.refresh()})).fail((function(){Coker.sweet.error("錯誤","刪除資料發生錯誤",null,!0)}))}))}function SpecPriceAdd(e){spec_price_num+=1;var t=$($("#ModalTemplatePrice").html()).clone(),a=t.find(".select_role"),n=t.find(".input_cash"),i=t.find(".input_bonus"),o=t.find(".btn_price_delete");t.data("ppid",null==e?0:e.Id),t.data("tempid",null==e?-1:e.Tempid),null!=e&&(a.val(e.FK_RId),n.val(e.Price),i.val(e.Bonus)),o.on("click",(function(){var e=$(this).parents(".frame").first();1==spec_price_num?co.sweet.error("商品至少需有一種價格",null,!1):co.sweet.confirm("移除價格","確定要移除此項價格嗎?","　是　","　否　",(function(){if(0==e.data("ppid")){if(e.data("tempid")>-1){var t=modal_price_list.findIndex((t=>t.Tempid==e.data("tempid")));modal_price_list[t].IsDelete=!0}}else{t=modal_price_list.findIndex((t=>t.Id==e.data("ppid")));modal_price_list[t].IsDelete=!0}spec_price_num-=1,e.remove()}))})),$("#PriceModal > .modal-dialog > .modal-content > .modal-body > .price_option").append(t),$("input[type='number']").on("input",(function(){$(this).val($(this).val()<0?0:$(this).val())}))}function SpecPriceSave(){var e=[],t=!0;$price_modal.children(".frame").each((function(){$self=$(this);var a={};if(a.Id=$self.data("ppid"),a.Tempid=price_tid,a.FK_PSId=$self.parents(".modal-body").first().data("psid"),a.TempPSid=$self.parents(".modal-body").first().data("temppsid"),a.FK_RId=$self.find(".select_role").val(),a.Price=$self.find(".input_cash").val(),a.Bonus=$self.find(".input_bonus").val(),a.IsDelete=!1,0==a.Price&&0==a.Bonus)$(".alert_text").text("商品現金與紅利不可同時為空"),$(".alert_text").removeClass("d-none"),t=!1;else if(null!=e.find((e=>e.FK_RId==a.FK_RId&&e.Price==a.Price&&e.Bonus==a.Bonus)))$(".alert_text").removeClass("d-none"),$(".alert_text").text("價格不可重複"),t=!1;else if(e.push(a),$(".alert_text").addClass("d-none"),$self.data("tempid")<0)modal_price_list.push(a),price_tid+=1;else{var n=modal_price_list.findIndex((e=>e.Tempid==$self.data("tempid")));modal_price_list[n].FK_RId=$self.find(".select_role").val(),modal_price_list[n].Price=$self.find(".input_cash").val(),modal_price_list[n].Bonus=$self.find(".input_bonus").val()}})),t&&priceModal.hide()}function SpecAdd(e){spec_num+=1;var t=$($("#TemplateSpecification").html()).clone(),a=t.find(".topline"),n=t.find(".input_spec").first(),i=t.find(".input_spec").last(),o=t.find("datalist").first(),l=t.find("datalist").last(),d=t.find(".input_price"),r=t.find(".input_min_number"),s=t.find(".input_stock_number"),c=t.find(".input_alert_number"),p=t.find(".collapse"),u=t.find(".btn_expand"),f=t.find(".btn_delete");a.children(".spec").each((function(){var e=$($("#TemplateSpecType").html()).clone();$(this).prepend(e)}));var m=t.find(".spec_select").first(),_=t.find(".spec_select").last();null!=e&&null!=e.fK_ST1id&&(m.val(e.fK_ST1id),e.fK_ST1id>0&&(m.parents(".spec").first().siblings(".spec").children(".spec_select").children("option").each((function(){var e=$(this);e.val()==m.val()&&(e.attr("disabled","disabled"),e.addClass("bg-secondary-light25"))})),n.removeAttr("disabled"),co.Product.Get.ProdSpec(m.val()).done((function(t){null!=t&&t.forEach((function(t){o.append('<option value="'+t.title+'" data-sid="'+t.id+'"></option>'),t.id==e.fK_S1id&&n.val(t.title)}))}))));null!=e&&null!=e.fK_ST2id&&(_.val(e.fK_ST2id),e.fK_ST2id>0&&(_.parents(".spec").first().siblings(".spec").children(".spec_select").children("option").each((function(){var e=$(this);e.val()==_.val()&&(e.attr("disabled","disabled"),e.addClass("bg-secondary-light25"))})),i.removeAttr("disabled"),co.Product.Get.ProdSpec(_.val()).done((function(t){null!=t&&t.forEach((function(t){l.append('<option value="'+t.title+'" data-sid="'+t.id+'"></option>'),t.id==e.fK_S2id&&i.val(t.title)}))}))));null!=e?t.data("psid",e.id):(temp_psid+=1,t.data("temppsid",temp_psid));var v=modal_price_list.findIndex((e=>e.FK_PSId==t.data("psid")||null!=e.TempPSid&&e.TempPSid==t.data("temppsid")));v>-1?(text="現金："+modal_price_list[v].Price+" 紅利："+modal_price_list[v].Bonus,d.val(text)):d.val(""),r.val(null!=e?e.min_Qty:""),s.val(null!=e?e.stock:""),c.val(""),c.val(null!=e?e.alert_Qty:""),p.attr("id","CollapseDetail"+spec_num),u.attr("data-bs-target","#CollapseDetail"+spec_num),u.attr("aria-controls","CollapseDetail"+spec_num),n.attr("list","SpecListOpt"+spec_num+"-1"),i.attr("list","SpecListOpt"+spec_num+"-2"),o.attr("id","SpecListOpt"+spec_num+"-1"),l.attr("id","SpecListOpt"+spec_num+"-2"),d.on("click",(function(){var e=!0,t=$(this),a=t.parents(".frame").data("psid"),n=t.parents(".frame").data("temppsid");$price_modal.parents(".modal-body").first().data("psid",null!=a?a:""),$price_modal.parents(".modal-body").first().data("temppsid",null!=n?n:""),modal_price_list.forEach((function(t){(t.FK_PSId==a||null!=t.TempPsid&&t.TempPsid==n)&&(SpecPriceAdd(t),e=!1)})),e&&SpecPriceAdd(null),priceModal.show()})),null!=e&&(u.children("span").text("expand_more"),u.parents("div").first().prev().removeClass("show")),u.on("click",(function(){var e=$(this);"expand_less"==e.children("span").text()?e.children("span").text("expand_more"):e.children("span").text("expand_less")})),f.on("click",(function(){$self_p=$(this).parents(".frame").first(),1==spec_num?co.sweet.error("商品至少需有一種規格",null,!1):co.sweet.confirm("移除規格","確定要移除此項規格嗎?","　是　","　否　",(function(){spec_remove_list.push($self_p.data("psid")),spec_num-=1,$self_p.remove()}))})),$("#Spec_Frame").append(t),$spec_select=$(".spec_select"),$spec_select.each((function(){$self=$(this),$self.on("change",(function(){var e=$(this),t=e.parents(".spec").first().siblings(".spec"),a=e.siblings(".input_spec"),n=e.siblings("datalist");a.val(""),n.children("option").each((function(){$(this).remove()})),t.children(".spec_select").children("option").each((function(){var e=$(this);e.removeAttr("disabled"),e.removeClass("bg-secondary-light25")})),0==e.val()?a.attr("disabled","disabled"):(t.children(".spec_select").children("option").each((function(){var t=$(this);t.val()==e.val()&&(t.attr("disabled","disabled"),t.addClass("bg-secondary-light25"))})),a.removeAttr("disabled"),co.Product.Get.ProdSpec(e.val()).done((function(e){null!=e&&e.forEach((function(e){n.append('<option value="'+e.title+'" data-sid="'+e.id+'"></option>')}))})))}))})),$price=$(".input_price"),$stock_number=$(".input_stock_number"),$min_number=$(".input_min_number"),$alert_number=$(".input_alert_number"),$("input[type='number']").on("input",(function(){$(this).val($(this).val()<0?0:$(this).val())}))}function ISpecRepect(){var e=[],t=[],a=!1;return $("#Spec_Frame > .frame").each((function(){$self=$(this),$self.find(".input_spec").each((function(){e.push($(this).val())})),null!=t.find((t=>t[0]==e[0]&&t[1]==e[1]))?a=!0:(t.push(e),e=[])})),a}function UploadFile(e){UploadPreviewFrameClear();var t=e.parents(".data_upload").first();if(e.data("edit"))e.data("edit",!1),e.hasClass("upload_list")&&""==e.find(".title").text()&&(e.remove(),file_num-=1);else switch(e.hasClass("upload_list")&&""!=e.find(".title").text()&&$(".upload_list").each((function(){var e=$(this);e.hasClass("upload_list")&&""==e.find(".title").text()&&(e.remove(),file_num-=1)})),upload_file=null,t.find(".upload_frame").children("*").remove(),$(".upload_list").each((function(){$(this).data("edit",!1)})),e.data("edit",!0),t.find(".default_frame").removeClass("d-flex"),e.data("uploadtype")){case 0:var a=t.find(".select_frame");a.addClass("d-flex"),a.find("button").each((function(){$(this).on("click",(function(t){t.preventDefault(),0==e.data("uploadtype")&&(e.data("uploadtype",$(this).data("uploadtype")),e.data("edit",!1),UploadFile(e))}))}));break;case 1:upload_file=co.File.UploadImageInit("FileUpload"),e.data("file")&&(upload_file.addFileToPreviewPanel(e.data("file")),t.find(".upload_frame").find("span").text(e.data("file").name)),t.find(".upload_frame").removeClass("d-none");break;case 2:upload_file=co.File.Upload360Init("FileUpload"),e.data("file")&&(upload_file.addFiles(e.data("file")),t.find(".upload_frame").find("span").text(e.data("file").length+" 張圖片已選擇")),t.find(".upload_frame").removeClass("d-none");break;case 3:upload_file=co.File.UploadVideoInit("FileUpload"),e.data("file")&&(upload_file.addFileToPreviewPanel(e.data("file")),t.find(".upload_frame").find("span").text(e.data("file").name)),t.find(".upload_frame").removeClass("d-none");break;case 4:if(e.data("file")){var n="https://www.youtube.com/watch?v="+e.data("file");t.find(".youtube_frame").find("input").val(n),$("#BtnConnect").click()}else{t.find(".youtube_frame").find("input").val("https://www.youtube.com/watch?v=");$(".youtube_preview").children("*").remove(),$(".youtube_preview").append("<div class='w-100 h-100 d-flex justify-content-center align-items-center bg-black bg-opacity-25 fw-bold'>請輸入正確的Youtube連結</div>")}t.find(".youtube_frame").addClass("d-flex")}}function UploadListAdd(e){var t=$($("#TemplateUploadList").html()).clone(),a=t.find(".ser_no"),n=t.find(".btn_remove");e&&($("#ProductForm > .data_upload > ul > li").each((function(){var e=$(this);e.hasClass("upload_list")&&""==e.find(".title").text()&&(e.remove(),file_num-=1)})),file_num+=1,t.data("tempid",file_num),t.data("serno",file_num),a.val(file_num),t.data("uploadtype",0),t.data("edit",!1),t.on("click",(function(){UploadFile($(this))}))),a.blur((function(){var e=$(this);e.val()<1?e.val(1):e.val()>$(".upload_list").length&&e.val($(".upload_list").length),e.val()!=t.data("serno")&&(e.val()>t.data("serno")?(SortChange("bigger",t.data("serno"),e.val()),$("#ProductForm > .data_upload > ul").children("li").eq(parseInt(e.val())-1).after(t)):e.val()<t.data("serno")&&(SortChange("smaller",e.val(),t.data("serno")),$("#ProductForm > .data_upload > ul").children("li").eq(parseInt(e.val())-1).before(t))),t.data("serno",e.val())})),n.on("click",(function(e){e.preventDefault(),t.data("serno")<file_num&&SortChange("bigger",t.data("serno"),file_num),t.data("edit")&&UploadPreviewFrameClear(),t.remove(),file_num-=1})),$("#ProductForm > .data_upload > ul > .btn_upload_add").before(t),UploadFile(t)}function UploadPreviewFrameClear(){var e=$("#ProductForm > .data_upload > .preview_frame");e.find(".default_frame").addClass("d-flex"),e.find(".upload_frame").addClass("d-none"),e.find(".youtube_frame").removeClass("d-flex"),e.find(".select_frame").removeClass("d-flex")}function SortChange(e,t,a){$(".upload_list").each((function(){var n=$(this);"bigger"==e?n.data("serno")>t&&n.data("serno")<=a&&(n.find(".ser_no").val(parseInt(n.data("serno"))-1),n.data("serno",n.find(".ser_no").val())):"smaller"==e&&n.data("serno")>=t&&n.data("serno")<a&&(n.find(".ser_no").val(parseInt(n.data("serno"))+1),n.data("serno",n.find(".ser_no").val()))}))}function AddUp(e,t,a){var n=[],i=1;$("#Spec_Frame > .frame").each((function(){var e=$(this),t={},a=[];e.find(".input_spec").each((function(){var e=-1;$self_input=$(this),$self_input.siblings("datalist").children("option").each((function(){var t=$(this);t.val()==$self_input.val()&&(e=t.data("sid"))})),a.push(e>-1?e:0)})),t.Id=""==e.data("psid")?0:e.data("psid"),t.FK_S1id=a[0],t.FK_S2id=a[1],t.Stock=e.find(".input_stock_number").val(),t.Ser_No=i,i++,t.Alert_Qty=e.find(".input_alert_number").val(),t.Min_Qty=e.find(".input_min_number").val();var o=[];modal_price_list.forEach((function(t){if(t.FK_PSId==e.data("psid")||t.TempPSid==e.data("temppsid")){var a={};a.Id=t.Id,a.FK_PSId=t.FK_PSId,a.FK_RId=t.FK_RId,a.Price=t.Price,a.Bonus=t.Bonus,a.IsDelete=t.IsDelete,o.push(a)}})),t.Prices=o,n.push(t)})),co.Product.AddUp.Product({Id:keyId,Title:$name.val(),Disp_Opt:disp_opt,Ser_No:500,Introduction:$introduction.val(),Description:$illustrate.val(),StartTime:startDate,EndTime:endDate,Permanent:$permanent.is(":checked"),TagSelected:tag_list,TechCertSelected:techcert_list,Stocks:n}).done((function(n){n.success?"List"==a?(Coker.sweet.success(e,null,!0),setTimeout((function(){BackToList(),product_list.component.refresh()}),1e3)):"Canvas"==a&&(Coker.sweet.success(e,null,!0),setTimeout((function(){var e=window.location.hash.replace("#","")+"-1";window.location.hash=e}),1e3)):Coker.sweet.error("錯誤",t,null,!0)})).fail((function(){Coker.sweet.error("錯誤",t,null,!0)})),spec_remove_list.length>0&&spec_remove_list.forEach((function(e){co.Product.Delete.Stock(e)}))}function MoveToContent(){$("#ProductForm").removeClass("was-validated"),$("#ProductList").addClass("d-none"),$("#ProductCanvas").addClass("d-none"),$("#ProductContent").removeClass("d-none")}function MoveToCanvas(){$("#ProductList").addClass("d-none"),$("#ProductContent").addClass("d-none"),$("#ProductCanvas").removeClass("d-none")}function BackToList(){$("#ProductList").removeClass("d-none"),$("#ProductCanvas").addClass("d-none"),$("#ProductContent").addClass("d-none"),window.location.hash=""}