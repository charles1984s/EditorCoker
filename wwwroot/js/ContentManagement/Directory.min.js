var $btn_display,$bind_type,title,$title_text,$description,$description_text,keyId,directory_list,disp_opt=!0;function PageReady(){co.Directory={AddUp:function(t){return $.ajax({url:"/api/Directory/AddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},Get:function(t){return $.ajax({url:"/api/Directory/GetDataOne/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})},Delete:function(t){return $.ajax({url:"/api/Directory/Delete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})}},ElementInit(),TagListModalInit(),WebmenuListModalInit(),$bind_type.on("change",(function(){switch(parseInt($bind_type.val())){case 1:case 2:$(".webmenu > input").attr("disabled","disabled"),$(".tag > input").removeAttr("disabled"),WebmenuDataClear();break;case 3:$(".tag > input").attr("disabled","disabled"),$(".webmenu > input").removeAttr("disabled","disabled"),TagDataClear()}}));const t=$("#DirectorytForm");Array.from(t).forEach((t=>{t.addEventListener("submit",(e=>{t.checkValidity()?(e.preventDefault(),Coker.sweet.confirm("即將儲存","儲存後將顯示於安排的位置","儲存","取消",(function(){AddUp("已成功儲存","儲存發生未知錯誤")}))):(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated")}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回目錄列表","資料將不被保存","確定","取消",(function(){directory_list.component.refresh(),BackToList()}))})),$(".btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$title_text.on("keyup",(function(){var t=$(this);$title.children("div").children(".count").text(t.val().length)})),$description_text.on("keyup",(function(){var t=$(this);$description.children("div").children(".count").text(t.val().length)})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$btn_display=$(".btn_display"),$bind_type=$("#BindType"),$title=$(".title"),$title_text=$title.children("textarea"),$description=$(".description"),$description_text=$description.children("textarea"),$(".tag > input").attr("disabled","disabled"),$(".webmenu > input").attr("disabled","disabled")}function hashChange(t){t?(HashDataEdit(),t.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var t=window.location.hash.replace("#","");0==parseInt(t)?(window.location.hash=0,keyId=0,FormDataClear(),MoveToContent()):(MoveToContent(),co.Directory.Get(parseInt(t)).done((function(t){null!=t?(MoveToContent(),FormDataSet(t)):(window.location.hash="",keyId="")})))}}else BackToList()}function contentReady(t){directory_list=t,HashDataEdit()}function editButtonClicked(t){MoveToContent(),keyId=t.row.key,window.location.hash=keyId}function reladataButtonClicked(t){console.log(t)}function deleteButtonClicked(t){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Directory.Delete(t.row.key).done((function(e){e.success&&t.component.refresh()})),t.component.refresh()}))}function FormDataClear(){TagDataClear(),WebmenuDataClear(),keyId=0,$btn_display.children("span").text("visibility"),$bind_type.val(null),$title_text.val(""),$description_text.val("")}function FormDataSet(t){switch(console.log(t),FormDataClear(),keyId=t.id,(disp_opt=t.visible)?$btn_display.children("span").text("visibility"):$btn_display.children("span").text("visibility_off"),$bind_type.val(t.type),parseInt($bind_type.val())){case 1:case 2:$(".webmenu > input").attr("disabled","disabled"),$(".tag > input").removeAttr("disabled"),TagDataSet(t.tagDatas),WebmenuDataClear();break;case 3:$(".tag > input").attr("disabled","disabled"),$(".webmenu > input").removeAttr("disabled","disabled"),WebmenuDataSet(t.fK_MId),TagDataClear()}$title_text.val(t.title),$description_text.val(t.description)}function AddUp(t,e){console.log(webmenu_list);var n=null;webmenu_list.length>0&&!webmenu_list[webmenu_list.length-1].IsDeleted&&(n=webmenu_list[webmenu_list.length-1].FK_MId),co.Directory.AddUp({Id:keyId,Title:$title_text.val(),Description:$description_text.val(),Type:parseInt($bind_type.val()),Visible:disp_opt,TagSelected:tag_list,Fk_Mid:n}).done((function(){Coker.sweet.success(t,null,!0),directory_list.component.refresh(),BackToList()})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}function MoveToContent(){$("#DirectorytForm").removeClass("was-validated"),0==keyId?($(".btn_to_canvas").addClass("text-dark"),$(".btn_to_canvas").attr("disabled","")):($(".btn_to_canvas").removeClass("text-dark"),$(".btn_to_canvas").removeAttr("disabled")),$("#DirectoryList").addClass("d-none"),$("#DirectoryContent").removeClass("d-none"),$("#DirectoryCanvas").addClass("d-none")}function BackToList(){$("#TopLine > a").addClass("d-none"),$("#DirectoryList").removeClass("d-none"),$("#DirectoryContent").addClass("d-none"),$("#DirectoryCanvas").addClass("d-none"),window.location.hash=""}