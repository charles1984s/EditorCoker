var $btn_display,$bind_type,title,$title_text,$description,$description_text,keyId,directory_list,disp_opt=!0,DirectoryId=0,DirectoryType="n";let DirectorytForms,$DirectorytTags,ArticletForms,$ArticletTags;function PageReady(){DirectorytForms=$("#DirectorytForm"),ArticletForms=$("#ArticletForm"),ElementInit(),WebmenuListModalInit(),$DirectorytTags=$(DirectorytForms).find(".InputTag").TagListModalInit(),$ArticletTags=$(ArticletForms).find(".InputTag").TagListModalInit(),$bind_type.on("change",(function(){switch(parseInt($bind_type.val())){case 1:case 2:$(DirectorytForms).find(".webmenu > input").attr("disabled","disabled"),$(DirectorytForms).find(".tag > input").removeAttr("disabled"),WebmenuDataClear();break;case 3:$(DirectorytForms).find(".tag > input").attr("disabled","disabled"),$(DirectorytForms).find(".webmenu > input").removeAttr("disabled","disabled"),$DirectorytTags.TagDataClear()}})),Array.from(ArticletForms).forEach((t=>{t.addEventListener("submit",(e=>{t.checkValidity()?(e.preventDefault(),Coker.sweet.confirm("即將儲存","儲存後將顯示於文章列表","儲存","取消",(function(){AddUpArticlet("已成功儲存","儲存發生未知錯誤")}))):(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated")}),!1)})),Array.from(DirectorytForms).forEach((t=>{t.addEventListener("submit",(e=>{t.checkValidity()?(e.preventDefault(),Coker.sweet.confirm("即將儲存","儲存後將顯示於安排的位置","儲存","取消",(function(){AddUp("已成功儲存","儲存發生未知錯誤")}))):(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated")}),!1)})),$("#DirectoryContent .btn_back").on("click",(function(){Coker.sweet.confirm("返回目錄列表","資料將不被保存","確定","取消",(function(){directory_list.component.refresh(),BackToList()}))})),$("#ArticleContent .btn_back").on("click",(function(){const t=$("#DirectoryItemps").data("dir");Coker.sweet.confirm(`返回${t.title}文章列表`,"資料將不被保存","確定","取消",(function(){directoryDatailList.component.refresh(),location.hash=`Articles_${t.id}`}))})),$("#DirectoryList .btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),$("#DirectoryItemps .btn_add").on("click",(function(){window.location.hash=`ArticlesEditor_${DirectoryId}_0`})),$("#DirectoryItemps .btn_back").off("click").on("click",(function(){BackToList()})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$title_text.on("keyup",(function(){var t=$(this);$title.children("div").children(".count").text(t.val().length)})),$description_text.on("keyup",(function(){var t=$(this);$description.children("div").children(".count").text(t.val().length)})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$btn_display=$(".btn_display"),$bind_type=$("#BindType"),$title=$(".title"),$title_text=$title.children("textarea"),$description=$(".description"),$description_text=$description.children("textarea"),$(DirectorytForms).find(".tag > input").attr("disabled","disabled"),$(DirectorytForms).find(".webmenu > input").attr("disabled","disabled")}function hashChange(t){t?(HashDataEdit(),t.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var t=window.location.hash.replace("#","");t&&isNaN(t)?t.indexOf("Editor")>-1?MoveToItemEdit():MoveToItemList():0==parseInt(t)?(window.location.hash=0,keyId=0,FormDataClear(),MoveToContent()):(MoveToContent(),co.Directory.Get(parseInt(t)).done((function(t){null!=t?(MoveToContent(),FormDataSet(t)):(window.location.hash="",keyId="")})))}}else BackToList()}function contentReady(t){directory_list=t,HashDataEdit()}function DirectoryDatailListReady(t){directoryDatailList=t}function editButtonClicked(t){MoveToContent(),keyId=t.row.key,window.location.hash=keyId}function reladataButtonClicked(t){let e;switch(t.row.data.Type){case"文章":e="Articles";break;case"商品":e="Products";break;case"選單":e="Menus";break;default:BackToList()}keyId=`${e}_${t.row.key}`,window.location.hash=keyId}function GetDirectoryId(){return DirectoryId}function GetDirectoryType(){return DirectoryType}function deleteButtonClicked(t){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Directory.Delete(t.row.key).done((function(e){e.success&&t.component.refresh()})),t.component.refresh()}))}function FormDataClear(){$DirectorytTags.TagDataClear(),WebmenuDataClear(),keyId=0,$btn_display.children("span").text("visibility"),$bind_type.val(null),$title_text.val(""),$description_text.val("")}function FormDataSet(t){switch(FormDataClear(),keyId=t.id,(disp_opt=t.visible)?$btn_display.children("span").text("visibility"):$btn_display.children("span").text("visibility_off"),$bind_type.val(t.type),parseInt($bind_type.val())){case 1:case 2:$(DirectorytForms).find(".webmenu > input").attr("disabled","disabled"),$(DirectorytForms).find(".tag > input").removeAttr("disabled"),$DirectorytTags.TagDataSet(t.tagDatas),WebmenuDataClear();break;case 3:$(DirectorytForms).find(".tag > input").attr("disabled","disabled"),$(DirectorytForms).find(".webmenu > input").removeAttr("disabled","disabled"),WebmenuDataSet(t.fK_MId),$DirectorytTags.TagDataClear()}$title_text.val(t.title),$description_text.val(t.description)}function AddUp(t,e){var i=null;webmenu_list.length>0&&!webmenu_list[webmenu_list.length-1].IsDeleted&&(i=webmenu_list[webmenu_list.length-1].FK_MId),co.Directory.AddUp({Id:keyId,Title:$title_text.val(),Description:$description_text.val(),Type:parseInt($bind_type.val()),Visible:disp_opt,TagSelected:tag_list,Fk_Mid:i}).done((function(){Coker.sweet.success(t,null,!0),directory_list.component.refresh(),BackToList()})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}function AddUpArticlet(t,e){const i=co.Form.getJson($(ArticletForms).attr("id"));null!=$("#ImageUpload .img_input_frame").data("delectList")&&(console.log($("#ImageUpload .img_input_frame").data("delectList")),co.File.DeleteFileById({Sid:keyId,Type:6,Fid:$("#ImageUpload .img_input_frame").data("delectList")})),co.Articles.AddUp(i).done((e=>{const i=function(){Coker.sweet.success(t,null,!0),directoryDatailList.component.refresh(),location.hash=`Articles_${DirectoryId}`};if(null!=$("#ImageUpload .img_input").data("file")&&null!=$("#ImageUpload .img_input").data("file").File&&0==$("#ImageUpload .img_input").data("file").id){var n=new FormData;n.append("files",$("#ImageUpload .img_input").data("file").File),n.append("type",6),n.append("sid",e.message),n.append("serno",500),co.File.Upload(n).done((function(){i()}))}else i()}))}function MoveToContent(){$(DirectorytForms).removeClass("was-validated"),keyId&&isNaN(keyId),0==keyId?($(".btn_to_canvas").addClass("text-dark"),$(".btn_to_canvas").attr("disabled","")):($(".btn_to_canvas").removeClass("text-dark"),$(".btn_to_canvas").removeAttr("disabled")),$("#DirectoryList").addClass("d-none"),$("#DirectoryContent").removeClass("d-none"),$("#DirectoryCanvas").addClass("d-none"),$("#DirectoryItemps").addClass("d-none"),$("#ArticleContent").addClass("d-none")}function BackToList(){$("#TopLine > a").addClass("d-none"),$("#DirectoryList").removeClass("d-none"),$("#DirectoryContent").addClass("d-none"),$("#DirectoryCanvas").addClass("d-none"),$("#DirectoryItemps").addClass("d-none"),$("#ArticleContent").addClass("d-none"),DirectoryId=0,DirectoryType="n",window.location.hash=""}function MoveToItemList(){const t=window.location.hash.replace("#","").split("_");$("#DirectoryList").addClass("d-none"),$("#DirectoryContent").addClass("d-none"),$("#DirectoryCanvas").addClass("d-none"),$("#DirectoryItemps").removeClass("d-none"),$("#DirectoryItemps>div").addClass("d-none"),$("#ArticleContent").addClass("d-none");if(0==$(`#DirectoryItemps>.${t[0].toLowerCase()}`).removeClass("d-none").length)BackToList();else if(t.length>1&&!isNaN(t[1]))if(DirectoryId=parseInt(t[1]),"Articles"===(DirectoryType=t[0]))directoryDatailList.component.refresh();else BackToList()}function MoveToItemEdit(){const t=window.location.hash.replace("#","").split("_");if($("#DirectoryList").addClass("d-none"),$("#DirectoryContent").addClass("d-none"),$("#DirectoryCanvas").addClass("d-none"),$("#DirectoryItemps").addClass("d-none"),$("#DirectoryItemps>div").addClass("d-none"),$("#ArticleContent").removeClass("d-none"),$ArticletTags.TagDataClear(),t.length>2&&!isNaN(t[1])&&!isNaN(t[2]))if("ArticlesEditor"===t[0]){const e=parseInt(t[2]);DirectoryId=parseInt(t[1]),co.Directory.Get(DirectoryId).done((t=>{$("#DirectoryItemps").data("dir",t)})),e>0?co.Articles.GetDataOne(e).done((function(t){null!=t?(t.startEndDate=0,t.sortCheckbox=1,t.ImageUpload=1,co.Form.insertData(t,"#ArticletForm"),$ArticletTags.TagDataSet(t.tagDatas)):BackToList()})):co.Form.clear("ArticletForm")}else BackToList()}function editArticlesButtonClicked(t){window.location.hash=`ArticlesEditor_${DirectoryId}_${t.row.key}`}function paletteArticlesButtonClicked(){}function deleteArticlesButtonClicked(){}