var $btn_display,$btn_pop_visible,$title,$title_text,$describe,$describe_text,$sort,$sort_input,$sort_checkbox,keyId,article_list,setPage,disp_opt=!0,pop_visible=!0;function PageReady(){co.Articles={AddUp:function(e){return $.ajax({url:"/api/Article/AddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(e),dataType:"json"})},GetDataOne:function(e){return $.ajax({url:"/api/Article/GetDataOne/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:e}})},Delete:function(e){return $.ajax({url:"/api/Article/Delete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:e}})},GetConten:function(e){return $.ajax({url:"/api/Article/GetConten",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(e),dataType:"json"})},SaveConten:function(e){return $.ajax({url:"/api/Article/SaveConten",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(e),dataType:"json"})},ImportConten:function(e){return $.ajax({url:"/api/Article/ImportConten",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(e),dataType:"json"})}};const e=grapesInit({save:function(e,t){var n=$.Deferred();return co.Articles.SaveConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:t}).done((function(e){e.success?n.resolve():co.sweet.error(e.error)})),n.promise()},import:function(e,t){var n=$.Deferred();return co.Articles.ImportConten({Id:$("#gjs").data("id"),SaveHtml:e,SaveCss:t}).done((function(e){e.success?n.resolve():co.sweet.error(e.error)})),n.promise()},getComponer:function(){var e=$.Deferred();return co.HtmlContent.GetAllComponent().done((function(t){t.success?e.resolve(t.list):co.sweet.error(resutlt.error)})),e.promise()}});setPage=function(t){co.Articles.GetConten({Id:t}).done((function(t){if(t.success){var n=co.Data.HtmlDecode(t.conten.saveHtml);e.setComponents(n),e.setStyle(t.conten.saveCss)}else co.sweet.error(t.error)}))},ElementInit(),ImageUploadInit("single",$(".image_upload")),TagListModalInit();const t=$("#ArticletForm");Array.from(t).forEach((e=>{e.addEventListener("submit",(t=>{e.checkValidity()?(t.preventDefault(),Coker.sweet.confirm("即將儲存","儲存後將顯示於安排的位置","儲存","取消",(function(){AddUp("已成功儲存","儲存發生未知錯誤")}))):(t.preventDefault(),t.stopPropagation()),e.classList.add("was-validated"),WasValidated()}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回文章列表","資料將不被保存","確定","取消",(function(){article_list.component.refresh(),BackToList()}))})),$(".btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),$(".btn_to_canvas").on("click",(function(e){e.preventDefault(),Swal.fire({icon:"info",title:"前往文章編輯頁",html:"是否保存資料?",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#888888",denyButtonColor:"#d33",confirmButtonText:"　是　",denyButtonText:"　否　",cancelButtonText:"　取消　",reverseButtons:!0}).then((e=>{if(e.isConfirmed)AddUp("資料已儲存","儲存發生未知錯誤","canvas");else if(e.isDenied){var t=window.location.hash.replace("#","")+"-1";window.location.hash=t,MoveToCanvas()}}))})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$btn_pop_visible.on("click",(function(){pop_visible?($btn_pop_visible.children("span").text("group_off"),pop_visible=!pop_visible):($btn_pop_visible.children("span").text("group"),pop_visible=!pop_visible)})),$title_text.on("keyup",(function(){var e=$(this);$title.children("div").children(".count").text(e.val().length)})),$describe_text.on("keyup",(function(){var e=$(this);$describe.children("div").children(".count").text(e.val().length)})),$sort_checkbox.on("click",(function(){$(this).is(":checked")?$sort_input.removeAttr("disabled"):($sort_input.val(""),$sort_input.attr("disabled","disabled"))})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$btn_display=$(".btn_display"),$btn_pop_visible=$(".btn_pop_visible"),$title=$(".title"),$title_text=$title.children("textarea"),$describe=$(".describe"),$describe_text=$describe.children("textarea"),$sort=$(".sort"),$sort_input=$sort.children("input"),$sort_checkbox=$sort.children(".checkbox").children("input")}function contentReady(e){article_list=e,HashDataEdit()}function hashChange(e){e?(HashDataEdit(),e.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var e=window.location.hash.replace("#","");0==parseInt(e)?(window.location.hash=0,keyId=0,FormDataClear(),MoveToContent()):co.Articles.GetDataOne(parseInt(e)).done((function(t){null!=t?(keyId=parseInt(e),e.indexOf("-")>0?MoveToCanvas():(MoveToContent(),co.File.getImgFile({Sid:t.id,Type:6,Size:3}).done((function(e){FormDataSet(t,e[0])})))):(window.location.hash="",keyId="")}))}}else BackToList()}function editButtonClicked(e){MoveToContent(),keyId=e.row.key,window.location.hash=keyId}function FormDataClear(){TagDataClear(),SingleImageClear(),keyId=0,$btn_display.children("span").text("visibility"),$btn_pop_visible.children("span").text("group"),$title_text.val(""),$title.children("div").children(".count").text(0),$describe_text.val(""),$describe.children("div").children(".count").text(0),$sort_input.val(""),$sort_input.attr("disabled","disabled"),$sort_checkbox.prop("checked",!1)}function FormDataSet(e,t){FormDataClear(),SingleSetImage(t),keyId=e.id,e.visible||$btn_display.children("span").text("visibility_off"),e.popularVisible||$btn_pop_visible.children("span").text("group_off"),$title_text.val(e.title),$title.children("div").children(".count").text(e.title.length),$describe_text.val(e.description),$describe.children("div").children(".count").text(e.description.length),500!=e.serNO&&($sort_input.val(e.serNO),$sort_input.removeAttr("disabled"),$sort_checkbox.prop("checked",!0)),TagDataSet(e.tagDatas)}function paletteButtonClicked(e){keyId=e.row.key,window.location.hash=keyId+"-1",MoveToCanvas()}function deleteButtonClicked(e){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Articles.Delete(e.row.key).done((function(t){t.success&&e.component.refresh()}))}))}function AddUp(e,t,n){co.Articles.AddUp({Id:keyId,Title:$title_text.val(),Description:$describe_text.val(),Visible:disp_opt,SerNO:$sort_checkbox.is(":checked")?$sort_input.val():500,PopularVisible:pop_visible,TagSelected:tag_list}).done((function(i){if(i.success)if(img_delete_list.length>0&&img_delete_list.forEach((function(e){co.File.DeleteImgByImgId(e).done((function(e){}))})),img_file.length>0){var o=new FormData;o.append("type",6),o.append("sid",i.message);for(var a=0;a<img_file.length;a+=3){for(var s=a;s<a+3;s++)o.append("files",img_file[s]);co.File.Upload(o).done((function(i){i.success?(Coker.sweet.success(e,null,!0),setTimeout((function(){"canvas"==n?setTimeout((function(){window.location.hash+="-1",MoveToCanvas()}),1e3):setTimeout((function(){article_list.component.refresh(),BackToList()}),1e3)}),1e3)):Coker.sweet.error("錯誤",t,null,!0)})),o.delete("files")}}else Coker.sweet.success(e,null,!0),"canvas"==n?setTimeout((function(){window.location.hash+="-1",MoveToCanvas()}),1e3):setTimeout((function(){article_list.component.refresh(),BackToList()}),1e3);else Coker.sweet.error("錯誤",t,null,!0)})).fail((function(){Coker.sweet.error("錯誤",t,null,!0)}))}function MoveToContent(){UnValidated(),0==keyId?($(".btn_to_canvas").addClass("text-dark"),$(".btn_to_canvas").attr("disabled","")):($(".btn_to_canvas").removeClass("text-dark"),$(".btn_to_canvas").removeAttr("disabled")),$("#ArticleList").addClass("d-none"),$("#ArticleContent").removeClass("d-none"),$("#ArticleCanvas").addClass("d-none")}function MoveToCanvas(){UnValidated(),$("#gjs").data("id",keyId),setPage(keyId),$("#TopLine > a").removeClass("d-none"),$("#ArticleList").addClass("d-none"),$("#ArticleContent").addClass("d-none"),$("#ArticleCanvas").removeClass("d-none")}function BackToList(){$("#TopLine > a").addClass("d-none"),$("#ArticleList").removeClass("d-none"),$("#ArticleContent").addClass("d-none"),$("#ArticleCanvas").addClass("d-none"),window.location.hash=""}function WasValidated(){$sort.children(".checkbox").addClass("pe-4")}function UnValidated(){$("#ArticletForm").removeClass("was-validated"),$sort.children(".checkbox").removeClass("pe-4")}