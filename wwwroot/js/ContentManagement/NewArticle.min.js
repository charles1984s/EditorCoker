var $btn_display,$btn_pop_visible,$title,$title_text,$describe,$describe_text,$sort,$sort_input,$sort_checkbox,keyId,article_list,disp_opt=!0,pop_visible=!0;function PageReady(){co.Articles={AddUp:function(t){return $.ajax({url:"/api/Article/AddUp_Simple",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},GetSimple:function(t){return $.ajax({url:"/api/Article/GetSimple/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})},Delete:function(t){return $.ajax({url:"/api/Article/Delete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{Id:t}})}},ElementInit();const t=$("#ArticletForm");Array.from(t).forEach((t=>{t.addEventListener("submit",(e=>{t.checkValidity()?(e.preventDefault(),Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp("已成功發布","發布發生未知錯誤")}))):(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated"),WasValidated()}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回文章列表","資料將不被保存","確定","取消",(function(){article_list.component.refresh(),BackToList()}))})),$(".btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),$(".btn_to_canvas").on("click",(function(t){t.preventDefault(),Swal.fire({icon:"info",title:"前往文章編輯頁",html:"是否保存資料?",showCancelButton:!0,showDenyButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#888888",denyButtonColor:"#d33",confirmButtonText:"　是　",denyButtonText:"　否　",cancelButtonText:"　取消　",reverseButtons:!0}).then((t=>{if(t.isConfirmed)AddUp("已成功發布","發布發生未知錯誤","canvas");else if(t.isDenied){var e=window.location.hash.replace("#","")+"-1";window.location.hash=e,MoveToCanvas()}}))})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$btn_pop_visible.on("click",(function(){pop_visible?($btn_pop_visible.children("span").text("group_off"),pop_visible=!pop_visible):($btn_pop_visible.children("span").text("group"),pop_visible=!pop_visible)})),$title_text.on("keyup",(function(){var t=$(this);$title.children("div").children(".count").text(t.val().length)})),$describe_text.on("keyup",(function(){var t=$(this);$describe.children("div").children(".count").text(t.val().length)})),$sort_checkbox.on("click",(function(){$(this).is(":checked")?$sort_input.removeAttr("disabled"):($sort_input.val(""),$sort_input.attr("disabled","disabled"))})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$btn_display=$(".btn_display"),$btn_pop_visible=$(".btn_pop_visible"),$title=$(".title"),$title_text=$title.children("textarea"),$describe=$(".describe"),$describe_text=$describe.children("textarea"),$sort=$(".sort"),$sort_input=$sort.children("input"),$sort_checkbox=$sort.children(".checkbox").children("input")}function contentReady(t){article_list=t,HashDataEdit()}function hashChange(t){t?(HashDataEdit(),t.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var t=window.location.hash.replace("#","");1==t.indexOf("-")?MoveToCanvas():0==parseInt(t)?(FormDataClear(),MoveToContent()):co.Articles.GetSimple(parseInt(t)).done((function(t){null!=t?(MoveToContent(),FormDataSet(t)):window.location.hash=""}))}}else BackToList()}function editButtonClicked(t){MoveToContent(),keyId=t.row.key,window.location.hash=keyId}function FormDataSet(t){FormDataClear(),keyId=t.id,t.visible||$btn_display.children("span").text("visibility_off"),t.popularVisible||$btn_pop_visible.children("span").text("group_off"),$title_text.val(t.title),$title.children("div").children(".count").text(t.title.length),$describe_text.val(t.description),$describe.children("div").children(".count").text(t.description.length),500!=t.serNO&&($sort_input.val(t.serNO),$sort_input.removeAttr("disabled"),$sort_checkbox.prop("checked",!0))}function FormDataClear(){keyId=0,$btn_display.children("span").text("visibility"),$btn_pop_visible.children("span").text("group"),$title_text.val(""),$title.children("div").children(".count").text(0),$describe_text.val(""),$describe.children("div").children(".count").text(0),$sort_input.val(""),$sort_input.attr("disabled","disabled"),$sort_checkbox.prop("checked",!1)}function paletteButtonClicked(t){keyId=t.row.key+"-1",window.location.hash=keyId,MoveToCanvas()}function deleteButtonClicked(t){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Articles.Delete(t.row.key).done((function(e){e.success&&t.component.refresh()}))}))}function AddUp(t,e,n){co.Articles.AddUp({Id:keyId,Title:$title_text.val(),Description:$describe_text.val(),Visible:disp_opt,SerNO:$sort_checkbox.is(":checked")?$sort_input.val():500,PopularVisible:pop_visible}).done((function(){Coker.sweet.success(t,null,!0),"canvas"==n?setTimeout((function(){window.location.hash+="-1",MoveToCanvas()}),1e3):setTimeout((function(){article_list.component.refresh(),BackToList()}),1e3)})).fail((function(){Coker.sweet.error("錯誤",e,null,!0)}))}function MoveToContent(){UnValidated(),0==keyId?($(".btn_to_canvas").addClass("text-dark"),$(".btn_to_canvas").attr("disabled","")):($(".btn_to_canvas").removeClass("text-dark"),$(".btn_to_canvas").removeAttr("disabled")),$("#ArticleList").addClass("d-none"),$("#ArticleContent").removeClass("d-none"),$("#ArticleCanvas").addClass("d-none")}function MoveToCanvas(){UnValidated(),$("#ArticleList").addClass("d-none"),$("#ArticleContent").addClass("d-none"),$("#ArticleCanvas").removeClass("d-none")}function BackToList(){$("#ArticleList").removeClass("d-none"),$("#ArticleContent").addClass("d-none"),$("#ArticleCanvas").addClass("d-none"),window.location.hash=""}function WasValidated(){$sort.children(".checkbox").addClass("pe-4")}function UnValidated(){$("#ArticletForm").removeClass("was-validated"),$sort.children(".checkbox").removeClass("pe-4")}