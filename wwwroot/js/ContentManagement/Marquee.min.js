var $placement,$btn_display,$title,$title_count,$input_sort,$check_sort,$link,$target,$date,$picker,$permanent,startDate,endDate,keyId,marquee_list,disp_opt=!0;function PageReady(){co.Marquees={AddUp:function(t){return $.ajax({url:"/api/Marquee/AddUp",type:"POST",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:JSON.stringify(t),dataType:"json"})},Get:function(t){return $.ajax({url:"/api/Marquee/Get/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{id:t}})},Delete:function(t){return $.ajax({url:"/api/Marquee/Delete/",type:"GET",contentType:"application/json; charset=utf-8",headers:_c.Data.Header,data:{id:t}})}},ElementInit(),$picker=$("#InputDate"),co.Picker.Init($picker),$picker.on("apply.daterangepicker",(function(t,e){$(this).val(e.startDate.format("YYYY/MM/DD HH:mm")+" ~ "+e.endDate.format("YYYY/MM/DD HH:mm")),startDate=e.startDate.format(""),endDate=e.endDate.format("")}));const t=$("#PostForm");Array.from(t).forEach((t=>{t.addEventListener("submit",(e=>{t.checkValidity()?(e.preventDefault(),Coker.sweet.confirm("即將發布","發布後將直接顯示於安排的位置","發布","取消",(function(){AddUp(disp_opt,"已成功發布","發布發生未知錯誤")}))):(e.preventDefault(),e.stopPropagation()),t.classList.add("was-validated"),WasValidated()}),!1)})),$(".btn_back").on("click",(function(){Coker.sweet.confirm("返回商品列表","資料將不被保存","確定","取消",(function(){history.back()}))})),$(".btn_add").on("click",(function(){FormDataClear(),window.location.hash=0,HashDataEdit()})),$btn_display.on("click",(function(){disp_opt?($btn_display.children("span").text("visibility_off"),disp_opt=!disp_opt):($btn_display.children("span").text("visibility"),disp_opt=!disp_opt)})),$title.on("keyup",(function(){$title_count.text($title.val().length)})),$check_sort.on("click",(function(){$check_sort.is(":checked")?$input_sort.removeAttr("disabled"):($input_sort.val(""),$input_sort.attr("disabled","disabled"))})),$permanent.on("click",(function(){$permanent.is(":checked")?($date.val(""),$date.attr("disabled","disabled"),startDate=null,endDate=null):$date.removeAttr("disabled")})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function ElementInit(){$placement=$("#Placement"),$btn_display=$("#Btn_Display"),$title=$("#InputTitle"),$title_count=$("#PostForm > .title .title_count"),$input_sort=$("#InputSort"),$check_sort=$("#SortCheck"),$link=$("#InputLink"),$target=$("#TargetCheck"),$date=$("#InputDate"),$permanent=$("#PermanentCheck")}function contentReady(t){marquee_list=t,HashDataEdit()}function hashChange(t){t?(HashDataEdit(),t.preventDefault()):console.log("HashChange錯誤")}function HashDataEdit(){if(""!=window.location.hash){if(window.currentHash!=window.location.hash){var t=window.location.hash.replace("#","");0==parseInt(t)?(FormDataClear(),MoveToContent()):co.Marquees.Get(parseInt(t)).done((function(t){null!=t?(MoveToContent(),FormDataSet(t)):window.location.hash=""}))}}else BackToList()}function editButtonClicked(t){MoveToContent(),keyId=t.row.key,window.location.hash=keyId}function FormDataSet(t){FormDataClear(),keyId=t.id,startTime=t.startTime,endTime=t.endTime,$placement.val(t.placement),$btn_display.children("span").text(t.disp_opt?"visibility":"visibility_off"),disp_opt=t.disp_opt,$title.val(t.title),$title_count.text($title.val().length),500!=t.ser_no&&($check_sort.prop("checked",!0),$input_sort.removeAttr("disabled","disabled"),$input_sort.val(t.ser_no)),$link.val(t.link),$target.prop("checked",t.target),t.permanent?($date.val(""),$date.attr("disabled","disabled"),$permanent.prop("checked",!0)):(null!=startTime&&$picker.data("daterangepicker").setStartDate(startTime),null!=endTime&&$picker.data("daterangepicker").setEndDate(endTime))}function FormDataClear(){keyId=0,$placement.val("Top"),$btn_display.children("span").text("visibility"),disp_opt=!0,$title.val(""),$title_count.text(0),$input_sort.val(""),$input_sort.attr("disabled","disabled"),$check_sort.prop("checked",!1),$link.val(""),$target.prop("checked",!1),$permanent.prop("checked",!1),$date.val(""),$date.removeAttr("disabled")}function deleteButtonClicked(t){Coker.sweet.confirm("刪除資料","刪除後不可返回","確定刪除","取消",(function(){co.Marquees.Delete(t.row.key),t.component.refresh()}))}function AddUp(t,e,a){co.Marquees.AddUp({Id:keyId,placement:$placement.val(),title:$title.val(),disp_opt:t,ser_no:$check_sort.is(":checked")?$input_sort.val():500,link:$link.val(),target:$target.is(":checked"),StartTime:startDate,EndTime:endDate,permanent:$permanent.is(":checked")}).done((function(){Coker.sweet.success(e,null,!0),setTimeout((function(){BackToList(),marquee_list.component.refresh()}),1e3)})).fail((function(){Coker.sweet.error("錯誤",a,null,!0)}))}function MoveToContent(){UnValidated(),$("#MarqueeList").addClass("d-none"),$("#MarqueeContent").removeClass("d-none")}function BackToList(){$("#MarqueeList").removeClass("d-none"),$("#MarqueeContent").addClass("d-none"),window.location.hash=""}function WasValidated(){$check_sort.parents(".checkbox").first().addClass("pe-4"),$target.parents(".checkbox").first().addClass("pe-4"),$permanent.parents(".checkbox").first().addClass("pe-4")}function UnValidated(){$("#PostForm").removeClass("was-validated"),$check_sort.parents(".checkbox").first().removeClass("pe-4"),$target.parents(".checkbox").first().removeClass("pe-4"),$permanent.parents(".checkbox").first().removeClass("pe-4")}