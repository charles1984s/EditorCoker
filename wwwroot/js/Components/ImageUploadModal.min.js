function ImageUploadModalClear(e){e.find(".img_input_frame").data("delectList",null),e.find(".img_input_frame").children().each((function(){var e=$(this);e.is("template")||e.remove()})),ImageSetData(e,null)}$.fn.extend({ImageUploadModalClear:function(){var e=$(this);e.find(".img_input_frame").data("delectList",null),e.find(".img_input_frame").children().each((function(){var e=$(this);e.is("template")||e.remove()})),ImageSetData(e,null)}});var ImageUploadModalInit=ImageUploadModalClear;function ImageDelect(e){if(e.find(".btn_input_pic").hasClass("has_image")){if(console.log(e.data("file")),e.data("file").id>0){var a=[];void 0!==e.parent(".img_input_frame").data("delectList")&&null!=e.parent(".img_input_frame").data("delectList")&&(a=e.parent(".img_input_frame").data("delectList")),a.push(e.data("file").id),console.log(a),e.parent(".img_input_frame").data("delectList",a)}ImageClear(e)}}function ImageClear(e){var a=e.find(".btn_input_pic"),t=e.parents(".img_input_frame");if(a.hasClass("has_image"))if(t.parent().first().data("issinge")){a.removeClass("has_image"),e.data("file",null);var i=e.find(".img_preview");i.addClass("d-none"),i.removeClass("d-none"),i.siblings("span").removeClass("d-none"),i.parents("button").first().removeClass("border-0"),i.attr("src",""),i.attr("alt","");var n=e.find(".file_name");e.find(".btn_img_delete").addClass("d-none"),n.text("加入照片")}else e.remove()}function ImageUploadModalDataInsert(e,a,t,i){if(""!=a){var n={};n.id=a,n.File=null,n.name=i,n.link=t,ImageSetData(e,n)}}function ImageSetData(e,a){var t=e.data("issinge"),i=e.data("needcompress");if(null!=a&&t)var n=e.find(".img_input");else if(e.hasClass("img_input"))n=e;else n=$($("#Template_Image_Preview").html()).clone();if(null!=a){if(n.find(".btn_img_delete").removeClass("d-none"),void 0!==n.data("file")&&null!=n.data("file")){var l=n.parent(".img_input_frame"),s=void 0===l.data("delectList")||null==l.data("delectList")?[]:l.data("delectList");s.push(n.data("file").id),l.data("delectList",s)}n.data("file",a);var r=n.find(".img_preview");r.removeClass("d-none"),r.siblings("span").addClass("d-none"),r.parents("button").first().addClass("border-0"),r.attr("src",a.link?a.link:a.path),r.attr("alt",a.name),n.find(".btn_input_pic").addClass("has_image"),n.find(".file_name").text(a.name)}t&&null!=a||(t||null!=a||n.find(".input_pic").each((function(){$(this).attr("multiple","multiple")})),n.find(".btn_input_pic").on("click",(function(e){e.preventDefault(),$(this).parents("div").first().prev(".input_pic").click()})),n.find(".btn_img_delete").on("click",(function(e){e.preventDefault(),ImageDelect($(this).parents(".img_input").first())})),n.find(".input_pic").change((function(){var a=$(this).parent(".img_input");void 0!==a.data("file")&&(e=a),$.each(this.files,(function(a,t){var n;i?((n=new FileReader).readAsDataURL(t),n.onload=function(a){var i=[];i.push(t),htmlImageCompress=new HtmlImageCompress(i[0],{quality:.7,width:500,height:500,imageType:i[0].type}),htmlImageCompress.then((function(n){i.push(new File([n.file],n.origin.name,{type:n.file.type})),htmlImageCompress=new HtmlImageCompress(i[0],{quality:.3,width:500,height:500,imageType:i[0].type}),htmlImageCompress.then((function(n){i.push(new File([n.file],n.origin.name,{type:n.file.type}));var l={id:0};l.File=i,l.name=t.name,l.link=a.target.result,ImageSetData(e,l)})).catch((function(e){console.log($`發生錯誤：${e}`),UploadPreviewFrameClear(),co.sweet.error("資料上傳失敗","請重新上傳",null,null)}))})).catch((function(e){console.log($`發生錯誤：${e}`),UploadPreviewFrameClear(),co.sweet.error("資料上傳失敗","請重新上傳",null,null)}))}):((n=new FileReader).readAsDataURL(t),n.onload=function(a){var i={id:0};i.File=t,i.name=t.name,i.link=a.target.result,ImageSetData(e,i)})}))})),e.find(".img_input_frame").prepend(n))}