function ImageUploadModalInit(e,i,a){a||i&&(e.find(".btn_input_pic").on("click",(function(e){e.preventDefault(),$(this).parents("div").first().prev(".input_pic").click()})),e.find(".input_pic").change((function(){var e=$(this).parents(".image_upload").first(),i=this.files[0],a=new FileReader;a.readAsDataURL(i),a.onload=function(a){var t={Id:0};t.File=i,t.Name=i.name,t.Link=a.target.result,e.data("file",t),ImageSetData(e)}})),e.find(".btn_img_delete").on("click",(function(e){e.preventDefault(),ImageDelect($(this).parents(".image_upload").first())}))),ImageUploadModalClear(e)}function ImageUploadModalClear(e){e.children("div").each((function(i,a){i>0?a.remove():(e.data("delectList",null),ImageClear(e))}))}function ImageDelect(e){if(e.find(".btn_input_pic").hasClass("has_image")){if(e.data("file").Id>0){var i=[];null!=e.data("delectList")&&(i=e.data("delectList")),i.push(e.data("file").Id),e.data("delectList",i)}ImageClear(e)}}function ImageClear(e){var i=e.find(".btn_input_pic");if(i.hasClass("has_image")){var a=e.find(".img_preview"),t=e.find(".file_name");a.addClass("d-none"),a.removeClass("d-none"),a.siblings("span").removeClass("d-none"),a.parents("button").first().removeClass("border-0"),i.removeClass("has_image"),e.data("file",null),a.attr("src",""),a.attr("alt",""),t.text("加入照片")}}function ImageUploadModalDataInsert(e,i,a,t){if(""!=i){var n={};n.Id=i,n.File=null,n.Name=t,n.Link=a,e.data("file",n),ImageSetData(e)}}function ImageSetData(e){var i=e.data("file");if(void 0===e.data("file")||null==e.data("file"));else{var a=e.find(".img_preview"),t=e.find(".btn_input_pic"),n=e.find(".file_name");a.removeClass("d-none"),a.siblings("span").addClass("d-none"),a.parents("button").first().addClass("border-0"),t.addClass("has_image"),a.attr("src",i.Link),a.attr("alt",i.Name),n.text(i.Name)}}function SingleImageClear(){$img_preview.hasClass("d-none")||$img_preview.addClass("d-none"),$img_preview.siblings("span").removeClass("d-none"),$img_preview.siblings("span").text("add_photo_alternate"),$img_preview.parents("button").first().removeClass("border-0"),$img_preview.parents("button").first().css("width",default_width),$img_preview.attr("src",""),$image_upload.removeData("Id")}function SingleSetImage(e){null!=e&&($img_preview.removeClass("d-none"),$img_preview.siblings("span").addClass("d-none"),$img_preview.parents("button").first().addClass("border-0"),default_width=$img_preview.parents("button").first().css("width"),$img_preview.parents("button").first().css("width","unset"),$img_preview.attr("src",e.link),$img_preview.attr("alt",e.name),$image_upload.data("Id",e.id)),img_file=[]}function SingleUploadImage(e){img_file=[],img_file.push(e),new HtmlImageCompress(img_file[0],{quality:.7}).then((function(e){img_file.push(new File([e.file],img_file[0].name)),new HtmlImageCompress(img_file[0],{quality:.3}).then((function(e){img_file.push(new File([e.file],img_file[0].name));var i=new FileReader;i.readAsDataURL(img_file[2]),i.onload=function(e){$img_preview.removeClass("d-none"),$img_preview.siblings("span").addClass("d-none"),$img_preview.parents("button").first().addClass("border-0"),default_width=$img_preview.parents("button").first().css("width"),$img_preview.parents("button").first().css("width","unset"),$img_preview.attr("src",e.target.result),$img_preview.attr("alt",img_file[0].name)},void 0!==$image_upload.data("Id")&&(img_delete_list.push(image_upload.data("Id")),$image_upload.removeData("Id"))})).catch((function(e){console.log($`發生錯誤：${e}`),$img_preview.addClass("d-none"),$img_preview.siblings("span").removeClass("d-none"),$img_preview.siblings("span").text("warning"),$img_preview.parents("button").first().removeClass("border-0"),$img_preview.parents("button").first().css("width",default_width),$img_preview.attr("src",""),img_file=[]}))})).catch((function(e){console.log($`發生錯誤：${e}`),$img_preview.siblings("span").text("warning"),img_file=[]}))}