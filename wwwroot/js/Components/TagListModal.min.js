var $btn_tag_save,$tag,TagList_dxData,$price_modal,priceModal,$techcert_body,techcertModal,tag_changedBySelectBox,tag_clearSelectionButton,tag_text,tag_list=[],tag_check_list=[];function TagListModalInit(){TagListModalElementInit(),tagModal=new bootstrap.Modal(document.getElementById("TagModal")),$("#TagModal").on("hidden.bs.modal",(function(){var t=[];tag_list.forEach((function(a){a.IsDeleted||t.push(a.FK_TId)})),getTagListDataGridInstance().selectRows(t)})),$btn_tag_save.on("click",(function(){if(tag_check_list.length>0){var t=tag_check_list.slice();tag_list.forEach((function(a){var e=t.indexOf(a.FK_TId);e>-1?(a.IsDeleted=!1,t.splice(e,1)):a.IsDeleted=!0})),t.length>0&&t.forEach((function(t){var a={Id:0};a.FK_TId=t,a.IsDeleted=!1,tag_list.push(a)}))}else tag_list.forEach((function(t){t.IsDeleted=!0}));$tag.val(tag_text);const a=$tag[0];a.scrollHeight>a.offsetHeight?$tag.addClass("multiple"):$tag.removeClass("multiple"),tagModal.hide(),tagContentRefresh()}))}function TagListModalElementInit(){$tag=$("#InputTag"),$btn_tag_save=$(".btn_tag_save")}function getTagListDataGridInstance(){return $("#TagList").dxDataGrid("instance")}function TagList_ClearBtnInit(t){tag_clearSelectionButton=t.component}function TagList_ClearBtnClick(){tag_list.length>0&&tag_list.forEach((function(t){t.IsDeleted=!0})),getTagListDataGridInstance().clearSelection()}function TagList_SelectChange(t){const a=t.selectedRowsData,e=$("#TagModal").data("target");tag_check_list=[],a.length>0?(tag_text=a.map((t=>`${t.Title}`)).join("、"),a.forEach((function(t){tag_check_list.push(t.Id)}))):tag_text="無",tag_changedBySelectBox=!1,tag_clearSelectionButton.option("disabled",!a.length),e&&e.data({tagCheckList:tag_check_list,tagText:tag_text})}function TagDataClear(){tag_list=[],tag_check_list=[],tag_text="",$tag.val(""),getTagListDataGridInstance().clearSelection()}function TagDataSet(t){var a="";if(null!=t&&t.length>0){var e=[];t.forEach((function(t){var n={};n.Id=t.id,n.FK_TId=t.fK_TId,n.IsDeleted=!1,e.push(t.fK_TId),a=""==a?t.tag_Name:a+"、"+t.tag_Name,tag_list.push(n)})),getTagListDataGridInstance().selectRows(e)}$tag.val(""==a?"無":a);const n=$tag[0];setTimeout((function(){$tag.removeClass("multiple"),n.scrollHeight>n.offsetHeight&&$tag.addClass("multiple")}),300)}function getSelectSort(){if(tag_list.length>0)return tag_list.filter((t=>0==t.IsDeleted)).slice().map((t=>t.FK_TId)).join(",")}function TagInitSet(t){tag_check_list=[],t.length>0?(tag_text=t.map((t=>`${t.title}`)).join("、"),t.forEach((function(t){tag_check_list.push(t.id)}))):tag_text="無",tag_changedBySelectBox=!1,tag_clearSelectionButton.option("disabled",!t.length),$btn_tag_save.trigger("click")}function tagContentReady(t){$(t.element).addClass("isReady"),TagList_dxData=$("#TagList").dxDataGrid("instance")}function tagContentRefresh(){TagList_dxData.refresh()}function dataSaving(t){var a;if(void 0!==t.newData&&void 0!==t.newData.Title||void 0!==t.data&&void 0!==t.data.Title){void 0!==t.newData?a=t.newData.Title.substring(0,1):void 0!==t.data&&(a=t.data.Title.substring(0,1));-1=="~·`!！@#$￥%^…&*()（）—-_=+[]{}【】、|\\;:；：'\"“‘,./<>《》?？，。".indexOf(a)?(t.component.saveEditData(),TagList_dxData.refresh()):(t.cancel=!0,co.sweet.error("資料錯誤","標籤名稱不可以符號開頭",null,null))}else TagList_dxData.refresh()}$.fn.extend({TagListModalInit:function(){const t=$(this),a=$("#TagList"),e=document.getElementById("TagModal"),n=$(e).find(".btn_tag_save"),i=new bootstrap.Modal(e);function s(){var t=$.Deferred();const e=function(){a.hasClass("isReady")?(clearTimeout(n),t.resolve(a.dxDataGrid("instance"))):n=setTimeout(e,100)};let n=setTimeout(e,100);return t.promise()}return $(this).data("tagOption",t),t.TagDataClear=function(){t.data({tagList:[],tagCheckList:[],tagText:""}),t.removeClass("multiple"),t.val(""),s().done((function(t){t.clearSelection()}))},t.TagDataSet=function(a){var e="";if(null!=a&&a.length>0){var n=[];t.data({tagList:[],tagCheckList:[]}),a.forEach((function(a){var i={};i.Id=a.id,i.FK_TId=a.fK_TId,i.IsDeleted=!1,n.push(a.fK_TId),e=""==e?a.tag_Name:e+"、"+a.tag_Name,t.data("tagList").push(i),t.data("tagCheckList").push(a.id)})),s().done((function(t){t.selectRows(n)}))}t.data("tagText",e),t.val(""==e?"無":e)},t.on("click",(function(){$(e).data("target",t)})),$(e).data("isSet")||($(e).data("isSet",!0),e.addEventListener("hidden.bs.modal",(function(){const t=$(e).data("target");var a=[];t.data("tagList").forEach((function(t){t.IsDeleted||a.push(t.FK_TId)})),s().done((function(t){t.selectRows(a)}))}))),n.off("click").on("click",(function(){const t=$(e).data("target");t.data("tagCheckList").length>0?(t.data("tagList").forEach((function(a){var e=t.data("tagCheckList").indexOf(a.FK_TId);a.IsDeleted=!(e>-1)})),t.data("tagCheckList").length>0&&t.data("tagCheckList").forEach((function(a){if(!t.data("tagList").find((t=>t.FK_TId===a))){var e={Id:0};e.FK_TId=a,e.IsDeleted=!1,t.data("tagList").push(e)}}))):t.data("tagList").forEach((function(t){t.IsDeleted=!0})),t.val(t.data("tagText")),i.hide()})),t}});