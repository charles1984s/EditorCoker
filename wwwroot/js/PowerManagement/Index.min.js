function PageReady(){let e=null,o=0,a=[{id:1,name:"總管理者",members:[{id:1,name:"易碩網際科技"},{id:2,name:"黃小姐"},{id:3,name:"章小姐"}]},{id:2,name:"網站維護者",members:[{id:4,name:"張小姐"}]},{id:0,name:"無群組",members:[{id:5,name:"黃先生"}]}];const t=$("#MemberData").html(),n=$("#RoleData").html(),s=$("#PowerData").html(),c=function(){co.PowerManagement.GetAll().done((function(e){const o=$("#offcanvas1"),a=o.find(".offcanvas-body");o.find(".siteName").text(e.title),r(a,e.jobs)}))},r=function(e,o){$(o).each(((o,a)=>{if(a.enable){const o=$(s);o.find(".title").text(a.title),o.find("#new+label").attr({for:`${a.pageName}_new`}),o.find("#new").attr({id:`${a.pageName}_new`,name:`${a.pageName}_new`}).prop("checked",a.canCreate),o.find("#del+label").attr({for:`${a.pageName}_del`}),o.find("#del").attr({id:`${a.pageName}_del`,name:`${a.pageName}_del`}).prop("checked",a.canRemove),o.find("#edit+label").attr({for:`${a.pageName}_edit`}),o.find("#edit").attr({id:`${a.pageName}_edit`,name:`${a.pageName}_edit`}).prop("checked",a.canUpdate),o.find("#view+label").attr({for:`${a.pageName}_view`}),o.find("#view").attr({id:`${a.pageName}_view`,name:`${a.pageName}_view`}).prop("checked",a.canVisble),o.appendTo(e),null!=a.jobItemModels&&a.jobItemModels.length>0&&r(o,a.jobItemModels)}}))},i=function(){const e=$(this),o=e.data();$(".powerctrl .role-item").removeClass("roleChecked"),e.addClass("roleChecked"),$("#roleMember").empty(),$(o.members).each(((e,o)=>{m("#roleMember",o)}))},d=function(){var e=$("#noGroupMember").data("members");$("#noGroupMember").empty(),$(e).each((function(){m("#noGroupMember",this)}))},m=function(a,n){const s=$(t).data(n);s.find(".title").text(n.name),s.on("click",(function(e){e.stopPropagation(),$(this).hasClass("checked")?$(this).removeClass("checked"):$(this).addClass("checked")})),s.find(".fa-trash-alt").on("click",(function(e){e.stopPropagation();const a=$(this).closest(".item"),t=`是否確認刪除使用者<span class="ConfirmDanger">${$(a).text()}</span>`;co.sweet.confirm("確認刪除?",t,"確認","取消",(function(){co.PowerManagement.RemoveMappingUserAndWebsite($(a).data("id")).done((e=>{if(e.success)if(co.sweet.success("已刪除授權"),0==o){var t=$("#noGroupMember").data("members");co.Array.Delete(t,$(a).data()),$("#noGroupMember").data("members",t),d(),$(".offcanvas").offcanvas("hide")}else{t=$("#noGroupMember").data("members");co.Array.Delete(t,$(a).data()),$("#noGroupMember").data("members",t),d(),$(".offcanvas").offcanvas("hide")}else co.sweet.error(e.error)}))}))})),s.find(".fa-edit").on("click",(function(o){o.stopPropagation();const a=$(this).parents(".member-item").first();e=a,co.PowerManagement.GetUser(a.data("id")).done((e=>{if(e.success){var o=$("#offcanvastopByMember form");co.Form.insertData(e.data,o)}else co.sweet.error("資料錯誤",e.error)}))})),s.find(".fa-user-cog").on("click",(function(o){o.stopPropagation();const a=$(this).parents(".member-item").first();e=a})),s.appendTo(a)},f=function(o){const a=$(n).data(o);a.find(".title").text(o.name),a.on("click",i),a.find(".fa-trash-alt").on("click",(function(e){e.stopPropagation();const o=$(this).closest(".item"),a=`是否確認刪除角色<span class="rad">${$(o).text()}</span>`;co.sweet.confirm("確認刪除?",a,"確認","取消",(function(){co.PowerManagement.DeleteRole($(o).data("id")).done((e=>{e.success?(co.sweet.success("已刪除角色"),$(o).remove()):co.sweet.error(e.error)}))}))})),a.find(".fa-edit").on("click",(function(o){o.stopPropagation();const a=$(this).closest(".item");e=a,co.Form.insertData($(a).data(),$("#offcanvastopByRoleEdit"))})),a.appendTo("#RoleList")};co.PowerManagement.getAllUsers().done((e=>{e.success&&(a=e.data,$(a).each((function(e,o){0!=o.id?f(o):($("#noGroupMember").data(o),d())})),$(".powerctrl .role-item").first().trigger("click"),c(),co.Zipcode.init("#TWzipcode"),co.Zipcode.init("#new-TWzipcode"))})),$("#right-btn").on("click",(function(){const e=$("#roleMember .member-item.checked");e.length>0?e.each((function(){$(this).appendTo("#noGroupMember"),$(this).removeClass("checked")})):co.sweet.error("請選擇要退出群組的使用者")})),$("#left-btn").on("click",(function(){const e=$("#noGroupMember .member-item.checked"),o=$("#RoleList .role-item.roleChecked");if(e.length<=0)co.sweet.error("加入失敗","請選擇要加入角色的使用者");else if(o.length<=0)co.sweet.error("加入失敗","請選擇或新增使用者要加入的角色");else{const a=[],t=[];e.each((function(){a.push($(this).data("id")),t.push(this)})),co.PowerManagement.AddUserToRole({Users:a,RoleId:o.data("id")}).done((e=>{e.success&&$(t).each((function(){o.data("members").push($(this).data()),$(this).appendTo("#roleMember"),$(this).removeClass("checked")}))}))}})),$("#offcanvastopByMember .cancel").on("click",(()=>{$(".offcanvas").offcanvas("hide")})),$("#offcanvastopByMember .delete").on("click",(()=>{$(e).find(".fa-trash-alt").trigger("click")})),$("#offcanvastopByMember .submit").on("click",(()=>{$(".offcanvas").offcanvas("hide")})),$("#offcanvastopByAddUser .submit").on("click",(()=>{const e=$('#offcanvastopByAddUser [name="email"]').val();""==e.trim()?co.sweet.error("請輸入要加入管理的使用者帳號或電子信箱"):co.PowerManagement.MappingUserAndWebsite({emailOrAccount:e,RoleId:o}).done((e=>{if(e.success){var a,t=JSON.parse(e.message);if($(".offcanvas").offcanvas("hide"),0==o)(a=$("#noGroupMember").data()).members.push({id:t.Id,name:t.Name}),$("#noGroupMember").data("members",a.members),d();else(a=$("#roleMember").data()).members.push({id:t.Id,name:t.Name}),$("#noGroupMember").data("members",a.members),console.log(a),i()}else co.sweet.error("新增失敗",e.error)}))})),$("#offcanvastopByRole .submit").on("click",(()=>{const e=$('#offcanvastopByRole [name="name"]').val();""==e.trim()?co.sweet.error("角色名稱不可為空"):co.PowerManagement.AddRole({Name:e}).done((function(e){if(e.success){var o=JSON.parse(e.message);$(".offcanvas").offcanvas("hide"),f({id:o.Id,name:o.Name,members:[]})}else co.sweet.error("新增失敗",e.error)}))})),$("#offcanvastopByRoleEdit .submit").on("click",(()=>{if(""==$('#offcanvastopByRoleEdit [name="name"]').val().trim())co.sweet.error("角色名稱不可為空");else{const o=co.Form.getJson("offcanvastopByRoleEditForm");co.PowerManagement.EditRole(o).done((function(a){a.success?($(".offcanvas").offcanvas("hide"),$(e).find(".title").text(o.name),$(e).data(o),co.sweet.success("修改成功")):co.sweet.error("修改失敗",a.error)}))}})),$("#addUserInRole").on("click",(()=>{0==$("#RoleList .roleChecked").length?(co.sweet.error("請選擇欲讓使用者加入的角色"),$(".offcanvas").offcanvas("hide")):($("#offcanvastopByAddUserSelect").offcanvas("show"),o=$("#RoleList .roleChecked").data("id"))})),$("#addUser").on("click",(()=>{o=0}))}