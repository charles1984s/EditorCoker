function PageReady(){let e=null,a=0,o=[{id:1,name:"總管理者",members:[{id:1,name:"易碩網際科技"},{id:2,name:"黃小姐"},{id:3,name:"章小姐"}]},{id:2,name:"網站維護者",members:[{id:4,name:"張小姐"}]},{id:0,name:"無群組",members:[{id:5,name:"黃先生"}]}];const t=$("#MemberData").html(),n=$("#RoleData").html(),c=$("#PowerData").html(),r=function(){co.PowerManagement.GetAll().done((function(e){const a=$("#offcanvas1"),o=a.find(".offcanvas-body");a.find(".siteName").text(e.title),s(o,e.jobs)}))},s=function(e,a){$(a).each(((a,o)=>{if(o.enable){const a=$(c);a.find(".title").text(o.title),a.find("#new+label").attr({for:`${o.pageName}_new`}),a.find("#new").attr({id:`${o.pageName}_new`,name:`${o.pageName}_new`}).prop("checked",o.canCreate),a.find("#del+label").attr({for:`${o.pageName}_del`}),a.find("#del").attr({id:`${o.pageName}_del`,name:`${o.pageName}_del`}).prop("checked",o.canRemove),a.find("#edit+label").attr({for:`${o.pageName}_edit`}),a.find("#edit").attr({id:`${o.pageName}_edit`,name:`${o.pageName}_edit`}).prop("checked",o.canUpdate),a.find("#view+label").attr({for:`${o.pageName}_view`}),a.find("#view").attr({id:`${o.pageName}_view`,name:`${o.pageName}_view`}).prop("checked",o.canVisble),a.appendTo(e),null!=o.jobItemModels&&o.jobItemModels.length>0&&s(a,o.jobItemModels)}}))},i=function(){const e=$(this),a=e.data();$(".powerctrl .role-item").removeClass("roleChecked"),e.addClass("roleChecked"),$("#roleMember").empty(),$(a.members).each(((e,a)=>{m("#roleMember",a)}))},d=function(){var e=$("#noGroupMember").data("members");$("#noGroupMember").empty(),$(e).each((function(){m("#noGroupMember",this)}))},m=function(o,n){const c=$(t).data(n);c.find(".title").text(n.name),c.on("click",(function(e){e.stopPropagation(),$(this).hasClass("checked")?$(this).removeClass("checked"):$(this).addClass("checked")})),c.find(".fa-trash-alt").on("click",(function(e){e.stopPropagation();const o=$(this).closest(".item"),t=`是否確認刪除使用者<span class="ConfirmDanger">${$(o).text()}</span>`;co.sweet.confirm("確認刪除?",t,"確認","取消",(function(){co.PowerManagement.RemoveMappingUserAndWebsite($(o).data("id")).done((e=>{if(e.success){if(co.sweet.success("已刪除授權"),0==a){var t=$("#noGroupMember").data("members");co.Array.Delete(t,$(o).data()),$("#noGroupMember").data("members",t),d(),$(".offcanvas").offcanvas("hide")}}else co.sweet.error(e.error)}))}))})),c.find(".fa-edit").on("click",(function(a){a.stopPropagation();const o=$(this).parents(".member-item").first();e=o,co.PowerManagement.GetUser(o.data("id")).done((e=>{if(e.success){var a=$("#offcanvastopByMember form");co.Form.insertData(e.data,a)}else co.sweet.error("資料錯誤",e.error)}))})),c.find(".fa-user-cog").on("click",(function(a){a.stopPropagation();const o=$(this).parents(".member-item").first();e=o})),c.appendTo(o)},f=function(e){const a=$(n).data(e);a.find(".title").text(e.name),a.on("click",i),a.find(".fa-trash-alt").on("click",(function(e){e.stopPropagation();const a=$(this).closest(".item"),o=`是否確認刪除角色<span class="rad">${$(a).text()}</span>`;co.sweet.confirm("確認刪除?",o,"確認","取消",(function(){$(a).remove(),$(".offcanvas").offcanvas("hide")}))})),a.appendTo("#RoleList")};co.PowerManagement.getAllUsers().done((e=>{e.success&&(o=e.data,$(o).each((function(e,a){0!=a.id?f(a):($("#noGroupMember").data(a),d())})),$(".powerctrl .role-item").first().trigger("click"),r(),co.Zipcode.init("#TWzipcode"),co.Zipcode.init("#new-TWzipcode"))})),$("#right-btn").on("click",(function(){const e=$("#roleMember .member-item.checked");e.length>0?e.each((function(){$(this).appendTo("#noGroupMember"),$(this).removeClass("checked")})):co.sweet.error("請選擇要退出群組的使用者")})),$("#left-btn").on("click",(function(){const e=$("#noGroupMember .member-item.checked"),a=$("#RoleList .role-item.roleChecked");e.length<=0?co.sweet.error("加入失敗","請選擇要加入角色的使用者"):a.length<=0?co.sweet.error("加入失敗","請選擇或新增使用者要加入的角色"):e.each((function(){a.data("members").push($(this).data()),$(this).appendTo("#roleMember"),$(this).removeClass("checked")}))})),$("#offcanvastopByMember .cancel").on("click",(()=>{$(".offcanvas").offcanvas("hide")})),$("#offcanvastopByMember .delete").on("click",(()=>{$(e).find(".fa-trash-alt").trigger("click")})),$("#offcanvastopByMember .submit").on("click",(()=>{$(".offcanvas").offcanvas("hide")})),$("#offcanvastopByAddUser .submit").on("click",(()=>{const e=$('#offcanvastopByAddUser [name="email"]').val();""==e.trim()?co.sweet.error("請輸入要加入管理的使用者帳號或電子信箱"):co.PowerManagement.MappingUserAndWebsite({emailOrAccount:e,RoleId:a}).done((e=>{if(e.success){var o=JSON.parse(e.message);if($(".offcanvas").offcanvas("hide"),0==a){var t=$("#noGroupMember").data();t.members.push({id:o.Id,name:o.Name}),$("#noGroupMember").data("members",t.members),d()}}else co.sweet.error("新增失敗",e.error)}))})),$("#offcanvastopByRole .submit").on("click",(()=>{const e=$('#offcanvastopByRole [name="name"]').val();""==e.trim()?co.sweet.error("角色名稱不可為空"):co.PowerManagement.AddRole({Name:e}).done((function(e){if(e.success){var a=JSON.parse(e.message);$(".offcanvas").offcanvas("hide"),f({id:a.Id,name:a.Name,members:[]})}else co.sweet.error("新增失敗",e.error)}))})),$("#addUserInRole").on("click",(()=>{0==$("#RoleList .roleChecked").length?(co.sweet.error("請選擇欲讓使用者加入的角色"),$(".offcanvas").offcanvas("hide")):($("#offcanvastopByAddUserSelect").offcanvas("show"),a=$("#RoleList .roleChecked").data("id"))})),$("#addUser").on("click",(()=>{a=0}))}