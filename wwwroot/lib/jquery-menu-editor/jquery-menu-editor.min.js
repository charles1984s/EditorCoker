function MenuEditor(e,t){var s=this,l=$("#"+e).data("level","0"),n=!0,o={labelEdit:'<i class="fas fa-edit clickable"></i>',labelRemove:'<i class="fas fa-trash-alt clickable"></i>',textConfirmDelete:"This item {0} will be deleted. Are you sure?",iconPicker:{cols:4,rows:4,footer:!1,iconset:"GoogleMaterialSymbolsOutlined"},maxLevel:-1,levelChang:!0,listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fas fa-minus"></i>',open:'<i class="fas fa-plus"></i>',openerCss:{"margin-right":"10px",float:"none"},openerClass:"btn btn-outline-success btn-sm"},placeholderCss:{"background-color":"gray"},ignoreClass:"clickable",listsClass:"pl-0",listsCss:{"padding-top":"10px"},complete:function(){return n||co.sweet.error("操作錯誤","該項目無法至此階層。"),n=!0,!0},onChange:function(e){s.updateButtons(l),l.updateLevels(0),o.on.drop&&o.on.drop(e)},isAllowed:function(e,t,s){return n=m(e,s)}},on:{}};s.updateButtons=function(e){e.find(".btnMove").show(),o.levelChang||e.find(".levelMove").hide(),e.updateButtons()},$.extend(!0,o,t);var i=null,a=!0,r=null,c=null,d=o.iconPicker,p=(t=o.listOptions,$("#"+e+"_icon").iconpicker(d));function u(e){var t=e.data();$.each(t,(function(e,t){let s=r.find("[name="+e+"]");if(!(s.length<=0))if("SELECT"===s[0].tagName)s.find("[value="+t+"]").prop("selected",!0),$(s).trigger("change");else if("RADIO"===s.attr("type").toUpperCase())s.find("[value="+t+"]").prop("checked",!0);else s.val(t)})),r.find(".item-menu").first().focus(),t.hasOwnProperty("icon")?p.iconpicker("setIcon",t.icon):p.iconpicker("setIcon","empty"),c.removeAttr("disabled")}function f(){r[0].reset(),(p=p.iconpicker(d)).iconpicker("setIcon","empty"),c.attr("disabled",!0),i=null}function h(e){return $("<a>").addClass(e.classCss).addClass("clickable").attr("href","#").html(e.text)}function v(){var e=$("<div>").addClass("btn-group float-right"),t=h({classCss:"btn btn-primary btn-sm btnEdit",text:o.labelEdit}),s=h({classCss:"btn btn-danger btn-sm btnRemove",text:o.labelRemove}),l=h({classCss:"btn btn-secondary btn-sm btnUp btnMove",text:'<i class="fas fa-angle-up clickable"></i>'}),n=h({classCss:"btn btn-secondary btn-sm btnDown btnMove",text:'<i class="fas fa-angle-down clickable"></i>'}),i=h({classCss:"btn btn-secondary btn-sm btnOut btnMove levelMove",text:'<i class="fas fa-level-down-alt clickable"></i>'}),a=h({classCss:"btn btn-secondary btn-sm btnIn btnMove levelMove",text:'<i class="fas fa-level-up-alt clickable"></i>'}),r=h({classCss:"btn btn-success btn-sm btnPage",text:'<i class="fa fa-paint-roller clickable"></i>'});return e.append(l).append(n).append(a).append(i).append(t).append(s).append(r),e}function b(e,t){var s=void 0===t?0:t,n=0===s?l:$("<ul>").addClass("pl-0").css("padding-top","10px").data("level",s);return $.each(e,(function(e,t){var l=void 0!==t.children&&$.isArray(t.children),o={text:"",href:"",icon:"empty",target:"_self",title:""},i=$.extend({},t);l&&delete i.children,$.extend(o,i);var a=$("<li>").addClass("list-group-item pr-0");a.data(o);var r=$("<div>").css("overflow","auto"),c=$("<i>").addClass(t.icon),d=$("<span>").addClass("txt font-weight-bold").append(t.text).css("margin-right","5px"),p=$("<div class='d-flex align-items-center float-left' />"),u=v();t.canEdit||u.find(".btnEdit ,.btnRemove, .btnPage").addClass("d-none"),c.hasClass("material-symbols-outlined")&&c.text(t.icon.replace("material-symbols-outlined","").trim()),p.append(c).append("&nbsp;").append(d),r.append(p).append(u),a.append(r),l&&a.append(b(t.children,s+1)),n.append(a)})),n}function g(e){var s=$("<span>").addClass("sortableListsOpener "+t.opener.openerClass).css(t.opener.openerCss).on("mousedown touchstart",(function(e){var s=$(this).closest("li");return s.hasClass("sortableListsClosed")?s.iconOpen(t):s.iconClose(t),!1}));s.prependTo(e.find("div.float-left").first()),e.hasClass("sortableListsOpen")?e.iconOpen(t):e.iconClose(t)}function m(e,t){if(o.maxLevel<0)return!0;var s=e.find("ul").length,l=(0==t.length?0:parseInt(t.parent().data("level"))+1)+s;return!(e.data("minLevel")>l||e.data("maxLevel")>0&&e.data("maxLevel")<l)&&l<=o.maxLevel}if(l.sortableLists(o.listOptions),p.on("change",(function(e){r.find("[name=icon]").val(e.icon)})),l.on("click",".btnRemove",(function(t){t.preventDefault();var s=this,n=$(this).closest("li").data(),i=n.text;co.sweet.confirm("即將刪除",o.textConfirmDelete.replace("{0}",i),"確認","取消",(function(){var t=$(s).closest("ul");$(s).closest("li").remove();var i=!1;void 0!==t.attr("id")&&(i=t.attr("id").toString()===e),t.children().length||i||(t.prev("div").children(".sortableListsOpener").first().remove(),t.remove()),o.on.del&&o.on.del(n),s.updateButtons(l)}))})),l.on("click",".btnPage",(function(e){e.preventDefault(),i=$(this).closest("li"),o.on.page&&o.on.page($(i).data()),u(i)})),l.on("click",".btnEdit",(function(e){e.preventDefault(),u(i=$(this).closest("li")),o.on.edit&&o.on.edit()})),l.on("click",".btnUp",(function(e){e.preventDefault();var t=$(this).closest("li");t.prev("li").before(t),s.updateButtons(l),o.on.drop&&o.on.drop(t)})),l.on("click",".btnDown",(function(e){e.preventDefault();var t=$(this).closest("li");t.next("li").after(t),s.updateButtons(l),o.on.drop&&o.on.drop(t)})),l.on("click",".btnOut",(function(e){e.preventDefault();var t=$(this).closest("ul"),n=$(this).closest("li");n.closest("ul").closest("li").after(n),t.children().length<=0&&(t.prev("div").children(".sortableListsOpener").first().remove(),t.remove()),s.updateButtons(l),l.updateLevels(),o.on.drop&&o.on.drop(n)})),l.on("click",".btnIn",(function(e){e.preventDefault();var t=$(this).closest("li"),n=t.prev("li");if(!m(t,n))return!1;if(n.length>0)if((i=n.children("ul")).length>0)i.append(t);else{var i=$("<ul>").addClass("pl-0").css("padding-top","10px");n.append(i),i.append(t),n.addClass("sortableListsOpen"),g(n)}s.updateButtons(l),l.updateLevels(),o.on.drop&&o.on.drop(t)})),s.setForm=function(e){r=e},s.getForm=function(){return r},s.setUpdateButton=function(e){(c=e).attr("disabled",!0),i=null},s.getUpdateButton=function(){return c},s.getCurrentItem=function(){return i},s.update=function(){var e=s.getCurrentItem();if(null!==e)if(r[0].checkValidity()){var t=e.data("icon");r.find(".item-menu").each((function(){e.data($(this).attr("name"),$(this).val())})),e.data("text",e.data("title")),e.children().children("i").removeClass(t).addClass(e.data("icon")),e.find("span.txt").first().text(e.data("text")),o.on.update&&o.on.update(e.data())}else r.addClass("was-validated")},s.add=function(){var e={};if(r[0].checkValidity()){r.find(".item-menu").each((function(){e[$(this).attr("name")]=$(this).val()})),""==e.Id&&(e.Id=0),""==e.SerNO&&(e.SerNO=500),e.text=e.title;var t=v(),n=$("<span>").addClass("txt font-weight-bold").text(e.title),i=$("<i>").addClass(e.icon),a=$("<div class='d-flex align-items-center float-left'>").append(i).append("&nbsp;").append(n),c=$("<div>").css({overflow:"auto"}).append(a).append(t),d=$("<li>").data(e);i.hasClass("material-symbols-outlined")&&i.text(e.icon.replace("material-symbols-outlined","").trim()),d.addClass("list-group-item pr-0").append(c),l.append(d),s.updateButtons(l),f(),o.on.add&&o.on.add(d)}else r.addClass("was-validated")},s.refresh=function(){f()},s.getString=function(){var e=l.sortableListsToJson();return JSON.stringify(e)},s.setData=function(e){var t=Array.isArray(e)?e:function(e){try{var t=JSON.parse(e)}catch(e){return console.log("The string is not a json valid."),null}return t}(e);if(null!==t){l.empty();var n=b(t);a?l.find("li").each((function(){var e=$(this);e.children("ul").length&&g(e)})):(n.sortableLists(o.listOptions),a=!0),s.updateButtons(l)}},o.element){var C=o.element;s.setForm($(C.Form)),s.setUpdateButton($(C.Update)),$(C.Update).click(s.update),$(C.Add).click(s.add),$(C.Refresh).click(s.refresh)}o.on.ready&&o.on.ready()}!function(e){
/**
     * @desc jQuery plugin to sort html list also the tree structures
     * @version 1.4.0
     * @author Vladimír Čamaj
     * @license MIT
     * @desc jQuery plugin
     * @param options
     * @returns this to unsure chaining
     */
e.fn.sortableLists=function(t){var s=e("body").css("position","relative"),l={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(s.css("margin-top")),left:0-parseInt(s.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!1,open:"",close:"",openerCss:{float:"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:!1,scroll:20,ignoreClass:"",isAllowed:function(e,t,s){return!0},onDragStart:function(e,t){return!0},onChange:function(e){return!0},complete:function(e){return!0}},n=e.extend(!0,{},l,t),o=e("<"+n.listSelector+" />").prependTo(s).attr("id","sortableListsBase").css(n.baseCss).addClass(n.listsClass+" "+n.baseClass),i=e("<li />").attr("id","sortableListsPlaceholder").css(n.placeholderCss).addClass(n.placeholderClass),a=e("<li />").attr("id","sortableListsHint").css(n.hintCss).addClass(n.hintClass),r=e("<"+n.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(n.listsClass+" "+n.hintWrapperClass).css(n.listsCss).css(n.hintWrapperCss),c=e("<span />").addClass("sortableListsOpener "+n.opener.openerClass).css(n.opener.openerCss).on("mousedown touchstart",(function(t){var s=e(this).closest("li");return s.hasClass("sortableListsClosed")?L(s):y(s),!1}));"class"==n.opener.as?c.addClass(n.opener.close):"html"==n.opener.as?c.html(n.opener.close):console.error("Invalid setting for opener.as");var d={isDragged:!1,isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:e(document),win:e(window)};if(n.opener.active){if(!n.opener.open)throw"Opener.open value is not defined. It should be valid url, html or css class.";if(!n.opener.close)throw"Opener.close value is not defined. It should be valid url, html or css class.";e(this).find("li").each((function(){var t=e(this);t.children(n.listSelector).length&&(c.clone(!0).prependTo(t.children("div").first()),t.hasClass("sortableListsOpen")?L(t):y(t))}))}return this.on("mousedown touchstart",(function(t){var s=e(t.target);if(!(!1!==d.isDragged||n.ignoreClass&&s.hasClass(n.ignoreClass))){t.preventDefault(),"touchstart"===t.type&&v(t);var l=s.closest("li"),r=e(this);l[0]&&(n.onDragStart(t,l),function(t,s,l){d.isDragged=!0;var r=parseInt(s.css("margin-top")),c=parseInt(s.css("margin-bottom")),f=parseInt(s.css("margin-left")),h=parseInt(s.css("margin-right")),v=s.offset(),b=s.innerHeight();d.rootEl={el:l,offset:l.offset(),rootElClass:l.attr("class")},d.cEl={el:s,mT:r,mL:f,mB:c,mR:h,offset:v},d.cEl.xyOffsetDiff={X:t.pageX-d.cEl.offset.left,Y:t.pageY-d.cEl.offset.top},d.cEl.el.addClass("sortableListsCurrent "+n.currElClass),s.before(i);var g=d.placeholderNode=e("#sortableListsPlaceholder");s.css({width:s.width(),position:"absolute",top:v.top-r,left:v.left-f}).prependTo(o),g.css({display:"block",height:b}),a.css("height",b),d.doc.on("mousemove touchmove",p).on("mouseup touchend touchcancel",u)}(t,l,r))}}));function p(t){if(d.isDragged){var s=d.cEl,l=d.doc,o=d.win;"touchmove"===t.type&&v(t),t.pageX||function(e){e.pageY=d.pY,e.pageX=d.pX,e.clientY=d.cY,e.clientX=d.cX}(t),l.scrollTop()>d.rootEl.offset.top-10&&t.clientY<50?d.upScroll?(t.pageY=t.pageY-n.scroll,e("html, body").each((function(t){e(this).scrollTop(e(this).scrollTop()-n.scroll)})),f(t)):function(e){if(d.upScroll)return;d.upScroll=setInterval((function(){d.doc.trigger("mousemove")}),50)}():l.scrollTop()+o.height()<d.rootEl.offset.top+d.rootEl.el.outerHeight(!1)+10&&o.height()-t.clientY<50?d.downScroll?(t.pageY=t.pageY+n.scroll,e("html, body").each((function(t){e(this).scrollTop(e(this).scrollTop()+n.scroll)})),f(t)):function(e){if(d.downScroll)return;d.downScroll=setInterval((function(){d.doc.trigger("mousemove")}),50)}():h(d),d.oElOld=d.oEl,s.el[0].style.visibility="hidden",d.oEl=oEl=function(t,s){if(!document.elementFromPoint)return null;var l=d.isRelEFP;if(null===l){var n,o;(n=d.doc.scrollTop())>0&&(l=null==(o=document.elementFromPoint(0,n+e(window).height()-1))||"HTML"==o.tagName.toUpperCase()),(n=d.doc.scrollLeft())>0&&(l=null==(o=document.elementFromPoint(n+e(window).width()-1,0))||"HTML"==o.tagName.toUpperCase())}l&&(t-=d.doc.scrollLeft(),s-=d.doc.scrollTop());var i=e(document.elementFromPoint(t,s));if(!d.rootEl.el.find(i).length)return null;if(i.is("#sortableListsPlaceholder")||i.is("#sortableListsHint"))return null;if(!i.is("li"))return(i=i.closest("li"))[0]?i:null;if(i.is("li"))return i}(t.pageX,t.pageY),s.el[0].style.visibility="visible",function(e,t){var s=t.oEl;if(!s||!t.oElOld)return;var l=s.outerHeight(!1),o=e.pageY-s.offset().top;n.insertZonePlus?14>o?g(e,s,7>o):l-14<o&&C(e,s,l-7<o):5>o?b(e,s):l-5<o&&m(e,s)}(t,d),function(e,t){var s=t.cEl;s.el.css({top:e.pageY-s.xyOffsetDiff.Y-s.mT,left:e.pageX-s.xyOffsetDiff.X-s.mL})}(t,d)}}function u(t){var s=d.cEl,l=e("#sortableListsHint",d.rootEl.el),o=a[0].style,i=null,r=!1,f=e("#sortableListsHintWrapper");"touchend"!==t.type&&"touchcancel"!==t.type||v(t),"block"==o.display&&l.length&&d.isAllowed?(i=l,r=!0):(i=d.placeholderNode,r=!1),offset=i.offset(),s.el.animate({left:offset.left-d.cEl.mL,top:offset.top-d.cEl.mT},250,(function(){!function(e){var t=e.el[0].style;e.el.removeClass(n.currElClass+" sortableListsCurrent"),t.top="0",t.left="0",t.position="relative",t.width="auto"}(s),i.after(s.el[0]),i[0].style.display="none",o.display="none",l.remove(),f.removeAttr("id").removeClass(n.hintWrapperClass),f.length&&f.prev("div").prepend(c.clone(!0)),r?d.placeholderNode.slideUp(150,(function(){d.placeholderNode.remove(),w(),n.onChange(s.el),n.complete(s.el),d.isDragged=!1})):(d.placeholderNode.remove(),w(),n.complete(s.el),d.isDragged=!1)})),h(d),d.doc.unbind("mousemove touchmove",p).unbind("mouseup touchend touchcancel",u)}function f(e){d.pY=e.pageY,d.pX=e.pageX,d.cY=e.clientY,d.cX=e.clientX}function h(e){clearInterval(e.upScroll),clearInterval(e.downScroll),e.upScroll=e.downScroll=!1}function v(e){e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.screenX=e.originalEvent.changedTouches[0].screenX,e.screenY=e.originalEvent.changedTouches[0].screenY}function b(t,s){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&a.unwrap(),t.pageX-s.offset().left<n.insertZone){if(s.prev("#sortableListsPlaceholder").length)return void a.css("display","none");s.before(a)}else{var l=s.children(),o=s.children(n.listSelector).first();if(o.children().first().is("#sortableListsPlaceholder"))return void a.css("display","none");o.length?o.prepend(a):(l.first().after(a),a.wrap(r)),d.oEl&&L(s)}a.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,a,a.parents("li").first())}function g(t,s,l){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&a.unwrap(),!l&&t.pageX-s.offset().left>n.insertZone){var o=s.children(),i=s.children(n.listSelector).first();if(i.children().first().is("#sortableListsPlaceholder"))return void a.css("display","none");i.length?i.prepend(a):(o.first().after(a),a.wrap(r)),d.oEl&&L(s)}else{if(s.prev("#sortableListsPlaceholder").length)return void a.css("display","none");s.before(a)}a.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,a,a.parents("li").first())}function m(t,s){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&a.unwrap(),t.pageX-s.offset().left<n.insertZone){if(s.next("#sortableListsPlaceholder").length)return void a.css("display","none");s.after(a)}else{var l=s.children(),o=s.children(n.listSelector).last();if(o.children().last().is("#sortableListsPlaceholder"))return void a.css("display","none");o.length?l.last().append(a):(s.append(a),a.wrap(r)),d.oEl&&L(s)}a.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,a,a.parents("li").first())}function C(t,s,l){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&a.unwrap(),!l&&t.pageX-s.offset().left>n.insertZone){var o=s.children(),i=s.children(n.listSelector).last();if(i.children().last().is("#sortableListsPlaceholder"))return void a.css("display","none");i.length?o.last().append(a):(s.append(a),a.wrap(r)),d.oEl&&L(s)}else{if(s.next("#sortableListsPlaceholder").length)return void a.css("display","none");s.after(a)}a.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,a,a.parents("li").first())}function L(e){e.removeClass("sortableListsClosed").addClass("sortableListsOpen"),e.children(n.listSelector).css("display","block");var t=e.children("div").children(".sortableListsOpener").first();"html"==n.opener.as?t.html(n.opener.close):"class"==n.opener.as?t.addClass(n.opener.close).removeClass(n.opener.open):t.css("background-image","url("+n.opener.close+")")}function y(e){e.removeClass("sortableListsOpen").addClass("sortableListsClosed"),e.children(n.listSelector).css("display","none");var t=e.children("div").children(".sortableListsOpener").first();"html"==n.opener.as?t.html(n.opener.open):"class"==n.opener.as?t.addClass(n.opener.open).removeClass(n.opener.close):t.css("background-image","url("+n.opener.open+")")}function w(){e(n.listSelector,d.rootEl.el).each((function(t){e(this).children().length||(e(this).prev("div").children(".sortableListsOpener").first().remove(),e(this).remove())}))}},e.fn.iconOpen=function(e){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var t=this.find(".float-left").children(".sortableListsOpener").first();"html"===e.opener.as?t.html(e.opener.close):"class"===e.opener.as&&t.addClass(e.opener.close).removeClass(e.opener.open)},e.fn.iconClose=function(e){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var t=this.find(".float-left").children(".sortableListsOpener").first();"html"===e.opener.as?t.html(e.opener.open):"class"===e.opener.as&&t.addClass(e.opener.open).removeClass(e.opener.close)},e.fn.sortableListsToJson=function(){var t=[];return e(this).children("li").each((function(){var s=e(this),l=s.data();t.push(l);var n=s.children("ul,ol").sortableListsToJson();n.length>0?l.children=n:delete l.children})),t},e.fn.updateLevels=function(t){var s=void 0===t?0:t;e(this).children("li").each((function(){var t=e(this).children("ul");t.length>0&&(t.data("level",s+1),t.updateLevels(s+1))}))},e.fn.updateButtons=function(t){var s=void 0===t?0:t,l=["Up","In"],n=["Down"];0===s&&(l.push("Out"),n.push("Out"),e(this).children("li").hideButtons(["Out"])),e(this).children("li").each((function(){var t=e(this).children("ul");t.length>0&&t.updateButtons(s+1)})),e(this).children("li:first").hideButtons(l),e(this).children("li:last").hideButtons(n)},e.fn.hideButtons=function(t){for(var s=0;s<t.length;s++)e(this).find(".btn-group:first").children(".btn"+t[s]).hide()}}(jQuery);